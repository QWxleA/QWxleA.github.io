{"version":3,"sources":["frontend/format/mldoc.cljs"],"mappings":"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","names":["js/frontend","js/frontend.format","js/frontend.format.mldoc","js/frontend.format.mldoc.anchorLink","frontend.format.mldoc/anchorLink","frontend.format.mldoc.goog$module$goog$object.get","js/module$node_modules$mldoc$index.Mldoc","js/frontend.format.mldoc.parseOPML","frontend.format.mldoc/parseOPML","js/frontend.format.mldoc.parseAndExportMarkdown","frontend.format.mldoc/parseAndExportMarkdown","js/frontend.format.mldoc.parseAndExportOPML","frontend.format.mldoc/parseAndExportOPML","js/frontend.format.mldoc.export","frontend.format.mldoc/export","frontend.format.mldoc/parse-opml","content","frontend.format.mldoc/parse-export-markdown","config","references","G__47569","G__47570","G__47571","or__4253__auto__","logseq.graph-parser.mldoc/default-references","frontend.format.mldoc/parse-export-opml","title","G__47573","G__47574","G__47575","G__47576","frontend.format.mldoc/block-with-title?","type","cljs.core/contains?","frontend.format.mldoc/opml->edn","e47579","clojure.string/blank?","vec__47582","cljs.core.nth","headers","blocks","logseq.graph-parser.util/json->clj","logseq.graph-parser.mldoc/collect-page-properties","logseq.graph-parser.mldoc/parse-property","frontend.state.get_config","js/Error","e","lambdaisland.glogi.log","cljs.core/identity","frontend.format.mldoc/->edn","logseq.graph-parser.mldoc/->edn","this__4502__auto__","k__4503__auto__","this__4504__auto__","k47589","else__4505__auto__","G__47605","cljs.core.get","__extmap","this__4522__auto__","f__4523__auto__","init__4524__auto__","cljs.core.reduce","ret__4525__auto__","p__47606","vec__47607","k__4526__auto__","v__4527__auto__","this__4517__auto__","writer__4518__auto__","opts__4519__auto__","pr-pair__4520__auto__","keyval__4521__auto__","cljs.core/pr-sequential-writer","cljs.core.concat","G__47588","cljs.core/RecordIter","cljs.core/-iterator","cljs.core/nil-iter","this__4500__auto__","__meta","this__4497__auto__","__hash","this__4506__auto__","cljs.core/count","this__4498__auto__","h__4360__auto__","coll__4499__auto__","cljs.core/hash-unordered-coll","this47590","other47591","cljs.core._EQ_","cljs.core/PROTOCOL_SENTINEL","this__4512__auto__","k__4513__auto__","cljs.core.dissoc","cljs.core/-with-meta","cljs.core.into","cljs.core/not-empty","this__4509__auto__","this__4510__auto__","k__4511__auto__","pred__47616","cljs.core/keyword-identical?","expr__47617","cljs.core.assoc","this__4515__auto__","cljs.core/seq","this__4501__auto__","this__4507__auto__","entry__4508__auto__","cljs.core/vector?","cljs.core/-nth","cljs.core/-conj","frontend.format.mldoc/MldocMode","this__4546__auto__","cljs.core/List","writer__4547__auto__","cljs.core/-write","G__47600","extmap__4542__auto__","G__47640","cljs.core/record?","frontend.format.mldoc/->MldocMode","frontend.format.mldoc/map->MldocMode","_this","_ok-handler","frontend.format.mldoc/plain->text","plains","clojure.string.join","cljs.core.map","cljs.core/last","frontend.format.mldoc/properties?","ast","cljs.core/ffirst","frontend.format.mldoc/typ-drawer?","typ","cljs.core/second","cljs.core/first"],"sourcesContent":["(ns frontend.format.mldoc\n  \"Mldoc code needed by app but not graph-parser\"\n  (:require [clojure.string :as string]\n            [frontend.format.protocol :as protocol]\n            [frontend.state :as state]\n            [goog.object :as gobj]\n            [lambdaisland.glogi :as log]\n            [\"mldoc\" :as mldoc :refer [Mldoc]]\n            [logseq.graph-parser.mldoc :as gp-mldoc]\n            [logseq.graph-parser.util :as gp-util]))\n\n(defonce anchorLink (gobj/get Mldoc \"anchorLink\"))\n(defonce parseOPML (gobj/get Mldoc \"parseOPML\"))\n(defonce parseAndExportMarkdown (gobj/get Mldoc \"parseAndExportMarkdown\"))\n(defonce parseAndExportOPML (gobj/get Mldoc \"parseAndExportOPML\"))\n(defonce export (gobj/get Mldoc \"export\"))\n\n(defn parse-opml\n  [content]\n  (parseOPML content))\n\n(defn parse-export-markdown\n  [content config references]\n  (parseAndExportMarkdown content\n                          config\n                          (or references gp-mldoc/default-references)))\n\n(defn parse-export-opml\n  [content config title references]\n  (parseAndExportOPML content\n                      config\n                      title\n                      (or references gp-mldoc/default-references)))\n\n(defn block-with-title?\n  [type]\n  (contains? #{\"Paragraph\"\n               \"Raw_Html\"\n               \"Hiccup\"\n               \"Heading\"} type))\n\n(defn opml->edn\n  [content]\n  (try\n    (if (string/blank? content)\n      {}\n      (let [[headers blocks] (-> content (parse-opml) (gp-util/json->clj))]\n        [headers (gp-mldoc/collect-page-properties blocks gp-mldoc/parse-property (state/get-config))]))\n    (catch js/Error e\n      (log/error :edn/convert-failed e)\n      [])))\n\n(defn ->edn\n  \"Wrapper around gp-mldoc/->edn which provides config state\"\n  [content config]\n  (gp-mldoc/->edn content config (state/get-config)))\n\n(defrecord MldocMode []\n  protocol/Format\n  (toEdn [_this content config]\n    (->edn content config))\n  (toHtml [_this content config references]\n    (export \"html\" content config references))\n  (loaded? [_this]\n    true)\n  (lazyLoad [_this _ok-handler]\n    true)\n  (exportMarkdown [_this content config references]\n    (parse-export-markdown content config references))\n  (exportOPML [_this content config title references]\n    (parse-export-opml content config title references)))\n\n(defn plain->text\n  [plains]\n  (string/join (map last plains)))\n\n(defn properties?\n  [ast]\n  (contains? #{\"Properties\" \"Property_Drawer\"} (ffirst ast)))\n\n(defn typ-drawer?\n  [ast typ]\n  (and (contains? #{\"Drawer\"} (ffirst ast))\n       (= typ (second (first ast)))))\n"]}