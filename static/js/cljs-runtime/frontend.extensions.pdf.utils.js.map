{"version":3,"sources":["frontend/extensions/pdf/utils.cljs"],"mappings":"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","names":["js/frontend","js/frontend.extensions","js/frontend.extensions.pdf","js/frontend.extensions.pdf.utils","js/frontend.extensions.pdf.utils.MAX-SCALE","frontend.extensions.pdf.utils/MAX-SCALE","js/frontend.extensions.pdf.utils.MIN-SCALE","frontend.extensions.pdf.utils/MIN-SCALE","js/frontend.extensions.pdf.utils.DELTA_SCALE","frontend.extensions.pdf.utils/DELTA_SCALE","frontend.extensions.pdf.utils/get-bounding-rect","rects","cljs-bean.core/->clj","js/module$frontend$extensions$pdf$utils.getBoundingRect","cljs-bean.core/->js","frontend.extensions.pdf.utils/viewport-to-scaled","bounding","viewport","js/module$frontend$extensions$pdf$utils.viewportToScaled","frontend.extensions.pdf.utils/scaled-to-viewport","js/module$frontend$extensions$pdf$utils.scaledToViewport","frontend.extensions.pdf.utils/optimize-client-reacts","cljs.core/seq","js/module$frontend$extensions$pdf$utils.optimizeClientRects","p__51745","map__51747","cljs.core/--destructure-map","cljs.core.get","frontend.extensions.pdf.utils/vw-to-scaled-pos","viewer","page","temp__5720__auto__","iter__5520__auto__","s__51752","cljs.core/LazySeq","cljs.core/chunked-seq?","c__5518__auto__","size__5519__auto__","cljs.core/count","b__51754","cljs.core/chunk-buffer","i__51753","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__51751","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","rect","p__51760","map__51762","frontend.extensions.pdf.utils/scaled-to-vw-pos","s__51769","b__51771","i__51770","iter__51768","frontend.extensions.pdf.utils/get-page-bounding","page-number","el","and__5041__auto__","frontend.extensions.pdf.utils/resolve-hls-layer!","text-layer","cnt","cls","doc","js/document","layer","cljs.core/not","frontend.extensions.pdf.utils/scroll-to-highlight","hl","js-hl","js/module$frontend$extensions$pdf$utils.scrollToHighlight","frontend.extensions.pdf.utils/zoom-in-viewer","cur-scale","new-scale","js/Math.ceil","x__5131__auto__","y__5132__auto__","frontend.extensions.pdf.utils/zoom-out-viewer","js/Math.floor","x__5128__auto__","y__5129__auto__","frontend.extensions.pdf.utils/get-meta-data$","promesa.core.create","resolve","promesa.core.catch$","promesa.core.then","r","js/console.debug","info","G__51779","e","js/console.error","frontend.extensions.pdf.utils/clear-all-selection","js/window.getSelection","frontend.extensions.pdf.utils/adjust-viewer-size!","frontend.util.debounce","frontend.extensions.pdf.utils/fix-nested-js","its","cljs.core/sequential?","p1__51780#","cljs.core.mapv","cljs.core/map?","frontend.extensions.pdf.utils/gen-uuid","frontend.db/new-block-id","frontend.extensions.pdf.utils/js-load$","url","frontend.loader.load","frontend.extensions.pdf.utils/PDFJS_ROOT","cljs.core._EQ_","js/location.protocol","frontend.extensions.pdf.utils/load-base-assets$","promesa.core.bind","___28360__auto__","promesa.protocols/-promise","_","frontend.extensions.pdf.utils/get-page-from-el","page-el","frontend.extensions.pdf.utils/get-page-from-range","parent-el","frontend.extensions.pdf.utils/get-range-rects<-page-cnt","page-cnt","rge-rects","cnt-offset","s__51789","b__51791","i__51790","iter__51788","frontend.extensions.pdf.utils/next-page","e51792","cljs.core/js-invoke","js/window.lsPdfViewer","js/Error","_e","frontend.extensions.pdf.utils/prev-page","e51795","cljs.core/chunk-first"],"sourcesContent":["(ns frontend.extensions.pdf.utils\n  (:require [promesa.core :as p]\n            [cljs-bean.core :as bean]\n            [frontend.util :as util]\n            [\"/frontend/extensions/pdf/utils\" :as js-utils]\n            [frontend.db :as front-db]\n            [frontend.loader :refer [load]]))\n\n(defonce MAX-SCALE 5.0)\n(defonce MIN-SCALE 0.25)\n(defonce DELTA_SCALE 1.05)\n\n(defn get-bounding-rect\n  [rects]\n  (bean/->clj (js-utils/getBoundingRect (bean/->js rects))))\n\n(defn viewport-to-scaled\n  [bounding ^js viewport]\n  (bean/->clj (js-utils/viewportToScaled (bean/->js bounding) viewport)))\n\n(defn scaled-to-viewport\n  [bounding ^js viewport]\n  (bean/->clj (js-utils/scaledToViewport (bean/->js bounding) viewport)))\n\n(defn optimize-client-reacts\n  [rects]\n  (when (seq rects)\n    (bean/->clj (js-utils/optimizeClientRects (bean/->js rects)))))\n\n(defn vw-to-scaled-pos\n  [^js viewer {:keys [page bounding rects]}]\n  (when-let [^js viewport (.. viewer (getPageView (dec page)) -viewport)]\n    {:bounding (viewport-to-scaled bounding viewport)\n     :rects    (for [rect rects] (viewport-to-scaled rect viewport))\n     :page     page}))\n\n(defn scaled-to-vw-pos\n  [^js viewer {:keys [page bounding rects]}]\n  (when-let [^js viewport (.. viewer (getPageView (dec page)) -viewport)]\n    {:bounding (scaled-to-viewport bounding viewport)\n     :rects    (for [rect rects] (scaled-to-viewport rect viewport))\n     :page     page}))\n\n(defn get-page-bounding\n  [^js viewer page-number]\n  (when-let [^js el (and page-number (.. viewer (getPageView (dec page-number)) -div))]\n    (bean/->clj (.toJSON (.getBoundingClientRect el)))))\n\n(defn resolve-hls-layer!\n  [^js viewer page]\n  (when-let [^js text-layer (.. viewer (getPageView (dec page)) -textLayer)]\n    (let [cnt (.-textLayerDiv text-layer)\n          cls \"extensions__pdf-hls-layer\"\n          doc js/document\n          layer (.querySelector cnt (str \".\" cls))]\n      (if-not layer\n        (let [layer (.createElement doc \"div\")]\n          (set! (. layer -className) cls)\n          (.appendChild cnt layer)\n          layer)\n        layer))))\n\n(defn scroll-to-highlight\n  [^js viewer hl]\n  (when-let [js-hl (bean/->js hl)]\n    (js-utils/scrollToHighlight viewer js-hl)))\n\n(defn zoom-in-viewer\n  [^js viewer]\n  (let [cur-scale (.-currentScale viewer)]\n    (when (< cur-scale MAX-SCALE)\n      (let [new-scale (.toFixed (* cur-scale DELTA_SCALE) 2)\n            new-scale (/ (js/Math.ceil (* new-scale 10)) 10)\n            new-scale (min MAX-SCALE new-scale)]\n\n        (set! (.-currentScale viewer) new-scale)))))\n\n(defn zoom-out-viewer\n  [^js viewer]\n  (let [cur-scale (.-currentScale viewer)]\n    (when (> cur-scale MIN-SCALE)\n      (let [new-scale (.toFixed (/ cur-scale DELTA_SCALE) 2)\n            new-scale (/ (js/Math.floor (* new-scale 10)) 10)\n            new-scale (max MIN-SCALE new-scale)]\n\n        (set! (.-currentScale viewer) new-scale)))))\n\n(defn get-meta-data$\n  [^js viewer]\n  (when-let [^js doc (and viewer (.-pdfDocument viewer))]\n    (p/create\n      (fn [resolve]\n        (p/catch\n          (p/then (.getMetadata doc)\n                  (fn [^js r]\n                    (js/console.debug \"[metadata] \" r)\n                    (when-let [^js info (and r (.-info r))]\n                      (resolve (bean/->clj info)))))\n          (fn [e]\n            (resolve nil)\n            (js/console.error e)))))))\n\n(defn clear-all-selection\n  []\n  (.removeAllRanges (js/window.getSelection)))\n\n(def adjust-viewer-size!\n  (util/debounce\n    200 (fn [^js viewer] (set! (. viewer -currentScaleValue) \"auto\"))))\n\n(defn fix-nested-js\n  [its]\n  (when (sequential? its)\n    (mapv #(if (map? %) % (bean/->clj %)) its)))\n\n(defn gen-uuid []\n  (front-db/new-block-id))\n\n(defn js-load$\n  [url]\n  (p/create\n    (fn [resolve]\n      (load url resolve))))\n\n(def PDFJS_ROOT\n  (if (= js/location.protocol \"file:\")\n    \"./js\"\n    \"./static/js\"))\n\n(defn load-base-assets$\n  []\n  (p/let [_ (js-load$ (str PDFJS_ROOT \"/pdfjs/pdf.js\"))\n          _ (js-load$ (str PDFJS_ROOT \"/pdfjs/pdf_viewer.js\"))]))\n\n(defn get-page-from-el\n  [^js/HTMLElement el]\n  (when-let [^js page-el (and el (.closest el \".page\"))]\n    {:page-number (.. page-el -dataset -pageNumber)\n     :page-el     page-el}))\n\n(defn get-page-from-range\n  [^js/Range r]\n  (when-let [parent-el (and r (.. r -startContainer -parentElement))]\n    (get-page-from-el parent-el)))\n\n(defn get-range-rects<-page-cnt\n  [^js/Range r ^js page-cnt]\n  (let [rge-rects (bean/->clj (.getClientRects r))\n        ^js cnt-offset (.getBoundingClientRect page-cnt)]\n\n    (when (seq rge-rects)\n      (let [rects (for [rect rge-rects]\n                    {:top    (- (+ (.-top rect) (.-scrollTop page-cnt)) (.-top cnt-offset))\n                     :left   (- (+ (.-left rect) (.-scrollLeft page-cnt)) (.-left cnt-offset))\n                     :width  (.-width rect)\n                     :height (.-height rect)})]\n        (optimize-client-reacts rects)))))\n\n;; TODO: which viewer instance?\n(defn next-page\n  []\n  (try\n    (js-invoke js/window.lsPdfViewer \"nextPage\")\n    (catch js/Error _e nil)))\n\n(defn prev-page\n  []\n  (try\n    (js-invoke js/window.lsPdfViewer \"previousPage\")\n    (catch js/Error _e nil)))\n"]}