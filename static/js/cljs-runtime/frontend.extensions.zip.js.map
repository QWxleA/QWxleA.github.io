{"version":3,"sources":["frontend/extensions/zip.cljs"],"mappings":";;AAMA,oCAAA,pCAAMA,gFAAWC,QAAQC,UAAUC;AAAnC,AACE,IAAMC,eAAa,qBAAA,rBAACC,wGAASJ;IACvBK,gBAAc,iBAAAC,mBAAI,SAAA,RAAMN;AAAV,AAAA,oBAAAM;AAAAA;;AAAkC,YAAAC;;;IAChDL,WAAK,AAACE,qBAAQF;AAFpB,AAGE,UAAA,TAAMA,2BAAoBG;;AAC1B,YAAAG,KAAUL,aAAaF,UAAUC;;AAErC,mCAAA,nCAAMO,8EAAUC,aAAaC,sBAAmBC;AAAhD,AACE,IAAMC,MAAI,KAAAC;IACJC,iBAAe,AAACC,6CAAKN,aAAa,gFAAA,/EAAK,wEAAA,xEAACO,2DAAqBP;IAC7DQ,eAAa,4DAAA,5DAACC,uBAAeP,KAAKQ;IAClCC,SAAO,AAASR,WAAIE;AAH1B,AAIE,IAAAO,mBAAA,AAAAC,cAA4BZ;IAA5Ba,qBAAA;IAAAC,qBAAA;IAAAC,iBAAA;;AAAA,AAAA,GAAA,AAAA,CAAAA,iBAAAD;AAAA,IAAAE,mBAAA,AAAAH,wDAAAE;sBAAA,AAAAE,4CAAAD,iBAAA,IAAA,nFAAS1B;oBAAT,AAAA2B,4CAAAD,iBAAA,IAAA,jFAAmB3B;AAAnB,AAAA,AACE,AAAOqB,0DAAWpB,vBACA,oDAAA,pDAACkB,uCAAeD,9DAChB,+EAAA,OAAA,tFAACC,0FACZnB;;AAJT;AAAA,eAAAsB;eAAAE;eAAAC;eAAA,CAAAC,iBAAA;;;;;;;AAAA,IAAAG,2BAAA,AAAAN,cAAAD;AAAA,AAAA,GAAAO;AAAA,AAAA,IAAAP,uBAAAO;AAAA,AAAA,GAAA,AAAAC,6BAAAR;AAAA,IAAAS,wBAAA,AAAAC,sBAAAV;AAAA,AAAA,eAAA,AAAAW,qBAAAX;eAAAS;eAAA,AAAAG,gBAAAH;eAAA;;;;;;;AAAA,IAAAI,mBAAA,AAAAC,gBAAAd;sBAAA,AAAAM,4CAAAO,iBAAA,IAAA,nFAASlC;oBAAT,AAAA2B,4CAAAO,iBAAA,IAAA,jFAAmBnC;AAAnB,AAAA,AACE,AAAOqB,0DAAWpB,vBACA,oDAAA,pDAACkB,uCAAeD,9DAChB,+EAAA,OAAA,tFAACC,0FACZnB;;AAJT;AAAA,eAAA,AAAAqC,eAAAf;eAAA;eAAA;eAAA;;;;;;;;AAAA;;;;;AAKA,OAAAgB,gDAAA,KAAA,WAAAC;AAAA,AAAA,OAAAD,sFAAA,WAAQG,jDAAS,kBAAA,UAAA,5BAAgB5B;AAAjC,AAAA,OAAA2B,2BAAA,AACE,uHAAA,2CAAA,qDAAA,vNAACzC,kCAAU0C,SAAS,2DAAA,dAAK/B","names":["frontend.extensions.zip/make-file","content","file-name","args","blob-content","cljs.core/clj->js","last-modified","or__4253__auto__","js/Date","js/File","frontend.extensions.zip/make-zip","zip-filename","file-name->content","repo","zip","js/module$node_modules$jszip$lib$index","zip-foldername","cljs.core.subs","clojure.string.last_index_of","src-filepath","clojure.string/replace","frontend.config/local-db-prefix","folder","seq__64333","cljs.core/seq","chunk__64334","count__64335","i__64336","vec__64343","cljs.core.nth","temp__5720__auto__","cljs.core/chunked-seq?","c__4679__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","vec__64346","cljs.core/first","cljs.core/next","promesa.core.bind","___42626__auto__","promesa.protocols/-promise","zip-blob"],"sourcesContent":["(ns frontend.extensions.zip\n  (:require [clojure.string :as string]\n            [frontend.config :as config]\n            [\"jszip\" :as JSZip]\n            [promesa.core :as p]))\n\n(defn make-file [content file-name args]\n  (let [blob-content (clj->js [content])\n        last-modified (or (aget content \"lastModified\") (js/Date.))\n        args (clj->js args)]\n    (aset args \"lastModified\" last-modified)\n    (js/File. blob-content file-name args)))\n\n(defn make-zip [zip-filename file-name->content repo]\n  (let [zip (JSZip.)\n        zip-foldername (subs zip-filename (inc (string/last-index-of zip-filename \"/\")))\n        src-filepath (string/replace repo config/local-db-prefix \"\")\n        folder (.folder zip zip-foldername)]\n    (doseq [[file-name content] file-name->content]\n      (.file folder (-> file-name\n                        (string/replace src-filepath \"\")\n                        (string/replace #\"^/+\" \"\"))\n             content))\n    (p/let [zip-blob (.generateAsync zip #js {:type \"blob\"})]\n      (make-file zip-blob (str zip-filename \".zip\") {:type \"application/zip\"}))))\n"]}