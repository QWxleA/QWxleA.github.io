{"version":3,"sources":["frontend/search/node.cljs"],"mappings":"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","names":["this__5340__auto__","k__5341__auto__","this__5342__auto__","k43340","else__5343__auto__","G__43344","cljs.core/Keyword","repo","cljs.core.get","__extmap","this__5360__auto__","f__5361__auto__","init__5362__auto__","cljs.core.reduce","ret__5363__auto__","p__43345","vec__43346","k__5364__auto__","cljs.core.nth","v__5365__auto__","this__5355__auto__","writer__5356__auto__","opts__5357__auto__","pr-pair__5358__auto__","keyval__5359__auto__","cljs.core/pr-sequential-writer","cljs.core.concat","cljs.core/PersistentVector","G__43339","cljs.core/RecordIter","cljs.core/-iterator","cljs.core/nil-iter","this__5338__auto__","__meta","this__5335__auto__","__hash","this__5344__auto__","cljs.core/count","this__5336__auto__","h__5152__auto__","coll__5337__auto__","cljs.core/hash-unordered-coll","this43341","other43342","cljs.core._EQ_","this__5350__auto__","k__5351__auto__","cljs.core/contains?","cljs.core.dissoc","cljs.core/-with-meta","cljs.core.into","cljs.core/not-empty","this__5347__auto__","G__43371","this__5348__auto__","k__5349__auto__","pred__43372","cljs.core/keyword-identical?","expr__43373","cljs.core.assoc","this__5353__auto__","cljs.core/seq","cljs.core/MapEntry","this__5339__auto__","this__5345__auto__","entry__5346__auto__","cljs.core/vector?","cljs.core/-nth","cljs.core/-conj","cljs.core/PROTOCOL_SENTINEL","frontend.search.node/Node","this__5386__auto__","cljs.core/List","writer__5387__auto__","cljs.core/-write","G__43343","extmap__5382__auto__","G__43384","cljs.core/record?","frontend.search.node/->Node","frontend.search.node/map->Node","_this","q","opts","promesa.core.bind","___28360__auto__","promesa.protocols/-promise","result","electron.ipc.ipc","cljs-bean.core/->clj","cljs.core.map","p__43380","map__43381","cljs.core/--destructure-map","content","uuid","page","indice","frontend.search.db/build-blocks-indice","data","cljs-bean.core/->js"],"sourcesContent":["(ns frontend.search.node\n  (:require [cljs-bean.core :as bean]\n            [electron.ipc :as ipc]\n            [frontend.search.db :as search-db]\n            [frontend.search.protocol :as protocol]\n            [promesa.core :as p]))\n\n(defrecord Node [repo]\n  protocol/Engine\n  (query [_this q opts]\n    (p/let [result (ipc/ipc \"search-blocks\" repo q opts)\n            result (bean/->clj result)]\n      (map (fn [{:keys [content uuid page]}]\n             {:block/uuid uuid\n              :block/content content\n              :block/page page}) result)))\n  (cache-stale? [_this repo]\n                ;; only FTS require cache validating\n                (ipc/ipc \"searchVersionChanged?\" repo))\n  (rebuild-blocks-indice! [_this]\n    (let [indice (search-db/build-blocks-indice repo)]\n      (ipc/ipc \"rebuild-blocks-indice\" repo indice)))\n  (transact-blocks! [_this data]\n    (ipc/ipc \"transact-blocks\" repo (bean/->js data)))\n  (truncate-blocks! [_this]\n    (ipc/ipc \"truncate-blocks\" repo))\n  (remove-db! [_this]\n    (ipc/ipc \"remove-db\" repo)))\n"]}