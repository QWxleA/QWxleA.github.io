{"version":3,"sources":["frontend/handler/editor/lifecycle.cljs"],"mappings":";AAOA,oDAAA,pDAAMA,gHACHC;AADH,AAEE,IAAAC,mBAAqC,AAAA,wFAAWD;IAAhDE,mBAAA,AAAAC,4CAAAF,iBAAA,IAAA;IAAAC,uBAAA,AAAAE,4BAAAF;4BAAA,AAAAG,4CAAAH,qBAAA,zFAAeI;eAAf,AAAAH,4CAAAF,iBAAA,IAAA,5EAAiCM;IAC3BC,gBAAQ,+CAAA,AAAAC,sCAAA,mFAAA,xKAACC,+DAAQC,+KAA6BJ;AADpD,AAEE,oBAAMD;AAAN,AACE,AAACM,8CAAgCN;;AADnC;;AAEA,oBAAME;AAAN,AACE,AAACK,iDAAmCN,SAAGC;;AADzC;;AAKA,WAAA,XAACM;AAAD,AAAgB,OAACC,iDAA4Bf;GAA7C;;AAEA,IAAAgB,2BAAmB,AAACE,oBAAgBX;AAApC,AAAA,oBAAAS;AAAA,AAAA,oBAAAA,hBAAWC;AAAX,AACE,AAAQA;;AACR,WAAA,XAACH;AAAD,AAAgB,OAACK,mCAA0BF;GAA3C;;AAFF;;AAGFjB;;AAEF,sDAAA,tDAAMoB,oHACHC,WAAWrB;AADd,AAEE,AAACe,iDAA4Bf;;AAC7BA;;AAEF,iDAAA,jDAAMsB,0GACHtB;AADH,AAEE,IAAAuB,mBAAsB,AAACE;IAAvBF,uBAAA,AAAAnB,4BAAAmB;kBAAA,AAAAlB,4CAAAkB,qBAAA,/EAAcC;AAAd,AACE,AAACE;;AAED,GAAU,0BAAA,iFAAA,8DAAA,yDAAA,oEAAA,+DAAA,2DAAA,haAACC,4fAAoE,AAACC;AAAhF;AAAA,AACE,AAACC,uEAA2B,AAACJ,oCAAWD;;;AAC5CxB;;AAEF,8CAAA,2CAAA,gHAAA,uHAAA,hUAAK8B,uJACS/B,qHACEqB,yHACCE","names":["frontend.handler.editor.lifecycle/did-mount!","state","vec__49658","map__49661","cljs.core.nth","cljs.core/--destructure-map","cljs.core.get","block-parent-id","id","content","cljs.core/deref","cljs.core.get_in","frontend.state/state","frontend.state/set-editing-block-dom-id!","frontend.handler.editor/restore-cursor-pos!","js/setTimeout","frontend.handler.editor.keyboards/esc-save!","temp__5720__auto__","element","goog.dom/getElement","frontend.util/scroll-editor-cursor","frontend.handler.editor.lifecycle/did-remount!","_old-state","frontend.handler.editor.lifecycle/will-unmount","map__49668","value","frontend.handler.editor/get-state","frontend.handler.editor/clear-when-saved!","cljs.core/contains?","frontend.state/get-editor-op","frontend.handler.editor.save_block_BANG_","frontend.handler.editor.lifecycle/lifecycle"],"sourcesContent":["(ns frontend.handler.editor.lifecycle\n  (:require [frontend.handler.editor :as editor-handler :refer [get-state]]\n            [frontend.handler.editor.keyboards :as keyboards-handler]\n            [frontend.state :as state]\n            [frontend.util :as util]\n            [goog.dom :as gdom]))\n\n(defn did-mount!\n  [state]\n  (let [[{:keys [block-parent-id]} id] (:rum/args state)\n        content (get-in @state/state [:editor/content id])]\n    (when block-parent-id\n      (state/set-editing-block-dom-id! block-parent-id))\n    (when content\n      (editor-handler/restore-cursor-pos! id content))\n\n    ;; Here we delay this listener, otherwise the click to edit event will trigger a outside click event,\n    ;; which will hide the editor so no way for editing.\n    (js/setTimeout #(keyboards-handler/esc-save! state) 100)\n\n    (when-let [element (gdom/getElement id)]\n      (.focus element)\n      (js/setTimeout #(util/scroll-editor-cursor element) 50)))\n  state)\n\n(defn did-remount!\n  [_old-state state]\n  (keyboards-handler/esc-save! state)\n  state)\n\n(defn will-unmount\n  [state]\n  (let [{:keys [value]} (get-state)]\n    (editor-handler/clear-when-saved!)\n    ;; TODO: ugly\n    (when-not (contains? #{:insert :indent-outdent :auto-save :undo :redo :delete} (state/get-editor-op))\n      (editor-handler/save-block! (get-state) value)))\n  state)\n\n(def lifecycle\n  {:did-mount did-mount!\n   :did-remount did-remount!\n   :will-unmount will-unmount})\n"]}