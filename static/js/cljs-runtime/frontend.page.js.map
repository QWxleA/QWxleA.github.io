{"version":3,"sources":["frontend/page.cljs"],"mappings":";AASA,2BAAA,AAAAA,oBAAAC,oBAAA,nEAAUE,8EACPC,KAAKC;AADR,AAAA,AAAA,OAAAH,+BAEE,CAACE,qCAAAA,kDAAAA,fAAKC,8BAAAA;GAFR,KAAA;AAIA,gCAAA,hCAAOC;AAAP,AAEE,IAAA,AACE,OAACE,6CACA,AAACC;gBAFJ,GAAA,CAAAF,kBAGSG;AAHT,SAAAH,LAGkBI;AAHlB,AAAA;;AAAA,AAAA,MAAAJ;;;;AAMF;;;;;;6CAAA,AAAAP,oBAAAC,oBAAA,rFAAUmB;AAAV,AAAA,AAAA,OAAAR,6BAAA,MAAA,MAAA,6BAAA,uCAAA,CAAA,AAAAA,6BAAA,MAAA,MAAA,iBAAA,CAAA,AAAAA,6BAAA,MAAA,MAAA,kBAAA,CAAA,AAAAA,6BAAA,MAAA,MAAA,6BAAA,uCAAA,CAAA,AAAAA,6BAAA,MAAA,MAAA,qCAAA,gDAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,4BAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,aAAA,CAAA,iBAAAC,aAcyC,+CAAA,MAAA,2CAAA,uDAAA,2CAAA,lMAACQ,kQAAkCC;AAd5E,AAAA,OAAAV,6BAAA,MAAA,EAAA,AAAAE,qBAAAD,aAAA,AAAAE,wCAAA,AAAAC,2HAAA,2CAAA,wDAAA,mFAAA,WAAA,MAAA,UAAA,uBAAAH,kBAAA,aAAA,8BAAA,EAAA,AAAAC,qBAAAD,aAAA,KAAA,CAAA,AAAAX,+BAAAW;KAAA,AAAAD,6BAAA,MAAA,aAAA,qBAAA,CAAA,iCAAA,AAAAA,6BAAA,MAAA,aAAA,aAAA,CAAA,kIAAA,AAAAA,6BAAA,MAAA,KAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,oEAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,6BAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,2CAAA,CAAA,WAAA,AAAAA,6BAAA,MAAA,KAAA,CAAA,AAAAA,6BAAA,OAAA,aAAA,yBAAA,CAAA,YAAA,AAAAA,6BAAA,OAAA,aAAA,cAAA,CAAA,sBAAA,iBAAAK,aA+Bc,wDAAA,wDAAA,uDAAA,KAAA,5KAACM,yOAEoB;AAAA,AACE,mFAAA,5EAACC;;AAlCtC,AAAA,OAAAZ,6BAAA,MAAA,EAAA,AAAAE,qBAAAG,aAAA,AAAAF,wCAAAE,YAAA,MAAA,EAAA,AAAAH,qBAAAG,aAAA,KAAA,CAAA,AAAAf,+BAAAe;OAAA,AAAAL,6BAAA,MAAA,aAAA,kFAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,6BAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,2CAAA,CAAA,WAAA,AAAAA,6BAAA,MAAA,KAAA,CAAA,AAAAA,6BAAA,OAAA,aAAA,yBAAA,CAAA,aAAA,AAAAA,6BAAA,OAAA,aAAA,cAAA,CAAA,eAAA,AAAAA,6BAAA,MAAA,aAAA,sBAAA,CAAA,uCAAA,iBAAAM,aAwCiB,+CAAA,UAAA,2CAAA,wDAAA,5JAACG;AAxClB,AAAA,OAAAT,6BAAA,MAAA,EAAA,AAAAE,qBAAAI,aAAA,AAAAH,wCAAAG,YAAA,MAAA,EAAA,AAAAJ,qBAAAI,aAAA,CAAA,AAAAhB,sOAAA,CAAA,AAAAA,+BAAAgB,YAAA,AAAAhB,nPAyCY,+CAAA,WAAA,2CAAA,wDAAA,qHAAA,+CAAA,WAAA,2CAAA,wDAAA,/aAACmB,kRAAAA;OAzCb,AAAAT,6BAAA,MAAA,aAAA,kFAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,6BAAA,CAAA,AAAAA,6BAAA,MAAA,aAAA,2CAAA,CAAA,WAAA,AAAAA,6BAAA,MAAA,KAAA,CAAA,AAAAA,6BAAA,OAAA,aAAA,yBAAA,CAAA,UAAA,AAAAA,6BAAA,OAAA,aAAA,cAAA,CAAA,qBAAA,AAAAA,6BAAA,MAAA,aAAA,sBAAA,CAAA,2EAAA,iBAAAO,aAgDY,wDAAA,wDAAA,uDAAA,KAAA,5KAACI,yOAEoB;AAAA,AACE,AAAQE;;AACR,8EAAA,WAAA,lFAACC;;AApDpC,AAAA,OAAAd,6BAAA,MAAA,EAAA,AAAAE,qBAAAK,aAAA,AAAAJ,wCAAAI,YAAA,MAAA,EAAA,AAAAL,qBAAAK,aAAA,KAAA,CAAA,AAAAjB,+BAAAiB;SAAA,AAAAP,6BAAA,MAAA,KAAA,CAAA,AAAAA,6BAAA,IAAA,KAAA,CAAA,iHAAA,AAAAA,6BAAA,IAAA,KAAA,CAAA,uEAAA,AAAAA,6BAAA,IAAA,QAAA,sGAAA,aAAA,CAAA,mCA4DG,AAACe;GA5DJ,KAAA;AA8DA,6BAAA,AAAA3B,oBAAAC,oBAAA,rEAAU2B;AAAV,AAAA,AAAA,OAAA1B,+BAYE,iBAAAmC,qBAAuB,mBAAA,nBAACE;AAAxB,AAAA,oBAAAF;AAAA,AAAA,kBAAAA,dAAWhC;AAAX,AACE,IAAMmC,aAAW,2DAAA,mFAAA,qDAAA,nMAACC,+CAAOpC;AAAzB,AACE,IAAAgC,yBAAgB,AAAA,mFAAO,AAAA,mFAAOhC;AAA9B,AAAA,oBAAAgC;AAAA,AAAA,WAAAA,PAAWjC;AAAX,AACE,OAACsC,mCACA,AAACtB,6CACD,EAAI,6CAAA,7CAACuB,kGAAQH,aACX,CAACpC,qCAAAA,kDAAAA,fAAKC,8BAAAA,cACN,AAACuC,oCACAvC,YACA,CAACD,qCAAAA,kDAAAA,fAAKC,8BAAAA;;AAPZ;;;AAFJ;;;GAZF,qGAAA,2CAAA,7DAAyBwB,2HACR,WAAKC;AAAL,AACE,AAACC,wCAA0B,AAAA,+GAAsBD;;AACjD,AAACE;;AACD,AAACC;;AACD,AAACC;;AACD,AAACC;;AACD,2DAAA,pDAACC,8CAAMN,4FAAiB,AAACxB;GAP5C,qEAQiB,WAAKwB;AAAL,AACE,IAAAO,qBAAoB,AAAA,oHAAYP;AAAhC,AAAA,oBAAAO;AAAA,AAAA,eAAAA,XAAWC;AAAX,AACE,QAACA,yCAAAA,2CAAAA;;AADH;;mBATnB","names":["rum.core/lazy-build","rum.core/build-defc","daiquiri.interpreter/interpret","frontend.page/route-view","view","route-match","frontend.page/setup-fns!","e62625","cljs.core.comp","frontend.ui/setup-active-keystroke!","js/Error","_e","daiquiri.core/create-element","attrs62626","cljs.core/map?","daiquiri.interpreter/element-attributes","daiquiri.normalize.merge_with_class","attrs62639","attrs62664","attrs62672","frontend.page/helpful-default-error-screen","frontend.ui.icon","frontend.ui/icon-size","frontend.ui.button","frontend.handler.search.rebuild_indices_BANG_","js/localStorage","frontend.handler.notification.show_BANG_","frontend.ui/notification","frontend.page/current-page","rum.core/reactive","state","frontend.state/set-root-component!","frontend.state/setup-electron-updater!","frontend.ui/inject-document-devices-envs!","frontend.ui/inject-dynamic-style-node!","frontend.handler.plugin/host-mounted!","cljs.core.assoc","temp__5720__auto__","teardown","frontend.state/sub","route-name","cljs.core.get_in","frontend.ui/catch-error-and-notify","cljs.core._EQ_","frontend.components.sidebar/sidebar"],"sourcesContent":["(ns frontend.page\n  (:require [rum.core :as rum]\n            [frontend.state :as state]\n            [frontend.ui :as ui]\n            [frontend.components.sidebar :as sidebar]\n            [frontend.handler.search :as search-handler]\n            [frontend.handler.notification :as notification]\n            [frontend.handler.plugin :as plugin-handler]))\n\n(rum/defc route-view\n  [view route-match]\n  (view route-match))\n\n(defn- setup-fns!\n  []\n  (try\n    (comp\n     (ui/setup-active-keystroke!))\n    (catch js/Error _e\n      nil)))\n\n(rum/defc helpful-default-error-screen\n  \"This screen is displayed when the UI has crashed hard. It provides the user\n  with basic troubleshooting steps to get them back to a working state. This\n  component is purposefully stupid simple as it needs to render under any number\n  of broken conditions\"\n  []\n  ;; This layout emulates most of sidebar/sidebar\n  [:div#main-container.cp__sidebar-main-layout.flex-1.flex\n   [:div.#app-container\n    [:div#left-container\n     [:div#main-container.cp__sidebar-main-layout.flex-1.flex\n      [:div#main-content-container.scrollbar-spacing.w-full.flex.justify-center\n       [:div.cp__sidebar-main-content\n        [:div.ls-center\n         [:div.icon-box.p-1.rounded.mb-3 (ui/icon \"bug\" {:style {:font-size ui/icon-size}})]\n         [:div.text-xl.font-bold\n          \"Sorry. Something went wrong!\"]\n         [:div.mt-2.mb-2 \"Logseq is having a problem. To try to get it back to a\n         working state, please try the following safe steps in order:\"]\n         [:div\n          ;; TODO: Enable once multi-window case doesn't result in possible data loss\n          #_[:div.flex.flex-row.justify-between.align-items.mb-2\n             [:div.flex.flex-col.items-start\n              [:div.text-2xs.uppercase \"STEP 1\"]\n              [:div [:span.font-bold \"Reload\"] \" the app\"]]\n             [:div (ui/icon \"command\") (ui/icon \"letter-r\")]]\n          [:div.flex.flex-row.justify-between.align-items.mb-2.items-center.py-4\n           [:div.flex.flex-col.items-start\n            [:div.text-2xs.font-bold.uppercase.toned-down \"STEP 1\"]\n            [:div [:span.highlighted.font-bold \"Rebuild\"] [:span.toned-down \" search index\"]]]\n             [:div\n              (ui/button \"Try\"\n                         :small? true\n                         :on-click (fn []\n                                     (search-handler/rebuild-indices! true)))]]\n          [:div.flex.flex-row.justify-between.align-items.mb-2.items-center.separator-top.py-4\n           [:div.flex.flex-col.items-start\n            [:div.text-2xs.font-bold.uppercase.toned-down \"STEP 2\"]\n            [:div [:span.highlighted.font-bold \"Relaunch\"][:span.toned-down \" the app\"]]\n            [:div.text-xs.toned-down \"Quit the app and then reopen it.\"]]\n           [:div (ui/icon \"command\" {:class \"rounded-md p-1 mr-2 bg-quaternary\"})\n            (ui/icon \"letter-q\" {:class \"rounded-md p-1 bg-quaternary\"})]]\n          [:div.flex.flex-row.justify-between.align-items.mb-4.items-center.separator-top.py-4\n           [:div.flex.flex-col.items-start\n            [:div.text-2xs.font-bold.uppercase.toned-down \"STEP 3\"]\n            [:div [:span.highlighted.font-bold \"Clear\"] [:span.toned-down \" local storage\"]]\n            [:div.text-xs.toned-down \"This does delete minor preferences like dark/light theme preference.\"]]\n           [:div\n            (ui/button \"Try\"\n                       :small? true\n                       :on-click (fn []\n                                   (.clear js/localStorage)\n                                   (notification/show! \"Cleared!\" :success)))]]]\n         [:div\n          [:p \"If you think you have experienced data loss, check for backup files under\n          the folder logseq/bak/.\"]\n          [:p \"If these troubleshooting steps have not solved your problem, please \"\n           [:a.underline\n            {:href \"https://github.com/logseq/logseq/issues/new?labels=from:in-app&template=bug_report.yaml\"}\n            \"open an issue.\"]]]]]]]]]\n   (ui/notification)])\n\n(rum/defc current-page < rum/reactive\n  {:did-mount    (fn [state]\n                   (state/set-root-component! (:rum/react-component state))\n                   (state/setup-electron-updater!)\n                   (ui/inject-document-devices-envs!)\n                   (ui/inject-dynamic-style-node!)\n                   (plugin-handler/host-mounted!)\n                   (assoc state ::teardown (setup-fns!) ))\n   :will-unmount (fn [state]\n                   (when-let [teardown (::teardown state)]\n                     (teardown)))}\n  []\n  (when-let [route-match (state/sub :route-match)]\n    (let [route-name (get-in route-match [:data :name])]\n      (when-let [view (:view (:data route-match))]\n        (ui/catch-error-and-notify\n         (helpful-default-error-screen)\n         (if (= :draw route-name)\n           (view route-match)\n           (sidebar/sidebar\n            route-match\n            (view route-match))))))))\n\n        ;; FIXME: disable for now\n        ;; (let [route-name (get-in route-match [:data :name])\n        ;;       no-animate? (contains? #{:repos :repo-add :file}\n        ;;                              route-name)]\n        ;;   (when-let [view (:view (:data route-match))]\n        ;;     (sidebar/sidebar\n        ;;      route-match\n        ;;      (if no-animate?\n        ;;        (route-view view route-match)\n        ;;        (ui/transition-group\n        ;;         {:class-name \"router-wrapper\"}\n        ;;         (ui/css-transition\n        ;;          {:class-names \"pageChange\"\n        ;;           :key route-name\n        ;;           :timeout {:enter 300\n        ;;                     :exit 200}}\n        ;;          (route-view view route-match)))))))\n"]}