{"version":3,"sources":["frontend/mobile/mobile_bar.cljs"],"mappings":"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","names":["frontend.mobile.mobile-bar/icons-keywords","frontend.mobile.mobile-bar/commands-stats","cljs.core.atom","cljs.core.into","cljs.core.mapv","name","frontend.mobile.mobile-bar/set-command-stats","icon","key","cljs.core.keyword","counts","cljs.core/deref","cljs.core.get_in","cljs.core.swap_BANG_","cljs.core/assoc-in","frontend.handler.config/set-config!","rum.core/lazy-build","rum.core/build-defc","p__62068","vec__62069","cljs.core.nth","daiquiri.core/create-element","daiquiri.interpreter/interpret","frontend.mobile.mobile-bar/command","command-handler","count?","event?","e","frontend.util/stop","frontend.state/set-state!","cljs.core/rand-int","frontend.ui.icon","frontend.ui/icon-size","frontend.mobile.mobile-bar/indent-outdent","indent?","frontend.handler.editor/indent-outdent","frontend.mobile.mobile-bar/timestamp-submenu","parent-id","callback","event","target","dommy.core.remove_class_BANG_","command-cp","action","description","goog.dom/getNextElementSibling","dommy.core.add_class_BANG_","frontend.util/keyboard-height","today","frontend.handler.page/get-page-ref-text","frontend.date/today","frontend.commands/simple-insert!","tomorrow","frontend.date/tomorrow","yesterday","frontend.date/yesterday","timestamp","frontend.date/get-current-time","frontend.mobile.mobile-bar/commands","viewport-fn","temp__5720__auto__","input","goog.dom/getElement","frontend.util.scroll_editor_cursor","cljs.core/zipmap","frontend.handler.editor/cycle-todo!","frontend.handler.editor/toggle-page-reference-embed","frontend.handler.editor/toggle-block-reference-embed","frontend.handler.editor/cycle-priority!","frontend.handler.editor/toggle-list!","frontend.mobile.camera/embed-photo","frontend.mobile.record/start-recording","frontend.commands/insert-youtube-timestamp","frontend.handler.editor/html-link-format!","frontend.handler.history/undo!","frontend.handler.history/redo!","frontend.handler.editor/bold-format!","frontend.handler.editor/italics-format!","frontend.handler.editor/strike-through-format!","frontend.handler.editor/highlight-format!","cljs.core.into_array","iter__5520__auto__","s__62073","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__5518__auto__","size__5519__auto__","cljs.core/count","b__62075","cljs.core/chunk-buffer","i__62074","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__62072","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","frontend.mobile.mobile-bar/mobile-bar","rum.core/reactive","and__5041__auto__","frontend.state/sub","config-toolbar-stats","frontend.state.get_config","cljs.core.prn","cljs.core/reset!","frontend.state/get-edit-input-id","commands","sorted-commands","cljs.core.sort_by","cljs.core.comp","cljs.core/second","cljs.core/>","frontend.handler.editor/move-up-down","frontend.handler.editor.insert_new_block_BANG_","command","fexpr__62077","fexpr__62079","frontend.state/clear-edit!","cljs.core/chunk-first"],"sourcesContent":["(ns frontend.mobile.mobile-bar\n  (:require [dommy.core :as dom]\n            [frontend.commands :as commands]\n            [frontend.date :as date]\n            [frontend.handler.config :as config-handler]\n            [frontend.handler.editor :as editor-handler]\n            [frontend.handler.history :as history]\n            [frontend.handler.page :as page-handler]\n            [frontend.mobile.camera :as mobile-camera]\n            [frontend.mobile.record :as record]\n            [frontend.state :as state]\n            [frontend.ui :as ui]\n            [frontend.util :as util]\n            [goog.dom :as gdom]\n            [rum.core :as rum]))\n\n(def ^:private icons-keywords\n  [:checkbox :brackets :parentheses :command :tag :a-b :list :camera :microphone\n   :brand-youtube :link :rotate :rotate-clockwise :calendar :code :bold :italic :strikethrough :paint])\n\n(def ^:private commands-stats\n  (atom (into {}\n              (mapv (fn [name] [name {:counts 0}])\n                    icons-keywords))))\n\n(defn set-command-stats [icon]\n  (let [key (keyword icon)\n        counts (get-in @commands-stats [key :counts])]\n    (swap! commands-stats\n           assoc-in [key :counts] (inc counts))\n    (config-handler/set-config!\n     :mobile/toolbar-stats @commands-stats)))\n\n(rum/defc command\n  [command-handler icon & [count? event?]]\n  [:div\n   [:button.bottom-action\n    {:on-mouse-down (fn [e]\n                      (util/stop e)\n                      (when count?\n                        (set-command-stats icon))\n                      (if event?\n                        (command-handler e)\n                        (command-handler))\n                      (state/set-state! :mobile/toolbar-update-observer (rand-int 1000000)))}\n    (ui/icon icon {:style {:fontSize ui/icon-size}})]])\n\n(rum/defc indent-outdent [indent? icon]\n  [:div\n   [:button.bottom-action\n    {:on-mouse-down (fn [e]\n                      (util/stop e)\n                      (editor-handler/indent-outdent indent?))}\n    (ui/icon icon {:style {:fontSize ui/icon-size}})]])\n\n(rum/defc timestamp-submenu\n  [parent-id]\n  (let [callback (fn [event]\n                   (util/stop event)\n                   (let [target (.-parentNode (.-target event))]\n                     (dom/remove-class! target \"show-submenu\")))\n        command-cp (fn [action description]\n                     [:button\n                      {:on-mouse-down (fn [e]\n                                        (action)\n                                        (callback e))}\n                      description])]\n    [:div\n     [:button.bottom-action\n      {:on-mouse-down (fn [event]\n                        (util/stop event)\n                        (set-command-stats :calendar)\n                        (state/set-state! :mobile/toolbar-update-observer (rand-int 1000000))\n                        (let [target (gdom/getNextElementSibling (.-target event))]\n                          (dom/add-class! target \"show-submenu\")))}\n      (ui/icon \"calendar\" {:style {:fontSize ui/icon-size}})\n      [:div.submenu.fixed.hidden.flex.flex-col.w-full.justify-evenly\n       {:style {:bottom @util/keyboard-height}}\n       (command-cp #(let [today (page-handler/get-page-ref-text (date/today))]\n                      (commands/simple-insert! parent-id today {}))\n                   \"Today\")\n       (command-cp #(let [tomorrow (page-handler/get-page-ref-text (date/tomorrow))]\n                      (commands/simple-insert! parent-id tomorrow {}))\n                   \"Tomorrow\")\n       (command-cp #(let [yesterday (page-handler/get-page-ref-text (date/yesterday))]\n                      (commands/simple-insert! parent-id yesterday {}))\n                   \"Yesterday\")\n       (command-cp #(let [timestamp (date/get-current-time)]\n                      (commands/simple-insert! parent-id timestamp {}))\n                   \"Time\")]]]))\n\n(defn commands\n  [parent-id]\n  (let [viewport-fn (fn [] (when-let [input (gdom/getElement parent-id)]\n                             (util/scroll-editor-cursor input :to-vw-one-quarter? true)\n                             (.focus input)))]\n    (zipmap icons-keywords\n            [(command editor-handler/cycle-todo! \"checkbox\" true)\n             (command #(do (viewport-fn) (editor-handler/toggle-page-reference-embed parent-id)) \"brackets\" true)\n             (command #(do (viewport-fn) (editor-handler/toggle-block-reference-embed parent-id)) \"parentheses\" true)\n             (command #(do (viewport-fn) (commands/simple-insert! parent-id \"/\" {})) \"command\" true)\n             (command #(do (viewport-fn) (commands/simple-insert! parent-id \"#\" {})) \"tag\" true)\n             (command editor-handler/cycle-priority! \"a-b\" true)\n             (command editor-handler/toggle-list! \"list\" true)\n             (command #(mobile-camera/embed-photo parent-id) \"camera\" true)\n             (command record/start-recording \"microphone\" true)\n             (command commands/insert-youtube-timestamp \"brand-youtube\" true)\n             (command editor-handler/html-link-format! \"link\" true)\n             (command history/undo! \"rotate\" true true)\n             (command history/redo! \"rotate-clockwise\" true true)\n             (timestamp-submenu parent-id)\n             (command #(commands/simple-insert! parent-id \"<\" {}) \"code\" true)\n             (command editor-handler/bold-format! \"bold\" true)\n             (command editor-handler/italics-format! \"italic\" true)\n             (command editor-handler/strike-through-format! \"strikethrough\" true)\n             (command editor-handler/highlight-format! \"paint\" true)])))\n\n(rum/defc mobile-bar < rum/reactive\n  []\n  (when (and (state/sub :mobile/toolbar-update-observer)\n             (state/sub :mobile/show-toolbar?))\n    (when-let [config-toolbar-stats (:mobile/toolbar-stats (state/get-config))]\n      (prn :config-toolbar-stats config-toolbar-stats)\n      (reset! commands-stats config-toolbar-stats))\n    (let [parent-id (state/get-edit-input-id)\n          commands (commands parent-id)\n          sorted-commands (sort-by (comp :counts second) > @commands-stats)]\n      (when (and (state/sub :mobile/show-toolbar?)\n                 (state/sub :editor/editing?))\n        [:div#mobile-editor-toolbar.bg-base-2\n         [:div.toolbar-commands\n          (indent-outdent false \"indent-decrease\")\n          (indent-outdent true \"indent-increase\")\n          (command (editor-handler/move-up-down true) \"arrow-bar-to-up\")\n          (command (editor-handler/move-up-down false) \"arrow-bar-to-down\")\n          (command #(if (state/sub :document/mode?)\n                      (editor-handler/insert-new-block! nil)\n                      (commands/simple-insert! parent-id \"\\n\" {})) \"arrow-back\")\n          (for [command sorted-commands]\n            ((first command) commands))]\n         [:div.toolbar-hide-keyboard\n          (command #(state/clear-edit!) \"keyboard-show\")]]))))\n\n"]}