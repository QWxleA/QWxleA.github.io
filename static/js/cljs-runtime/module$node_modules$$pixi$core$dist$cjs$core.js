shadow$provide.module$node_modules$$pixi$core$dist$cjs$core=function(global,require,module,exports){function autoDetectResource(source,options){if(!source)return null;var extension="";if("string"===typeof source){var result=/\.(\w{3,4})(?:$|\?|#)/i.exec(source);result&&(extension=result[1].toLowerCase())}for(result=INSTALLED.length-1;0<=result;--result){var ResourcePlugin=INSTALLED[result];if(ResourcePlugin.test&&ResourcePlugin.test(source,extension))return new ResourcePlugin(source,options)}throw Error("Unrecognized source type to auto-detect Resource");
}function __extends(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}function removeAllHandlers(tex){tex.destroy=function(){};tex.on=function(){};tex.once=function(){};tex.emit=function(){}}function compileShader(gl,type,src){type=gl.createShader(type);gl.shaderSource(type,src);gl.compileShader(type);return type}function logPrettyShaderError(gl,shader){var shaderSrc=gl.getShaderSource(shader).split("\n").map(function(line,
index){return index+": "+line});gl=gl.getShaderInfoLog(shader);var dedupe={},logArgs=[""];gl.split("\n").map(function(line){return parseFloat(line.replace(/^ERROR: 0:([\d]+):.*$/,"$1"))}).filter(function(n){return n&&!dedupe[n]?dedupe[n]=!0:!1}).forEach(function(number){shaderSrc[number-1]="%c"+shaderSrc[number-1]+"%c";logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});shader=shaderSrc.join("\n");logArgs[0]=shader;console.error(gl);console.groupCollapsed("click to view full shader code");
console.warn.apply(console,logArgs);console.groupEnd()}function logProgramError(gl,program,vertexShader,fragmentShader){gl.getProgramParameter(program,gl.LINK_STATUS)||(gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,vertexShader),gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)||logPrettyShaderError(gl,fragmentShader),console.error("PixiJS Error: Could not initialize shader."),""!==gl.getProgramInfoLog(program)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",
gl.getProgramInfoLog(program)))}function booleanArray(size){size=Array(size);for(var i=0;i<size.length;i++)size[i]=!1;return size}function defaultValue(type,size){switch(type){case "float":return 0;case "vec2":return new Float32Array(2*size);case "vec3":return new Float32Array(3*size);case "vec4":return new Float32Array(4*size);case "int":case "uint":case "sampler2D":case "sampler2DArray":return 0;case "ivec2":return new Int32Array(2*size);case "ivec3":return new Int32Array(3*size);case "ivec4":return new Int32Array(4*
size);case "uvec2":return new Uint32Array(2*size);case "uvec3":return new Uint32Array(3*size);case "uvec4":return new Uint32Array(4*size);case "bool":return!1;case "bvec2":return booleanArray(2*size);case "bvec3":return booleanArray(3*size);case "bvec4":return booleanArray(4*size);case "mat2":return new Float32Array([1,0,0,1]);case "mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case "mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function getTestContext(){if(context$jscomp$0===
unknownContext||context$jscomp$0&&context$jscomp$0.isContextLost()){var canvas=document.createElement("canvas"),gl=void 0;settings.settings.PREFER_ENV>=constants.ENV.WEBGL2&&(gl=canvas.getContext("webgl2",{}));gl||((gl=canvas.getContext("webgl",{})||canvas.getContext("experimental-webgl",{}))?gl.getExtension("WEBGL_draw_buffers"):gl=null);context$jscomp$0=gl}return context$jscomp$0}function setPrecision(src,requestedPrecision,maxSupportedPrecision){if("precision"!==src.substring(0,9)){var precision=
requestedPrecision;requestedPrecision===constants.PRECISION.HIGH&&maxSupportedPrecision!==constants.PRECISION.HIGH&&(precision=constants.PRECISION.MEDIUM);return"precision "+precision+" float;\n"+src}return maxSupportedPrecision!==constants.PRECISION.HIGH&&"precision highp"===src.substring(0,15)?src.replace("precision highp","precision mediump"):src}function mapType(gl,type){if(!GL_TABLE){var typeNames=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(var i=0;i<typeNames.length;++i){var tn=typeNames[i];
GL_TABLE[gl[tn]]=GL_TO_GLSL_TYPES[tn]}}return GL_TABLE[type]}function checkMaxIfStatementsInShader(maxIfs,gl){if(0===maxIfs)throw Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var shader=gl.createShader(gl.FRAGMENT_SHADER);;){for(var JSCompiler_temp_const="precision mediump float;\nvoid main(void){\nfloat test \x3d 0.1;\n%forloop%\ngl_FragColor \x3d vec4(0.0);\n}".replace,src="",i=0;i<maxIfs;++i)0<i&&(src+="\nelse "),i<maxIfs-1&&(src+="if(test \x3d\x3d "+i+".0){}");JSCompiler_temp_const=
JSCompiler_temp_const.call("precision mediump float;\nvoid main(void){\nfloat test \x3d 0.1;\n%forloop%\ngl_FragColor \x3d vec4(0.0);\n}",/%forloop%/gi,src);gl.shaderSource(shader,JSCompiler_temp_const);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS))break;else maxIfs=maxIfs/2|0}return maxIfs}function uboUpdate(_ud,_uv,_renderer,_syncData,buffer){_renderer.buffer.update(buffer)}function createUBOElements(uniformData){uniformData=uniformData.map(function(data){return{data,
offset:0,dataLen:0,dirty:0}});for(var size=0,chunkSize=0,offset=0,i=0;i<uniformData.length;i++){var uboElement=uniformData[i];size=GLSL_TO_STD40_SIZE[uboElement.data.type];1<uboElement.data.size&&(size=Math.max(size,16)*uboElement.data.size);uboElement.dataLen=size;if(0!==chunkSize%size&&16>chunkSize){var lineUpValue=chunkSize%size%16;chunkSize+=lineUpValue;offset+=lineUpValue}16<chunkSize+size?(offset=16*Math.ceil(offset/16),uboElement.offset=offset,offset+=size,chunkSize=size):(uboElement.offset=
offset,chunkSize+=size,offset+=size)}offset=16*Math.ceil(offset/16);return{uboElements:uniformData,size:offset}}function getUBOData(uniforms,uniformData){var usedUniformDatas=[],i;for(i in uniforms)uniformData[i]&&usedUniformDatas.push(uniformData[i]);usedUniformDatas.sort(function(a,b){return a.index-b.index});return usedUniformDatas}function generateUniformBufferSync(group,uniformData){if(!group.autoManage)return{size:0,syncFunc:uboUpdate};uniformData=getUBOData(group.uniforms,uniformData);var _a=
createUBOElements(uniformData);uniformData=_a.uboElements;_a=_a.size;for(var funcFragments=["\n    var v \x3d null;\n    var v2 \x3d null;\n    var cv \x3d null;\n    var t \x3d 0;\n    var gl \x3d renderer.gl\n    var index \x3d 0;\n    var data \x3d buffer.data;\n    "],i=0;i<uniformData.length;i++){for(var uboElement=uniformData[i],uniform=group.uniforms[uboElement.data.name],name=uboElement.data.name,parsed=!1,j=0;j<uniformParsers.length;j++){var uniformParser=uniformParsers[j];if(uniformParser.codeUbo&&
uniformParser.test(uboElement.data,uniform)){funcFragments.push("offset \x3d "+uboElement.offset/4+";",uniformParsers[j].codeUbo(uboElement.data.name,uniform));parsed=!0;break}}parsed||(1<uboElement.data.size?(uniform=Math.max(GLSL_TO_STD40_SIZE[uboElement.data.type]/16,1),parsed=GLSL_TO_SIZE[uboElement.data.type]/uniform,funcFragments.push("\n                cv \x3d ud."+name+".value;\n                v \x3d uv."+name+";\n                offset \x3d "+uboElement.offset/4+";\n\n                t \x3d 0;\n\n                for(var i\x3d0; i \x3c "+
uboElement.data.size*uniform+"; i++)\n                {\n                    for(var j \x3d 0; j \x3c "+parsed+"; j++)\n                    {\n                        data[offset++] \x3d v[t++];\n                    }\n                    offset +\x3d "+(4-parsed%4)%4+";\n                }\n\n                ")):funcFragments.push("\n                cv \x3d ud."+name+".value;\n                v \x3d uv."+name+";\n                offset \x3d "+uboElement.offset/4+";\n                "+UBO_TO_SINGLE_SETTERS[uboElement.data.type]+
";\n                "))}funcFragments.push("\n       renderer.buffer.update(buffer);\n    ");return{size:_a,syncFunc:new Function("ud","uv","renderer","syncData","buffer",funcFragments.join("\n"))}}function getAttributeData(program,gl){for(var attributes={},totalAttributes=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<totalAttributes;i++){var attribData=gl.getActiveAttrib(program,i);if(0!==attribData.name.indexOf("gl_")){var type=mapType(gl,attribData.type);type={type,name:attribData.name,
size:GLSL_TO_SIZE[type],location:gl.getAttribLocation(program,attribData.name)};attributes[attribData.name]=type}}return attributes}function getUniformData(program,gl){for(var uniforms={},totalUniforms=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<totalUniforms;i++){var uniformData=gl.getActiveUniform(program,i),name=uniformData.name.replace(/\[.*?\]$/,""),isArray=!!uniformData.name.match(/\[.*?\]$/),type=mapType(gl,uniformData.type);uniforms[name]={name,index:i,type,size:uniformData.size,
isArray,value:defaultValue(type,uniformData.size)}}return uniforms}function generateProgram(gl,program){var glVertShader=compileShader(gl,gl.VERTEX_SHADER,program.vertexSrc),glFragShader=compileShader(gl,gl.FRAGMENT_SHADER,program.fragmentSrc),webGLProgram=gl.createProgram();gl.attachShader(webGLProgram,glVertShader);gl.attachShader(webGLProgram,glFragShader);gl.linkProgram(webGLProgram);gl.getProgramParameter(webGLProgram,gl.LINK_STATUS)||logProgramError(gl,webGLProgram,glVertShader,glFragShader);
program.attributeData=getAttributeData(webGLProgram,gl);program.uniformData=getUniformData(webGLProgram,gl);if(!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(program.vertexSrc)){var keys=Object.keys(program.attributeData);keys.sort(function(a,b){return a>b?1:-1});for(var i=0;i<keys.length;i++)program.attributeData[keys[i]].location=i,gl.bindAttribLocation(webGLProgram,i,keys[i]);gl.linkProgram(webGLProgram)}gl.deleteShader(glVertShader);gl.deleteShader(glFragShader);glVertShader={};for(i in program.uniformData)glFragShader=
program.uniformData[i],glVertShader[i]={location:gl.getUniformLocation(webGLProgram,i),value:defaultValue(glFragShader.type,glFragShader.size)};return new GLProgram(webGLProgram,glVertShader)}Object.defineProperty(exports,"__esModule",{value:!0});var settings=require("module$node_modules$$pixi$settings$dist$cjs$settings"),constants=require("module$node_modules$$pixi$constants$dist$cjs$constants"),utils=require("module$node_modules$$pixi$utils$dist$cjs$utils"),runner=require("module$node_modules$$pixi$runner$dist$cjs$runner"),
ticker=require("module$node_modules$$pixi$ticker$dist$cjs$ticker"),math=require("module$node_modules$$pixi$math$dist$cjs$math");settings.settings.PREFER_ENV=utils.isMobile.any?constants.ENV.WEBGL:constants.ENV.WEBGL2;settings.settings.STRICT_TEXTURE_CACHE=!1;var INSTALLED=[],extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,
b$jscomp$0)},__assign=function(){__assign=Object.assign||function(t){for(var arguments$1=arguments,s,i=1,n=arguments.length;i<n;i++){s=arguments$1[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};return __assign.apply(this,arguments)},Resource=function(){function Resource(width,height){void 0===width&&(width=0);void 0===height&&(height=0);this._width=width;this._height=height;this.internal=this.destroyed=!1;this.onResize=new runner.Runner("setRealSize");this.onUpdate=
new runner.Runner("update");this.onError=new runner.Runner("onError")}Resource.prototype.bind=function(baseTexture){this.onResize.add(baseTexture);this.onUpdate.add(baseTexture);this.onError.add(baseTexture);(this._width||this._height)&&this.onResize.emit(this._width,this._height)};Resource.prototype.unbind=function(baseTexture){this.onResize.remove(baseTexture);this.onUpdate.remove(baseTexture);this.onError.remove(baseTexture)};Resource.prototype.resize=function(width,height){if(width!==this._width||
height!==this._height)this._width=width,this._height=height,this.onResize.emit(width,height)};Object.defineProperty(Resource.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0});Resource.prototype.update=function(){this.destroyed||this.onUpdate.emit()};Resource.prototype.load=function(){return Promise.resolve(this)};Object.defineProperty(Resource.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0});Object.defineProperty(Resource.prototype,
"height",{get:function(){return this._height},enumerable:!1,configurable:!0});Resource.prototype.style=function(_renderer,_baseTexture,_glTexture){return!1};Resource.prototype.dispose=function(){};Resource.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)};Resource.test=function(_source,_extension){return!1};return Resource}(),BufferResource=
function(_super){function BufferResource(source,options){var _a=options||{};options=_a.width;_a=_a.height;if(!options||!_a)throw Error("BufferResource width or height invalid");options=_super.call(this,options,_a)||this;options.data=source;return options}__extends(BufferResource,_super);BufferResource.prototype.upload=function(renderer,baseTexture,glTexture){renderer=renderer.gl;renderer.pixelStorei(renderer.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants.ALPHA_MODES.UNPACK);var width=
baseTexture.realWidth,height=baseTexture.realHeight;glTexture.width===width&&glTexture.height===height?renderer.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,renderer.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data));return!0};BufferResource.prototype.dispose=function(){this.data=null};BufferResource.test=function(source){return source instanceof
Float32Array||source instanceof Uint8Array||source instanceof Uint32Array};return BufferResource}(Resource),defaultBufferOptions={scaleMode:constants.SCALE_MODES.NEAREST,format:constants.FORMATS.RGBA,alphaMode:constants.ALPHA_MODES.NPM},BaseTexture=function(_super){function BaseTexture(resource,options){void 0===resource&&(resource=null);void 0===options&&(options=null);var _this=_super.call(this)||this;options=options||{};var alphaMode=options.alphaMode,mipmap=options.mipmap,anisotropicLevel=options.anisotropicLevel,
scaleMode=options.scaleMode,width=options.width,height=options.height,wrapMode=options.wrapMode,format=options.format,type=options.type,target=options.target,resolution=options.resolution;options=options.resourceOptions;!resource||resource instanceof Resource||(resource=autoDetectResource(resource,options),resource.internal=!0);_this.resolution=resolution||settings.settings.RESOLUTION;_this.width=Math.round((width||0)*_this.resolution)/_this.resolution;_this.height=Math.round((height||0)*_this.resolution)/
_this.resolution;_this._mipmap=void 0!==mipmap?mipmap:settings.settings.MIPMAP_TEXTURES;_this.anisotropicLevel=void 0!==anisotropicLevel?anisotropicLevel:settings.settings.ANISOTROPIC_LEVEL;_this._wrapMode=wrapMode||settings.settings.WRAP_MODE;_this._scaleMode=void 0!==scaleMode?scaleMode:settings.settings.SCALE_MODE;_this.format=format||constants.FORMATS.RGBA;_this.type=type||constants.TYPES.UNSIGNED_BYTE;_this.target=target||constants.TARGETS.TEXTURE_2D;_this.alphaMode=void 0!==alphaMode?alphaMode:
constants.ALPHA_MODES.UNPACK;_this.uid=utils.uid();_this.touched=0;_this.isPowerOfTwo=!1;_this._refreshPOT();_this._glTextures={};_this.dirtyId=0;_this.dirtyStyleId=0;_this.cacheId=null;_this.valid=0<width&&0<height;_this.textureCacheIds=[];_this.destroyed=!1;_this.resource=null;_this._batchEnabled=0;_this._batchLocation=0;_this.parentTextureArray=null;_this.setResource(resource);return _this}__extends(BaseTexture,_super);Object.defineProperty(BaseTexture.prototype,"realWidth",{get:function(){return Math.round(this.width*
this.resolution)},enumerable:!1,configurable:!0});Object.defineProperty(BaseTexture.prototype,"realHeight",{get:function(){return Math.round(this.height*this.resolution)},enumerable:!1,configurable:!0});Object.defineProperty(BaseTexture.prototype,"mipmap",{get:function(){return this._mipmap},set:function(value){this._mipmap!==value&&(this._mipmap=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0});Object.defineProperty(BaseTexture.prototype,"scaleMode",{get:function(){return this._scaleMode},
set:function(value){this._scaleMode!==value&&(this._scaleMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0});Object.defineProperty(BaseTexture.prototype,"wrapMode",{get:function(){return this._wrapMode},set:function(value){this._wrapMode!==value&&(this._wrapMode=value,this.dirtyStyleId++)},enumerable:!1,configurable:!0});BaseTexture.prototype.setStyle=function(scaleMode,mipmap){if(void 0!==scaleMode&&scaleMode!==this.scaleMode){this.scaleMode=scaleMode;var dirty=!0}void 0!==mipmap&&mipmap!==
this.mipmap&&(this.mipmap=mipmap,dirty=!0);dirty&&this.dirtyStyleId++;return this};BaseTexture.prototype.setSize=function(desiredWidth,desiredHeight,resolution){resolution=resolution||this.resolution;return this.setRealSize(desiredWidth*resolution,desiredHeight*resolution,resolution)};BaseTexture.prototype.setRealSize=function(realWidth,realHeight,resolution){this.resolution=resolution||this.resolution;this.width=Math.round(realWidth)/this.resolution;this.height=Math.round(realHeight)/this.resolution;
this._refreshPOT();this.update();return this};BaseTexture.prototype._refreshPOT=function(){this.isPowerOfTwo=utils.isPow2(this.realWidth)&&utils.isPow2(this.realHeight)};BaseTexture.prototype.setResolution=function(resolution){var oldResolution=this.resolution;if(oldResolution===resolution)return this;this.resolution=resolution;this.valid&&(this.width=Math.round(this.width*oldResolution)/resolution,this.height=Math.round(this.height*oldResolution)/resolution,this.emit("update",this));this._refreshPOT();
return this};BaseTexture.prototype.setResource=function(resource){if(this.resource===resource)return this;if(this.resource)throw Error("Resource can be set only once");resource.bind(this);this.resource=resource;return this};BaseTexture.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):0<this.width&&0<this.height&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))};BaseTexture.prototype.onError=function(event){this.emit("error",this,
event)};BaseTexture.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null);this.cacheId&&(delete utils.BaseTextureCache[this.cacheId],delete utils.TextureCache[this.cacheId],this.cacheId=null);this.dispose();BaseTexture.removeFromCache(this);this.textureCacheIds=null;this.destroyed=!0};BaseTexture.prototype.dispose=function(){this.emit("dispose",this)};BaseTexture.prototype.castToBaseTexture=function(){return this};
BaseTexture.from=function(source,options,strict){void 0===strict&&(strict=settings.settings.STRICT_TEXTURE_CACHE);var isFrame="string"===typeof source;if(isFrame)var cacheId=source;else source._pixiId||(source._pixiId=(options&&options.pixiIdPrefix||"pixiid")+"_"+utils.uid()),cacheId=source._pixiId;var baseTexture=utils.BaseTextureCache[cacheId];if(isFrame&&strict&&!baseTexture)throw Error('The cacheId "'+cacheId+'" does not exist in BaseTextureCache.');baseTexture||(baseTexture=new BaseTexture(source,
options),baseTexture.cacheId=cacheId,BaseTexture.addToCache(baseTexture,cacheId));return baseTexture};BaseTexture.fromBuffer=function(buffer,width,height,options){buffer=buffer||new Float32Array(width*height*4);var resource=new BufferResource(buffer,{width,height});buffer=buffer instanceof Float32Array?constants.TYPES.FLOAT:constants.TYPES.UNSIGNED_BYTE;return new BaseTexture(resource,Object.assign(defaultBufferOptions,options||{width,height,type:buffer}))};BaseTexture.addToCache=function(baseTexture,
id){id&&(-1===baseTexture.textureCacheIds.indexOf(id)&&baseTexture.textureCacheIds.push(id),utils.BaseTextureCache[id]&&console.warn("BaseTexture added to the cache with an id ["+id+"] that already had an entry"),utils.BaseTextureCache[id]=baseTexture)};BaseTexture.removeFromCache=function(baseTexture){if("string"===typeof baseTexture){var baseTextureFromCache=utils.BaseTextureCache[baseTexture];if(baseTextureFromCache){var index=baseTextureFromCache.textureCacheIds.indexOf(baseTexture);-1<index&&
baseTextureFromCache.textureCacheIds.splice(index,1);delete utils.BaseTextureCache[baseTexture];return baseTextureFromCache}}else if(baseTexture&&baseTexture.textureCacheIds){for(baseTextureFromCache=0;baseTextureFromCache<baseTexture.textureCacheIds.length;++baseTextureFromCache)delete utils.BaseTextureCache[baseTexture.textureCacheIds[baseTextureFromCache]];baseTexture.textureCacheIds.length=0;return baseTexture}return null};BaseTexture._globalBatch=0;return BaseTexture}(utils.EventEmitter),AbstractMultiResource=
function(_super){function AbstractMultiResource(length,options){options=options||{};options=_super.call(this,options.width,options.height)||this;options.items=[];options.itemDirtyIds=[];for(var i=0;i<length;i++){var partTexture=new BaseTexture;options.items.push(partTexture);options.itemDirtyIds.push(-2)}options.length=length;options._load=null;options.baseTexture=null;return options}__extends(AbstractMultiResource,_super);AbstractMultiResource.prototype.initFromArray=function(resources,options){for(var i=
0;i<this.length;i++)resources[i]&&(resources[i].castToBaseTexture?this.addBaseTextureAt(resources[i].castToBaseTexture(),i):resources[i]instanceof Resource?this.addResourceAt(resources[i],i):this.addResourceAt(autoDetectResource(resources[i],options),i))};AbstractMultiResource.prototype.dispose=function(){for(var i=0,len=this.length;i<len;i++)this.items[i].destroy();this._load=this.itemDirtyIds=this.items=null};AbstractMultiResource.prototype.addResourceAt=function(resource,index){if(!this.items[index])throw Error("Index "+
index+" is out of bounds");resource.valid&&!this.valid&&this.resize(resource.width,resource.height);this.items[index].setResource(resource);return this};AbstractMultiResource.prototype.bind=function(baseTexture){if(null!==this.baseTexture)throw Error("Only one base texture per TextureArray is allowed");_super.prototype.bind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=baseTexture,this.items[i].on("update",baseTexture.update,baseTexture)};AbstractMultiResource.prototype.unbind=
function(baseTexture){_super.prototype.unbind.call(this,baseTexture);for(var i=0;i<this.length;i++)this.items[i].parentTextureArray=null,this.items[i].off("update",baseTexture.update,baseTexture)};AbstractMultiResource.prototype.load=function(){var _this=this;if(this._load)return this._load;var promises=this.items.map(function(item){return item.resource}).filter(function(item){return item}).map(function(item){return item.load()});return this._load=Promise.all(promises).then(function(){var _a=_this.items[0];
_this.resize(_a.realWidth,_a.realHeight);return Promise.resolve(_this)})};return AbstractMultiResource}(Resource),ArrayResource=function(_super){function ArrayResource(source,options){var _a=options||{};var _this=_a.width;_a=_a.height;if(Array.isArray(source)){var urls=source;source=source.length}_this=_super.call(this,source,{width:_this,height:_a})||this;urls&&_this.initFromArray(urls,options);return _this}__extends(ArrayResource,_super);ArrayResource.prototype.addBaseTextureAt=function(baseTexture,
index){if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index);else throw Error("ArrayResource does not support RenderTexture");return this};ArrayResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture);baseTexture.target=constants.TARGETS.TEXTURE_2D_ARRAY};ArrayResource.prototype.upload=function(renderer,texture,glTexture){var length=this.length,itemDirtyIds=this.itemDirtyIds,items=this.items;renderer=renderer.gl;0>glTexture.dirtyId&&renderer.texImage3D(renderer.TEXTURE_2D_ARRAY,
0,glTexture.internalFormat,this._width,this._height,length,0,texture.format,glTexture.type,null);for(var i=0;i<length;i++){var item=items[i];itemDirtyIds[i]<item.dirtyId&&(itemDirtyIds[i]=item.dirtyId,item.valid&&renderer.texSubImage3D(renderer.TEXTURE_2D_ARRAY,0,0,0,i,item.resource.width,item.resource.height,1,texture.format,glTexture.type,item.resource.source))}return!0};return ArrayResource}(AbstractMultiResource),BaseImageResource=function(_super){function BaseImageResource(source){var _this=
_super.call(this,source.naturalWidth||source.videoWidth||source.width,source.naturalHeight||source.videoHeight||source.height)||this;_this.source=source;_this.noSubImage=!1;return _this}__extends(BaseImageResource,_super);BaseImageResource.crossOrigin=function(element,url,crossorigin){void 0===crossorigin&&0!==url.indexOf("data:")?element.crossOrigin=utils.determineCrossOrigin(url):!1!==crossorigin&&(element.crossOrigin="string"===typeof crossorigin?crossorigin:"anonymous")};BaseImageResource.prototype.upload=
function(renderer,baseTexture,glTexture,source){renderer=renderer.gl;var width=baseTexture.realWidth,height=baseTexture.realHeight;source=source||this.source;renderer.pixelStorei(renderer.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===constants.ALPHA_MODES.UNPACK);this.noSubImage||baseTexture.target!==renderer.TEXTURE_2D||glTexture.width!==width||glTexture.height!==height?(glTexture.width=width,glTexture.height=height,renderer.texImage2D(baseTexture.target,0,glTexture.internalFormat,baseTexture.format,
glTexture.type,source)):renderer.texSubImage2D(renderer.TEXTURE_2D,0,0,0,baseTexture.format,glTexture.type,source);return!0};BaseImageResource.prototype.update=function(){if(!this.destroyed){var source=this.source;this.resize(source.naturalWidth||source.videoWidth||source.width,source.naturalHeight||source.videoHeight||source.height);_super.prototype.update.call(this)}};BaseImageResource.prototype.dispose=function(){this.source=null};return BaseImageResource}(Resource),CanvasResource=function(_super){function CanvasResource(source){return _super.call(this,
source)||this}__extends(CanvasResource,_super);CanvasResource.test=function(source){var OffscreenCanvas=self.OffscreenCanvas;return OffscreenCanvas&&source instanceof OffscreenCanvas?!0:self.HTMLCanvasElement&&source instanceof HTMLCanvasElement};return CanvasResource}(BaseImageResource),CubeResource=function(_super){function CubeResource(source,options){var _a=options||{};var _this=_a.width;var height=_a.height,autoLoad=_a.autoLoad;_a=_a.linkBaseTexture;if(source&&source.length!==CubeResource.SIDES)throw Error("Invalid length. Got "+
source.length+", expected 6");_this=_super.call(this,6,{width:_this,height})||this;for(height=0;height<CubeResource.SIDES;height++)_this.items[height].target=constants.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+height;_this.linkBaseTexture=!1!==_a;source&&_this.initFromArray(source,options);!1!==autoLoad&&_this.load();return _this}__extends(CubeResource,_super);CubeResource.prototype.bind=function(baseTexture){_super.prototype.bind.call(this,baseTexture);baseTexture.target=constants.TARGETS.TEXTURE_CUBE_MAP};
CubeResource.prototype.addBaseTextureAt=function(baseTexture,index,linkBaseTexture){if(!this.items[index])throw Error("Index "+index+" is out of bounds");if(!this.linkBaseTexture||baseTexture.parentTextureArray||0<Object.keys(baseTexture._glTextures).length)if(baseTexture.resource)this.addResourceAt(baseTexture.resource,index);else throw Error("CubeResource does not support copying of renderTexture.");else baseTexture.target=constants.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+index,baseTexture.parentTextureArray=
this.baseTexture,this.items[index]=baseTexture;baseTexture.valid&&!this.valid&&this.resize(baseTexture.realWidth,baseTexture.realHeight);this.items[index]=baseTexture;return this};CubeResource.prototype.upload=function(renderer,_baseTexture,glTexture){for(var dirty=this.itemDirtyIds,i=0;i<CubeResource.SIDES;i++){var side=this.items[i];dirty[i]<side.dirtyId&&(side.valid&&side.resource?(side.resource.upload(renderer,side,glTexture),dirty[i]=side.dirtyId):-1>dirty[i]&&(renderer.gl.texImage2D(side.target,
0,glTexture.internalFormat,_baseTexture.realWidth,_baseTexture.realHeight,0,_baseTexture.format,glTexture.type,null),dirty[i]=-1))}return!0};CubeResource.test=function(source){return Array.isArray(source)&&source.length===CubeResource.SIDES};CubeResource.SIDES=6;return CubeResource}(AbstractMultiResource),ImageResource=function(_super){function ImageResource(source,options){options=options||{};if(!(source instanceof HTMLImageElement)){var _this=new Image;BaseImageResource.crossOrigin(_this,source,
options.crossorigin);_this.src=source;source=_this}_this=_super.call(this,source)||this;!source.complete&&_this._width&&_this._height&&(_this._width=0,_this._height=0);_this.url=source.src;_this._process=null;_this.preserveBitmap=!1;_this.createBitmap=(void 0!==options.createBitmap?options.createBitmap:settings.settings.CREATE_IMAGE_BITMAP)&&!!self.createImageBitmap;_this.alphaMode="number"===typeof options.alphaMode?options.alphaMode:null;_this.bitmap=null;_this._load=null;!1!==options.autoLoad&&
_this.load();return _this}__extends(ImageResource,_super);ImageResource.prototype.load=function(createBitmap){var _this=this;if(this._load)return this._load;void 0!==createBitmap&&(this.createBitmap=createBitmap);return this._load=new Promise(function(resolve,reject){var source=_this.source;_this.url=source.src;var completed=function(){_this.destroyed||(source.onload=null,source.onerror=null,_this.resize(source.width,source.height),_this._load=null,_this.createBitmap?resolve(_this.process()):resolve(_this))};
source.complete&&source.src?completed():(source.onload=completed,source.onerror=function(event){reject(event);_this.onError.emit(event)})})};ImageResource.prototype.process=function(){var _this=this,source=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!self.createImageBitmap)return Promise.resolve(this);var createImageBitmap=self.createImageBitmap;return this._process=fetch(source.src,{mode:source.crossOrigin&&"anonymous"!==source.crossOrigin?"no-cors":"cors"}).then(function(r){return r.blob()}).then(function(blob){return createImageBitmap(blob,
0,0,source.width,source.height,{premultiplyAlpha:_this.alphaMode===constants.ALPHA_MODES.UNPACK?"premultiply":"none"})}).then(function(bitmap){if(_this.destroyed)return Promise.reject();_this.bitmap=bitmap;_this.update();_this._process=null;return Promise.resolve(_this)})};ImageResource.prototype.upload=function(renderer,baseTexture,glTexture){"number"===typeof this.alphaMode&&(baseTexture.alphaMode=this.alphaMode);if(!this.createBitmap)return _super.prototype.upload.call(this,renderer,baseTexture,
glTexture);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;_super.prototype.upload.call(this,renderer,baseTexture,glTexture,this.bitmap);if(!this.preserveBitmap){renderer=!0;var glTextures=baseTexture._glTextures,key;for(key in glTextures){var otherTex=glTextures[key];if(otherTex!==glTexture&&otherTex.dirtyId!==baseTexture.dirtyId){renderer=!1;break}}renderer&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0};ImageResource.prototype.dispose=function(){this.source.onload=
null;this.source.onerror=null;_super.prototype.dispose.call(this);this.bitmap&&(this.bitmap.close(),this.bitmap=null);this._load=this._process=null};ImageResource.test=function(source){return"string"===typeof source||source instanceof HTMLImageElement};return ImageResource}(BaseImageResource),SVGResource=function(_super){function SVGResource(sourceBase64,options){options=options||{};var _this=_super.call(this,document.createElement("canvas"))||this;_this._width=0;_this._height=0;_this.svg=sourceBase64;
_this.scale=options.scale||1;_this._overrideWidth=options.width;_this._overrideHeight=options.height;_this._resolve=null;_this._crossorigin=options.crossorigin;_this._load=null;!1!==options.autoLoad&&_this.load();return _this}__extends(SVGResource,_super);SVGResource.prototype.load=function(){var _this=this;return this._load?this._load:this._load=new Promise(function(resolve){_this._resolve=function(){_this.resize(_this.source.width,_this.source.height);resolve(_this)};if(SVGResource.SVG_XML.test(_this.svg.trim())){if(!btoa)throw Error("Your browser doesn't support base64 conversions.");
_this.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(_this.svg)))}_this._loadSvg()})};SVGResource.prototype._loadSvg=function(){var _this=this,tempImage=new Image;BaseImageResource.crossOrigin(tempImage,this.svg,this._crossorigin);tempImage.src=this.svg;tempImage.onerror=function(event){_this._resolve&&(tempImage.onerror=null,_this.onError.emit(event))};tempImage.onload=function(){if(_this._resolve){var svgWidth=tempImage.width,svgHeight=tempImage.height;if(!svgWidth||!svgHeight)throw Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");
var width=svgWidth*_this.scale,height=svgHeight*_this.scale;if(_this._overrideWidth||_this._overrideHeight)width=_this._overrideWidth||_this._overrideHeight/svgHeight*svgWidth,height=_this._overrideHeight||_this._overrideWidth/svgWidth*svgHeight;width=Math.round(width);height=Math.round(height);var canvas=_this.source;canvas.width=width;canvas.height=height;canvas._pixiId="canvas_"+utils.uid();canvas.getContext("2d").drawImage(tempImage,0,0,svgWidth,svgHeight,0,0,width,height);_this._resolve();_this._resolve=
null}}};SVGResource.getSize=function(svgString){svgString=SVGResource.SVG_SIZE.exec(svgString);var size={};svgString&&(size[svgString[1]]=Math.round(parseFloat(svgString[3])),size[svgString[5]]=Math.round(parseFloat(svgString[7])));return size};SVGResource.prototype.dispose=function(){_super.prototype.dispose.call(this);this._crossorigin=this._resolve=null};SVGResource.test=function(source,extension){return"svg"===extension||"string"===typeof source&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(source)||
"string"===typeof source&&SVGResource.SVG_XML.test(source)};SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(\x3c!--[^(--\x3e)]*--\x3e)?\s*<svg/m;SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;return SVGResource}(BaseImageResource),VideoResource=function(_super){function VideoResource(source,options){options=options||{};if(!(source instanceof HTMLVideoElement)){var videoElement=document.createElement("video");
videoElement.setAttribute("preload","auto");videoElement.setAttribute("webkit-playsinline","");videoElement.setAttribute("playsinline","");"string"===typeof source&&(source=[source]);BaseImageResource.crossOrigin(videoElement,source[0].src||source[0],options.crossorigin);for(var i=0;i<source.length;++i){var sourceElement=document.createElement("source"),_a=source[i],src=_a.src;_a=_a.mime;src=src||source[i];var baseSrc=src.split("?").shift().toLowerCase();baseSrc=baseSrc.substr(baseSrc.lastIndexOf(".")+
1);_a=_a||VideoResource.MIME_TYPES[baseSrc]||"video/"+baseSrc;sourceElement.src=src;sourceElement.type=_a;videoElement.appendChild(sourceElement)}source=videoElement}source=_super.call(this,source)||this;source.noSubImage=!0;source._autoUpdate=!0;source._isConnectedToTicker=!1;source._updateFPS=options.updateFPS||0;source._msToNextUpdate=0;source.autoPlay=!1!==options.autoPlay;source._load=null;source._resolve=null;source._onCanPlay=source._onCanPlay.bind(source);source._onError=source._onError.bind(source);
!1!==options.autoLoad&&source.load();return source}__extends(VideoResource,_super);VideoResource.prototype.update=function(_deltaTime){!this.destroyed&&(this._msToNextUpdate=Math.floor(this._msToNextUpdate-ticker.Ticker.shared.elapsedMS*this.source.playbackRate),!this._updateFPS||0>=this._msToNextUpdate)&&(_super.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1E3/this._updateFPS):0)};VideoResource.prototype.load=function(){var _this=this;if(this._load)return this._load;
var source=this.source;(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0);source.addEventListener("play",this._onPlayStart.bind(this));source.addEventListener("pause",this._onPlayStop.bind(this));this._isSourceReady()?this._onCanPlay():(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("error",this._onError,!0));return this._load=
new Promise(function(resolve){_this.valid?resolve(_this):(_this._resolve=resolve,source.load())})};VideoResource.prototype._onError=function(event){this.source.removeEventListener("error",this._onError,!0);this.onError.emit(event)};VideoResource.prototype._isSourcePlaying=function(){var source=this.source;return 0<source.currentTime&&!1===source.paused&&!1===source.ended&&2<source.readyState};VideoResource.prototype._isSourceReady=function(){var source=this.source;return 3===source.readyState||4===
source.readyState};VideoResource.prototype._onPlayStart=function(){this.valid||this._onCanPlay();this.autoUpdate&&!this._isConnectedToTicker&&(ticker.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)};VideoResource.prototype._onPlayStop=function(){this._isConnectedToTicker&&(ticker.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)};VideoResource.prototype._onCanPlay=function(){var source=this.source;source.removeEventListener("canplay",this._onCanPlay);source.removeEventListener("canplaythrough",
this._onCanPlay);var valid=this.valid;this.resize(source.videoWidth,source.videoHeight);!valid&&this._resolve&&(this._resolve(this),this._resolve=null);this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&source.play()};VideoResource.prototype.dispose=function(){this._isConnectedToTicker&&(ticker.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);var source=this.source;source&&(source.removeEventListener("error",this._onError,!0),source.pause(),source.src="",source.load());
_super.prototype.dispose.call(this)};Object.defineProperty(VideoResource.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(value){value!==this._autoUpdate&&(this._autoUpdate=value,!this._autoUpdate&&this._isConnectedToTicker?(ticker.Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(ticker.Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0});
Object.defineProperty(VideoResource.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(value){value!==this._updateFPS&&(this._updateFPS=value)},enumerable:!1,configurable:!0});VideoResource.test=function(source,extension){return self.HTMLVideoElement&&source instanceof HTMLVideoElement||-1<VideoResource.TYPES.indexOf(extension)};VideoResource.TYPES="mp4 m4v webm ogg ogv h264 avi mov".split(" ");VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};
return VideoResource}(BaseImageResource),ImageBitmapResource=function(_super){function ImageBitmapResource(source){return _super.call(this,source)||this}__extends(ImageBitmapResource,_super);ImageBitmapResource.test=function(source){return!!self.createImageBitmap&&source instanceof ImageBitmap};return ImageBitmapResource}(BaseImageResource);INSTALLED.push(ImageResource,ImageBitmapResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);var _resources={__proto__:null,
Resource,BaseImageResource,INSTALLED,autoDetectResource,AbstractMultiResource,ArrayResource,BufferResource,CanvasResource,CubeResource,ImageResource,SVGResource,VideoResource,ImageBitmapResource},DepthResource=function(_super){function DepthResource(){return null!==_super&&_super.apply(this,arguments)||this}__extends(DepthResource,_super);DepthResource.prototype.upload=function(renderer,baseTexture,glTexture){renderer=renderer.gl;renderer.pixelStorei(renderer.UNPACK_PREMULTIPLY_ALPHA_WEBGL,baseTexture.alphaMode===
constants.ALPHA_MODES.UNPACK);var width=baseTexture.realWidth,height=baseTexture.realHeight;glTexture.width===width&&glTexture.height===height?renderer.texSubImage2D(baseTexture.target,0,0,0,width,height,baseTexture.format,glTexture.type,this.data):(glTexture.width=width,glTexture.height=height,renderer.texImage2D(baseTexture.target,0,glTexture.internalFormat,width,height,0,baseTexture.format,glTexture.type,this.data));return!0};return DepthResource}(BufferResource),Framebuffer=function(){function Framebuffer(width,
height){this.width=Math.round(width||100);this.height=Math.round(height||100);this.depth=this.stencil=!1;this.dirtySize=this.dirtyFormat=this.dirtyId=0;this.depthTexture=null;this.colorTextures=[];this.glFramebuffers={};this.disposeRunner=new runner.Runner("disposeFramebuffer");this.multisample=constants.MSAA_QUALITY.NONE}Object.defineProperty(Framebuffer.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0});Framebuffer.prototype.addColorTexture=function(index,
texture){void 0===index&&(index=0);this.colorTextures[index]=texture||new BaseTexture(null,{scaleMode:constants.SCALE_MODES.NEAREST,resolution:1,mipmap:constants.MIPMAP_MODES.OFF,width:this.width,height:this.height});this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.addDepthTexture=function(texture){this.depthTexture=texture||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:constants.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,
mipmap:constants.MIPMAP_MODES.OFF,format:constants.FORMATS.DEPTH_COMPONENT,type:constants.TYPES.UNSIGNED_SHORT});this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.enableDepth=function(){this.depth=!0;this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.enableStencil=function(){this.stencil=!0;this.dirtyId++;this.dirtyFormat++;return this};Framebuffer.prototype.resize=function(width,height){width=Math.round(width);height=Math.round(height);if(width!==this.width||
height!==this.height){this.width=width;this.height=height;this.dirtyId++;this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var texture=this.colorTextures[i],resolution=texture.resolution;texture.setSize(width/resolution,height/resolution)}this.depthTexture&&(resolution=this.depthTexture.resolution,this.depthTexture.setSize(width/resolution,height/resolution))}};Framebuffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)};Framebuffer.prototype.destroyDepthTexture=function(){this.depthTexture&&
(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)};return Framebuffer}(),BaseRenderTexture=function(_super){function BaseRenderTexture(options,JSCompiler_OptimizeArgumentsArray_p4,JSCompiler_OptimizeArgumentsArray_p5,JSCompiler_OptimizeArgumentsArray_p6){"number"===typeof options&&(options={width:options,height:JSCompiler_OptimizeArgumentsArray_p4,scaleMode:JSCompiler_OptimizeArgumentsArray_p5,resolution:JSCompiler_OptimizeArgumentsArray_p6});options.width=options.width||
100;options.height=options.height||100;options.multisample=void 0!==options.multisample?options.multisample:constants.MSAA_QUALITY.NONE;JSCompiler_OptimizeArgumentsArray_p4=_super.call(this,null,options)||this;JSCompiler_OptimizeArgumentsArray_p4.mipmap=constants.MIPMAP_MODES.OFF;JSCompiler_OptimizeArgumentsArray_p4.valid=!0;JSCompiler_OptimizeArgumentsArray_p4.clearColor=[0,0,0,0];JSCompiler_OptimizeArgumentsArray_p4.framebuffer=(new Framebuffer(JSCompiler_OptimizeArgumentsArray_p4.realWidth,JSCompiler_OptimizeArgumentsArray_p4.realHeight)).addColorTexture(0,
JSCompiler_OptimizeArgumentsArray_p4);JSCompiler_OptimizeArgumentsArray_p4.framebuffer.multisample=options.multisample;JSCompiler_OptimizeArgumentsArray_p4.maskStack=[];JSCompiler_OptimizeArgumentsArray_p4.filterStack=[{}];return JSCompiler_OptimizeArgumentsArray_p4}__extends(BaseRenderTexture,_super);BaseRenderTexture.prototype.resize=function(desiredWidth,desiredHeight){this.framebuffer.resize(desiredWidth*this.resolution,desiredHeight*this.resolution);this.setRealSize(this.framebuffer.width,this.framebuffer.height)};
BaseRenderTexture.prototype.dispose=function(){this.framebuffer.dispose();_super.prototype.dispose.call(this)};BaseRenderTexture.prototype.destroy=function(){_super.prototype.destroy.call(this);this.framebuffer.destroyDepthTexture();this.framebuffer=null};return BaseRenderTexture}(BaseTexture),TextureUvs=function(){function TextureUvs(){this.y0=this.x0=0;this.x1=1;this.y1=0;this.y2=this.x2=1;this.x3=0;this.y3=1;this.uvsFloat32=new Float32Array(8)}TextureUvs.prototype.set=function(frame,baseFrame,
rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){baseFrame=frame.width/2/tw;var h2=frame.height/2/th;tw=frame.x/tw+baseFrame;frame=frame.y/th+h2;rotate=math.groupD8.add(rotate,math.groupD8.NW);this.x0=tw+baseFrame*math.groupD8.uX(rotate);this.y0=frame+h2*math.groupD8.uY(rotate);rotate=math.groupD8.add(rotate,2);this.x1=tw+baseFrame*math.groupD8.uX(rotate);this.y1=frame+h2*math.groupD8.uY(rotate);rotate=math.groupD8.add(rotate,2);this.x2=tw+baseFrame*math.groupD8.uX(rotate);this.y2=frame+
h2*math.groupD8.uY(rotate);rotate=math.groupD8.add(rotate,2);this.x3=tw+baseFrame*math.groupD8.uX(rotate);this.y3=frame+h2*math.groupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th;this.uvsFloat32[0]=this.x0;this.uvsFloat32[1]=this.y0;this.uvsFloat32[2]=this.x1;this.uvsFloat32[3]=this.y1;this.uvsFloat32[4]=this.x2;this.uvsFloat32[5]=
this.y2;this.uvsFloat32[6]=this.x3;this.uvsFloat32[7]=this.y3};TextureUvs.prototype.toString=function(){return"[@pixi/core:TextureUvs x0\x3d"+(this.x0+" y0\x3d"+this.y0+" x1\x3d")+(this.x1+" y1\x3d"+this.y1+" x2\x3d"+this.x2+" y2\x3d")+(this.y2+" x3\x3d"+this.x3+" y3\x3d"+this.y3)+"]"};return TextureUvs}(),DEFAULT_UVS=new TextureUvs,Texture=function(_super){function Texture(baseTexture,frame,orig,trim,rotate,anchor){var _this=_super.call(this)||this;_this.noFrame=!1;frame||(_this.noFrame=!0,frame=
new math.Rectangle(0,0,1,1));baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture);_this.baseTexture=baseTexture;_this._frame=frame;_this.trim=trim;_this.valid=!1;_this._uvs=DEFAULT_UVS;_this.uvMatrix=null;_this.orig=orig||frame;_this._rotate=Number(rotate||0);if(!0===rotate)_this._rotate=2;else if(0!==_this._rotate%2)throw Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");_this.defaultAnchor=anchor?new math.Point(anchor.x,anchor.y):new math.Point(0,
0);_this._updateID=0;_this.textureCacheIds=[];if(baseTexture.valid)if(_this.noFrame){if(baseTexture.valid)_this.onBaseTextureUpdated(baseTexture)}else _this.frame=frame;else baseTexture.once("loaded",_this.onBaseTextureUpdated,_this);if(_this.noFrame)baseTexture.on("update",_this.onBaseTextureUpdated,_this);return _this}__extends(Texture,_super);Texture.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()};Texture.prototype.onBaseTextureUpdated=function(baseTexture){if(this.noFrame){if(!this.baseTexture.valid)return;
this._frame.width=baseTexture.width;this._frame.height=baseTexture.height;this.valid=!0;this.updateUvs()}else this.frame=this._frame;this.emit("update",this)};Texture.prototype.destroy=function(destroyBase){this.baseTexture&&(destroyBase&&((destroyBase=this.baseTexture.resource)&&destroyBase.url&&utils.TextureCache[destroyBase.url]&&Texture.removeFromCache(destroyBase.url),this.baseTexture.destroy()),this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,
this),this.baseTexture=null);this.orig=this.trim=this._uvs=this._frame=null;this.valid=!1;Texture.removeFromCache(this);this.textureCacheIds=null};Texture.prototype.clone=function(){var clonedFrame=this._frame.clone(),clonedOrig=this._frame===this.orig?clonedFrame:this.orig.clone();clonedOrig=new Texture(this.baseTexture,!this.noFrame&&clonedFrame,clonedOrig,this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor);this.noFrame&&(clonedOrig._frame=clonedFrame);return clonedOrig};Texture.prototype.updateUvs=
function(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs);this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++};Texture.from=function(source,options,strict){void 0===options&&(options={});void 0===strict&&(strict=settings.settings.STRICT_TEXTURE_CACHE);var isFrame="string"===typeof source;if(isFrame)var cacheId=source;else source instanceof BaseTexture?(source.cacheId||(cacheId=options&&options.pixiIdPrefix||"pixiid",source.cacheId=cacheId+"-"+utils.uid(),BaseTexture.addToCache(source,
source.cacheId)),cacheId=source.cacheId):(source._pixiId||(cacheId=options&&options.pixiIdPrefix||"pixiid",source._pixiId=cacheId+"_"+utils.uid()),cacheId=source._pixiId);var texture=utils.TextureCache[cacheId];if(isFrame&&strict&&!texture)throw Error('The cacheId "'+cacheId+'" does not exist in TextureCache.');texture||source instanceof BaseTexture?!texture&&source instanceof BaseTexture&&(texture=new Texture(source),Texture.addToCache(texture,cacheId)):(options.resolution||(options.resolution=utils.getResolutionOfUrl(source)),
texture=new Texture(new BaseTexture(source,options)),texture.baseTexture.cacheId=cacheId,BaseTexture.addToCache(texture.baseTexture,cacheId),Texture.addToCache(texture,cacheId));return texture};Texture.fromURL=function(url,options){var resourceOptions=Object.assign({autoLoad:!1},null===options||void 0===options?void 0:options.resourceOptions),texture=Texture.from(url,Object.assign({resourceOptions},options),!1);url=texture.baseTexture.resource;return texture.baseTexture.valid?Promise.resolve(texture):
url.load().then(function(){return Promise.resolve(texture)})};Texture.fromBuffer=function(buffer,width,height,options){return new Texture(BaseTexture.fromBuffer(buffer,width,height,options))};Texture.fromLoader=function(source,imageUrl,name,options){source=new BaseTexture(source,Object.assign({scaleMode:settings.settings.SCALE_MODE,resolution:utils.getResolutionOfUrl(imageUrl)},options));options=source.resource;options instanceof ImageResource&&(options.url=imageUrl);var texture=new Texture(source);
name||=imageUrl;BaseTexture.addToCache(texture.baseTexture,name);Texture.addToCache(texture,name);name!==imageUrl&&(BaseTexture.addToCache(texture.baseTexture,imageUrl),Texture.addToCache(texture,imageUrl));return texture.baseTexture.valid?Promise.resolve(texture):new Promise(function(resolve){texture.baseTexture.once("loaded",function(){return resolve(texture)})})};Texture.addToCache=function(texture,id){id&&(-1===texture.textureCacheIds.indexOf(id)&&texture.textureCacheIds.push(id),utils.TextureCache[id]&&
console.warn("Texture added to the cache with an id ["+id+"] that already had an entry"),utils.TextureCache[id]=texture)};Texture.removeFromCache=function(texture){if("string"===typeof texture){var textureFromCache=utils.TextureCache[texture];if(textureFromCache){var index=textureFromCache.textureCacheIds.indexOf(texture);-1<index&&textureFromCache.textureCacheIds.splice(index,1);delete utils.TextureCache[texture];return textureFromCache}}else if(texture&&texture.textureCacheIds){for(textureFromCache=
0;textureFromCache<texture.textureCacheIds.length;++textureFromCache)utils.TextureCache[texture.textureCacheIds[textureFromCache]]===texture&&delete utils.TextureCache[texture.textureCacheIds[textureFromCache]];texture.textureCacheIds.length=0;return texture}return null};Object.defineProperty(Texture.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0});Object.defineProperty(Texture.prototype,"frame",{get:function(){return this._frame},set:function(frame){this._frame=
frame;this.noFrame=!1;var x=frame.x,y=frame.y,width=frame.width,height=frame.height,xNotFit=x+width>this.baseTexture.width,yNotFit=y+height>this.baseTexture.height;if(xNotFit||yNotFit)throw Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+(x+" + "+width+" \x3d "+(x+width)+" \x3e "+this.baseTexture.width+" "+(xNotFit&&yNotFit?"and":"or")+" Y: "+(y+" + "+height+" \x3d "+(y+height)+" \x3e "+this.baseTexture.height)));this.valid=width&&height&&this.baseTexture.valid;this.trim||
this.rotate||(this.orig=frame);this.valid&&this.updateUvs()},enumerable:!1,configurable:!0});Object.defineProperty(Texture.prototype,"rotate",{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate;this.valid&&this.updateUvs()},enumerable:!1,configurable:!0});Object.defineProperty(Texture.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0});Object.defineProperty(Texture.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,
configurable:!0});Texture.prototype.castToBaseTexture=function(){return this.baseTexture};return Texture}(utils.EventEmitter);Texture.EMPTY=new Texture(new BaseTexture);removeAllHandlers(Texture.EMPTY);removeAllHandlers(Texture.EMPTY.baseTexture);Texture.WHITE=function(){var canvas=document.createElement("canvas");canvas.width=16;canvas.height=16;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,16,16);return new Texture(new BaseTexture(new CanvasResource(canvas)))}();
removeAllHandlers(Texture.WHITE);removeAllHandlers(Texture.WHITE.baseTexture);var RenderTexture=function(_super){function RenderTexture(baseRenderTexture,frame){baseRenderTexture=_super.call(this,baseRenderTexture,frame)||this;baseRenderTexture.valid=!0;baseRenderTexture.filterFrame=null;baseRenderTexture.filterPoolKey=null;baseRenderTexture.updateUvs();return baseRenderTexture}__extends(RenderTexture,_super);Object.defineProperty(RenderTexture.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},
enumerable:!1,configurable:!0});Object.defineProperty(RenderTexture.prototype,"multisample",{get:function(){return this.framebuffer.multisample},set:function(value){this.framebuffer.multisample=value},enumerable:!1,configurable:!0});RenderTexture.prototype.resize=function(desiredWidth,desiredHeight,resizeBaseTexture){void 0===resizeBaseTexture&&(resizeBaseTexture=!0);var resolution=this.baseTexture.resolution;desiredWidth=Math.round(desiredWidth*resolution)/resolution;desiredHeight=Math.round(desiredHeight*
resolution)/resolution;this.valid=0<desiredWidth&&0<desiredHeight;this._frame.width=this.orig.width=desiredWidth;this._frame.height=this.orig.height=desiredHeight;resizeBaseTexture&&this.baseTexture.resize(desiredWidth,desiredHeight);this.updateUvs()};RenderTexture.prototype.setResolution=function(resolution){var baseTexture=this.baseTexture;baseTexture.resolution!==resolution&&(baseTexture.setResolution(resolution),this.resize(baseTexture.width,baseTexture.height,!1))};RenderTexture.create=function(options){for(var arguments$1=
arguments,rest=[],_i=1;_i<arguments.length;_i++)rest[_i-1]=arguments$1[_i];"number"===typeof options&&(utils.deprecation("6.0.0","Arguments (width, height, scaleMode, resolution) have been deprecated."),options={width:options,height:rest[0],scaleMode:rest[1],resolution:rest[2]});return new RenderTexture(new BaseRenderTexture(options))};return RenderTexture}(Texture),RenderTexturePool=function(){function RenderTexturePool(textureOptions){this.texturePool={};this.textureOptions=textureOptions||{};this.enableFullScreen=
!1;this._pixelsHeight=this._pixelsWidth=0}RenderTexturePool.prototype.createTexture=function(realWidth,realHeight,multisample){void 0===multisample&&(multisample=constants.MSAA_QUALITY.NONE);realWidth=new BaseRenderTexture(Object.assign({width:realWidth,height:realHeight,resolution:1,multisample},this.textureOptions));return new RenderTexture(realWidth)};RenderTexturePool.prototype.getOptimalTexture=function(minWidth,minHeight,resolution,multisample){void 0===resolution&&(resolution=1);void 0===multisample&&
(multisample=constants.MSAA_QUALITY.NONE);minWidth=Math.ceil(minWidth*resolution);minHeight=Math.ceil(minHeight*resolution);if(this.enableFullScreen&&minWidth===this._pixelsWidth&&minHeight===this._pixelsHeight)var key=1<multisample?-multisample:-1;else minWidth=utils.nextPow2(minWidth),minHeight=utils.nextPow2(minHeight),key=((minWidth&65535)<<16|minHeight&65535)>>>0,1<multisample&&(key+=4294967296*multisample);this.texturePool[key]||(this.texturePool[key]=[]);var renderTexture=this.texturePool[key].pop();
renderTexture||=this.createTexture(minWidth,minHeight,multisample);renderTexture.filterPoolKey=key;renderTexture.setResolution(resolution);return renderTexture};RenderTexturePool.prototype.getFilterTexture=function(input,resolution,multisample){resolution=this.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants.MSAA_QUALITY.NONE);resolution.filterFrame=input.filterFrame;return resolution};RenderTexturePool.prototype.returnTexture=function(renderTexture){var key=
renderTexture.filterPoolKey;renderTexture.filterFrame=null;this.texturePool[key].push(renderTexture)};RenderTexturePool.prototype.returnFilterTexture=function(renderTexture){this.returnTexture(renderTexture)};RenderTexturePool.prototype.clear=function(destroyTextures){if(!1!==destroyTextures)for(var i in this.texturePool)if(destroyTextures=this.texturePool[i])for(var j=0;j<destroyTextures.length;j++)destroyTextures[j].destroy(!0);this.texturePool={}};RenderTexturePool.prototype.setScreenSize=function(size){if(size.width!==
this._pixelsWidth||size.height!==this._pixelsHeight){this.enableFullScreen=0<size.width&&0<size.height;for(var i in this.texturePool)if(0>Number(i)){var textures=this.texturePool[i];if(textures)for(var j=0;j<textures.length;j++)textures[j].destroy(!0);this.texturePool[i]=[]}this._pixelsWidth=size.width;this._pixelsHeight=size.height}};RenderTexturePool.SCREEN_KEY=-1;return RenderTexturePool}(),Attribute=function(){function Attribute(buffer,size,normalized,type,stride,start,instance){void 0===size&&
(size=0);void 0===normalized&&(normalized=!1);void 0===type&&(type=constants.TYPES.FLOAT);this.buffer=buffer;this.size=size;this.normalized=normalized;this.type=type;this.stride=stride;this.start=start;this.instance=instance}Attribute.prototype.destroy=function(){this.buffer=null};Attribute.from=function(buffer,size,normalized,type,stride){return new Attribute(buffer,size,normalized,type,stride)};return Attribute}(),UID=0,Buffer$jscomp$0=function(){function Buffer(data,_static,index){void 0===_static&&
(_static=!0);void 0===index&&(index=!1);this.data=data||new Float32Array(1);this._glBuffers={};this._updateID=0;this.index=index;this.static=_static;this.id=UID++;this.disposeRunner=new runner.Runner("disposeBuffer")}Buffer.prototype.update=function(data){data instanceof Array&&(data=new Float32Array(data));this.data=data||this.data;this._updateID++};Buffer.prototype.dispose=function(){this.disposeRunner.emit(this,!1)};Buffer.prototype.destroy=function(){this.dispose();this.data=null};Object.defineProperty(Buffer.prototype,
"index",{get:function(){return this.type===constants.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER},set:function(value){this.type=value?constants.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:constants.BUFFER_TYPE.ARRAY_BUFFER},enumerable:!1,configurable:!0});Buffer.from=function(data){data instanceof Array&&(data=new Float32Array(data));return new Buffer(data)};return Buffer}(),map={Float32Array,Uint32Array,Int32Array,Uint8Array},byteSizeMap={5126:4,5123:2,5121:1},UID$1=0,map$1={Float32Array,Uint32Array,Int32Array,Uint8Array,
Uint16Array},Geometry=function(){function Geometry(buffers,attributes){void 0===buffers&&(buffers=[]);void 0===attributes&&(attributes={});this.buffers=buffers;this.indexBuffer=null;this.attributes=attributes;this.glVertexArrayObjects={};this.id=UID$1++;this.instanced=!1;this.instanceCount=1;this.disposeRunner=new runner.Runner("disposeGeometry");this.refCount=0}Geometry.prototype.addAttribute=function(id,buffer,size,normalized,type,stride,start,instance){void 0===size&&(size=0);void 0===normalized&&
(normalized=!1);void 0===instance&&(instance=!1);if(!buffer)throw Error("You must pass a buffer when creating an attribute");buffer instanceof Buffer$jscomp$0||(buffer instanceof Array&&(buffer=new Float32Array(buffer)),buffer=new Buffer$jscomp$0(buffer));var ids=id.split("|");if(1<ids.length){for(id=0;id<ids.length;id++)this.addAttribute(ids[id],buffer,size,normalized,type);return this}ids=this.buffers.indexOf(buffer);-1===ids&&(this.buffers.push(buffer),ids=this.buffers.length-1);this.attributes[id]=
new Attribute(ids,size,normalized,type,stride,start,instance);this.instanced=this.instanced||instance;return this};Geometry.prototype.getAttribute=function(id){return this.attributes[id]};Geometry.prototype.getBuffer=function(id){return this.buffers[this.getAttribute(id).buffer]};Geometry.prototype.addIndex=function(buffer){buffer instanceof Buffer$jscomp$0||(buffer instanceof Array&&(buffer=new Uint16Array(buffer)),buffer=new Buffer$jscomp$0(buffer));buffer.type=constants.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;
this.indexBuffer=buffer;-1===this.buffers.indexOf(buffer)&&this.buffers.push(buffer);return this};Geometry.prototype.getIndex=function(){return this.indexBuffer};Geometry.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var arrays=[],sizes=[],interleavedBuffer=new Buffer$jscomp$0;for(i in this.attributes){var attribute=this.attributes[i];arrays.push(this.buffers[attribute.buffer].data);sizes.push(attribute.size*byteSizeMap[attribute.type]/
4);attribute.buffer=0}var outSize=0;var i=0;attribute={};for(var i$jscomp$0=0;i$jscomp$0<arrays.length;i$jscomp$0++)i+=sizes[i$jscomp$0],outSize+=arrays[i$jscomp$0].length;outSize=new ArrayBuffer(4*outSize);var littleOffset=0;for(i$jscomp$0=0;i$jscomp$0<arrays.length;i$jscomp$0++){var size=sizes[i$jscomp$0],array=arrays[i$jscomp$0];var out=utils.getBufferType(array);attribute[out]||(attribute[out]=new map[out](outSize));out=attribute[out];for(var j=0;j<array.length;j++)out[(j/size|0)*i+littleOffset+
j%size]=array[j];littleOffset+=size}arrays=new Float32Array(outSize);interleavedBuffer.data=arrays;for(i=0;i<this.buffers.length;i++)this.buffers[i]!==this.indexBuffer&&this.buffers[i].destroy();this.buffers=[interleavedBuffer];this.indexBuffer&&this.buffers.push(this.indexBuffer);return this};Geometry.prototype.getSize=function(){for(var i in this.attributes)return i=this.attributes[i],this.buffers[i.buffer].data.length/(i.stride/4||i.size);return 0};Geometry.prototype.dispose=function(){this.disposeRunner.emit(this,
!1)};Geometry.prototype.destroy=function(){this.dispose();this.attributes=this.indexBuffer=this.buffers=null};Geometry.prototype.clone=function(){for(var geometry=new Geometry,i=0;i<this.buffers.length;i++)geometry.buffers[i]=new Buffer$jscomp$0(this.buffers[i].data.slice(0));for(i in this.attributes){var attrib=this.attributes[i];geometry.attributes[i]=new Attribute(attrib.buffer,attrib.size,attrib.normalized,attrib.type,attrib.stride,attrib.start,attrib.instance)}this.indexBuffer&&(geometry.indexBuffer=
geometry.buffers[this.buffers.indexOf(this.indexBuffer)],geometry.indexBuffer.type=constants.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER);return geometry};Geometry.merge=function(geometries){for(var geometryOut=new Geometry,arrays=[],sizes=[],offsets=[],geometry,i=0;i<geometries.length;i++){geometry=geometries[i];for(var j=0;j<geometry.buffers.length;j++)sizes[j]=sizes[j]||0,sizes[j]+=geometry.buffers[j].data.length,offsets[j]=0}for(i=0;i<geometry.buffers.length;i++)arrays[i]=new (map$1[utils.getBufferType(geometry.buffers[i].data)])(sizes[i]),
geometryOut.buffers[i]=new Buffer$jscomp$0(arrays[i]);for(i=0;i<geometries.length;i++)for(geometry=geometries[i],j=0;j<geometry.buffers.length;j++)arrays[j].set(geometry.buffers[j].data,offsets[j]),offsets[j]+=geometry.buffers[j].data.length;geometryOut.attributes=geometry.attributes;if(geometry.indexBuffer){geometryOut.indexBuffer=geometryOut.buffers[geometry.buffers.indexOf(geometry.indexBuffer)];geometryOut.indexBuffer.type=constants.BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;var bufferIndexToCount=offsets=
sizes=arrays=0;for(i=0;i<geometry.buffers.length;i++)if(geometry.buffers[i]!==geometry.indexBuffer){bufferIndexToCount=i;break}for(i in geometry.attributes)j=geometry.attributes[i],(j.buffer|0)===bufferIndexToCount&&(sizes+=j.size*byteSizeMap[j.type]/4);for(i=0;i<geometries.length;i++){geometry=geometries[i].indexBuffer.data;for(j=0;j<geometry.length;j++)geometryOut.indexBuffer.data[j+offsets]+=arrays;arrays+=geometries[i].buffers[bufferIndexToCount].data.length/sizes;offsets+=geometry.length}}return geometryOut};
return Geometry}(),Quad=function(_super){function Quad(){var _this=_super.call(this)||this;_this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]);return _this}__extends(Quad,_super);return Quad}(Geometry),QuadUv=function(_super){function QuadUv(){var _this=_super.call(this)||this;_this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);_this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);_this.vertexBuffer=new Buffer$jscomp$0(_this.vertices);_this.uvBuffer=new Buffer$jscomp$0(_this.uvs);
_this.addAttribute("aVertexPosition",_this.vertexBuffer).addAttribute("aTextureCoord",_this.uvBuffer).addIndex([0,1,2,0,2,3]);return _this}__extends(QuadUv,_super);QuadUv.prototype.map=function(targetTextureFrame,destinationFrame){var x=0,y=0;this.uvs[0]=x;this.uvs[1]=y;this.uvs[2]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[3]=y;this.uvs[4]=x+destinationFrame.width/targetTextureFrame.width;this.uvs[5]=y+destinationFrame.height/targetTextureFrame.height;this.uvs[6]=x;this.uvs[7]=y+
destinationFrame.height/targetTextureFrame.height;x=destinationFrame.x;y=destinationFrame.y;this.vertices[0]=x;this.vertices[1]=y;this.vertices[2]=x+destinationFrame.width;this.vertices[3]=y;this.vertices[4]=x+destinationFrame.width;this.vertices[5]=y+destinationFrame.height;this.vertices[6]=x;this.vertices[7]=y+destinationFrame.height;this.invalidate();return this};QuadUv.prototype.invalidate=function(){this.vertexBuffer._updateID++;this.uvBuffer._updateID++;return this};return QuadUv}(Geometry),
UID$2=0,UniformGroup=function(){function UniformGroup(uniforms,isStatic,isUbo){this.group=!0;this.syncUniforms={};this.dirtyId=0;this.id=UID$2++;this.static=!!isStatic;this.ubo=!!isUbo;uniforms instanceof Buffer$jscomp$0?(this.buffer=uniforms,this.buffer.type=constants.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=uniforms,this.ubo&&(this.buffer=new Buffer$jscomp$0(new Float32Array(1)),this.buffer.type=constants.BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}UniformGroup.prototype.update=
function(){this.dirtyId++;!this.autoManage&&this.buffer&&this.buffer.update()};UniformGroup.prototype.add=function(name,uniforms,_static){if(this.ubo)throw Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[name]=new UniformGroup(uniforms,_static)};UniformGroup.from=function(uniforms,_static,_ubo){return new UniformGroup(uniforms,_static,_ubo)};UniformGroup.uboFrom=function(uniforms,_static){return new UniformGroup(uniforms,null!==
_static&&void 0!==_static?_static:!0,!0)};return UniformGroup}(),FilterState=function(){function FilterState(){this.target=this.renderTexture=null;this.legacy=!1;this.resolution=1;this.multisample=constants.MSAA_QUALITY.NONE;this.sourceFrame=new math.Rectangle;this.destinationFrame=new math.Rectangle;this.bindingSourceFrame=new math.Rectangle;this.bindingDestinationFrame=new math.Rectangle;this.filters=[];this.transform=null}FilterState.prototype.clear=function(){this.renderTexture=this.filters=this.target=
null};return FilterState}(),tempPoints=[new math.Point,new math.Point,new math.Point,new math.Point],tempMatrix=new math.Matrix,FilterSystem=function(){function FilterSystem(renderer){this.renderer=renderer;this.defaultFilterStack=[{}];this.texturePool=new RenderTexturePool;this.texturePool.setScreenSize(renderer.view);this.statePool=[];this.quad=new Quad;this.quadUv=new QuadUv;this.tempRect=new math.Rectangle;this.activeState={};this.globalUniforms=new UniformGroup({outputFrame:new math.Rectangle,
inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0);this.useMaxPadding=this.forceClear=!1}FilterSystem.prototype.push=function(target,filters){for(var renderer=this.renderer,filterStack=this.defaultFilterStack,state=this.statePool.pop()||new FilterState,renderTextureSystem=this.renderer.renderTexture,resolution=filters[0].resolution,multisample=filters[0].multisample,padding=filters[0].padding,
autoFit=filters[0].autoFit,legacy=filters[0].legacy,i=1;i<filters.length;i++){var filter=filters[i];resolution=Math.min(resolution,filter.resolution);multisample=Math.min(multisample,filter.multisample);padding=this.useMaxPadding?Math.max(padding,filter.padding):padding+filter.padding;autoFit=autoFit&&filter.autoFit;legacy=legacy||filter.legacy}1===filterStack.length&&(this.defaultFilterStack[0].renderTexture=renderTextureSystem.current);filterStack.push(state);state.resolution=resolution;state.multisample=
multisample;state.legacy=legacy;state.target=target;state.sourceFrame.copyFrom(target.filterArea||target.getBounds(!0));state.sourceFrame.pad(padding);autoFit&&(target=this.tempRect.copyFrom(renderTextureSystem.sourceFrame),renderer.projection.transform&&this.transformAABB(tempMatrix.copyFrom(renderer.projection.transform).invert(),target),state.sourceFrame.fit(target));this.roundFrame(state.sourceFrame,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,
renderTextureSystem.destinationFrame,renderer.projection.transform);state.renderTexture=this.getOptimalFilterTexture(state.sourceFrame.width,state.sourceFrame.height,resolution,multisample);state.filters=filters;state.destinationFrame.width=state.renderTexture.width;state.destinationFrame.height=state.renderTexture.height;filters=this.tempRect;filters.x=0;filters.y=0;filters.width=state.sourceFrame.width;filters.height=state.sourceFrame.height;state.renderTexture.filterFrame=state.sourceFrame;state.bindingSourceFrame.copyFrom(renderTextureSystem.sourceFrame);
state.bindingDestinationFrame.copyFrom(renderTextureSystem.destinationFrame);state.transform=renderer.projection.transform;renderer.projection.transform=null;renderTextureSystem.bind(state.renderTexture,state.sourceFrame,filters);renderer.framebuffer.clear(0,0,0,0)};FilterSystem.prototype.pop=function(){var filterStack=this.defaultFilterStack,state=filterStack.pop(),filters=state.filters;this.activeState=state;var globalUniforms=this.globalUniforms.uniforms;globalUniforms.outputFrame=state.sourceFrame;
globalUniforms.resolution=state.resolution;var inputSize=globalUniforms.inputSize,inputPixel=globalUniforms.inputPixel,inputClamp=globalUniforms.inputClamp;inputSize[0]=state.destinationFrame.width;inputSize[1]=state.destinationFrame.height;inputSize[2]=1/inputSize[0];inputSize[3]=1/inputSize[1];inputPixel[0]=Math.round(inputSize[0]*state.resolution);inputPixel[1]=Math.round(inputSize[1]*state.resolution);inputPixel[2]=1/inputPixel[0];inputPixel[3]=1/inputPixel[1];inputClamp[0]=.5*inputPixel[2];inputClamp[1]=
.5*inputPixel[3];inputClamp[2]=state.sourceFrame.width*inputSize[2]-.5*inputPixel[2];inputClamp[3]=state.sourceFrame.height*inputSize[3]-.5*inputPixel[3];state.legacy&&(inputSize=globalUniforms.filterArea,inputSize[0]=state.destinationFrame.width,inputSize[1]=state.destinationFrame.height,inputSize[2]=state.sourceFrame.x,inputSize[3]=state.sourceFrame.y,globalUniforms.filterClamp=globalUniforms.inputClamp);this.globalUniforms.update();filterStack=filterStack[filterStack.length-1];this.renderer.framebuffer.blit();
if(1===filters.length)filters[0].apply(this,state.renderTexture,filterStack.renderTexture,constants.CLEAR_MODES.BLEND,state),this.returnFilterTexture(state.renderTexture);else{globalUniforms=state.renderTexture;inputSize=this.getOptimalFilterTexture(globalUniforms.width,globalUniforms.height,state.resolution);inputSize.filterFrame=globalUniforms.filterFrame;for(inputPixel=0;inputPixel<filters.length-1;++inputPixel)1===inputPixel&&1<state.multisample&&(inputSize=this.getOptimalFilterTexture(globalUniforms.width,
globalUniforms.height,state.resolution),inputSize.filterFrame=globalUniforms.filterFrame),filters[inputPixel].apply(this,globalUniforms,inputSize,constants.CLEAR_MODES.CLEAR,state),inputClamp=globalUniforms,globalUniforms=inputSize,inputSize=inputClamp;filters[inputPixel].apply(this,globalUniforms,filterStack.renderTexture,constants.CLEAR_MODES.BLEND,state);1<inputPixel&&1<state.multisample&&this.returnFilterTexture(state.renderTexture);this.returnFilterTexture(globalUniforms);this.returnFilterTexture(inputSize)}state.clear();
this.statePool.push(state)};FilterSystem.prototype.bindAndClear=function(filterTexture,clearMode){void 0===clearMode&&(clearMode=constants.CLEAR_MODES.CLEAR);var _a=this.renderer,renderTextureSystem=_a.renderTexture;_a=_a.state;this.renderer.projection.transform=filterTexture===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.activeState.transform:null;if(filterTexture&&filterTexture.filterFrame){var destinationFrame=this.tempRect;destinationFrame.x=0;destinationFrame.y=
0;destinationFrame.width=filterTexture.filterFrame.width;destinationFrame.height=filterTexture.filterFrame.height;renderTextureSystem.bind(filterTexture,filterTexture.filterFrame,destinationFrame)}else filterTexture!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?renderTextureSystem.bind(filterTexture):this.renderer.renderTexture.bind(filterTexture,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);filterTexture=_a.stateId&1||this.forceClear;(clearMode===
constants.CLEAR_MODES.CLEAR||clearMode===constants.CLEAR_MODES.BLIT&&filterTexture)&&this.renderer.framebuffer.clear(0,0,0,0)};FilterSystem.prototype.applyFilter=function(filter,input,output,clearMode){var renderer=this.renderer;renderer.state.set(filter.state);this.bindAndClear(output,clearMode);filter.uniforms.uSampler=input;filter.uniforms.filterGlobals=this.globalUniforms;renderer.shader.bind(filter);filter.legacy=!!filter.program.attributeData.aTextureCoord;filter.legacy?(this.quadUv.map(input._frame,
input.filterFrame),renderer.geometry.bind(this.quadUv),renderer.geometry.draw(constants.DRAW_MODES.TRIANGLES)):(renderer.geometry.bind(this.quad),renderer.geometry.draw(constants.DRAW_MODES.TRIANGLE_STRIP))};FilterSystem.prototype.calculateSpriteMatrix=function(outputMatrix,sprite){var _a=this.activeState,sourceFrame=_a.sourceFrame,destinationFrame=_a.destinationFrame;_a=sprite._texture.orig;outputMatrix=outputMatrix.set(destinationFrame.width,0,0,destinationFrame.height,sourceFrame.x,sourceFrame.y);
sourceFrame=sprite.worldTransform.copyTo(math.Matrix.TEMP_MATRIX);sourceFrame.invert();outputMatrix.prepend(sourceFrame);outputMatrix.scale(1/_a.width,1/_a.height);outputMatrix.translate(sprite.anchor.x,sprite.anchor.y);return outputMatrix};FilterSystem.prototype.destroy=function(){this.renderer=null;this.texturePool.clear(!1)};FilterSystem.prototype.getOptimalFilterTexture=function(minWidth,minHeight,resolution,multisample){void 0===resolution&&(resolution=1);void 0===multisample&&(multisample=constants.MSAA_QUALITY.NONE);
return this.texturePool.getOptimalTexture(minWidth,minHeight,resolution,multisample)};FilterSystem.prototype.getFilterTexture=function(input,resolution,multisample){if("number"===typeof input){var swap=input;input=resolution;resolution=swap}input=input||this.activeState.renderTexture;resolution=this.texturePool.getOptimalTexture(input.width,input.height,resolution||input.resolution,multisample||constants.MSAA_QUALITY.NONE);resolution.filterFrame=input.filterFrame;return resolution};FilterSystem.prototype.returnFilterTexture=
function(renderTexture){this.texturePool.returnTexture(renderTexture)};FilterSystem.prototype.emptyPool=function(){this.texturePool.clear(!0)};FilterSystem.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)};FilterSystem.prototype.transformAABB=function(matrix,rect){var lt=tempPoints[0],lb=tempPoints[1],rt=tempPoints[2],rb=tempPoints[3];lt.set(rect.left,rect.top);lb.set(rect.left,rect.bottom);rt.set(rect.right,rect.top);rb.set(rect.right,rect.bottom);matrix.apply(lt,lt);
matrix.apply(lb,lb);matrix.apply(rt,rt);matrix.apply(rb,rb);matrix=Math.min(lt.x,lb.x,rt.x,rb.x);var y0=Math.min(lt.y,lb.y,rt.y,rb.y),x1=Math.max(lt.x,lb.x,rt.x,rb.x);lt=Math.max(lt.y,lb.y,rt.y,rb.y);rect.x=matrix;rect.y=y0;rect.width=x1-matrix;rect.height=lt-y0};FilterSystem.prototype.roundFrame=function(frame,resolution,bindingSourceFrame,bindingDestinationFrame,transform){if(transform){var a=transform.a,c=transform.c,d=transform.d;if((1E-4<Math.abs(transform.b)||1E-4<Math.abs(c))&&(1E-4<Math.abs(a)||
1E-4<Math.abs(d)))return}transform=transform?tempMatrix.copyFrom(transform):tempMatrix.identity();transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y);this.transformAABB(transform,frame);frame.ceil(resolution);this.transformAABB(transform.invert(),frame)};return FilterSystem}(),ObjectRenderer=function(){function ObjectRenderer(renderer){this.renderer=
renderer}ObjectRenderer.prototype.flush=function(){};ObjectRenderer.prototype.destroy=function(){this.renderer=null};ObjectRenderer.prototype.start=function(){};ObjectRenderer.prototype.stop=function(){this.flush()};ObjectRenderer.prototype.render=function(_object){};return ObjectRenderer}(),BatchSystem=function(){function BatchSystem(renderer){this.renderer=renderer;this.currentRenderer=this.emptyRenderer=new ObjectRenderer(renderer)}BatchSystem.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==
objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())};BatchSystem.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)};BatchSystem.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)};BatchSystem.prototype.copyBoundTextures=function(arr,maxTextures){var boundTextures=this.renderer.texture.boundTextures;for(--maxTextures;0<=maxTextures;--maxTextures)arr[maxTextures]=boundTextures[maxTextures]||null,arr[maxTextures]&&
(arr[maxTextures]._batchLocation=maxTextures)};BatchSystem.prototype.boundArray=function(texArray,boundTextures,batchId,maxTextures){var elements=texArray.elements,ids=texArray.ids;texArray=texArray.count;for(var j=0,i=0;i<texArray;i++){var tex=elements[i],loc=tex._batchLocation;if(0<=loc&&loc<maxTextures&&boundTextures[loc]===tex)ids[i]=loc;else for(;j<maxTextures;)if((loc=boundTextures[j])&&loc._batchEnabled===batchId&&loc._batchLocation===j)j++;else{ids[i]=j;tex._batchLocation=j;boundTextures[j]=
tex;break}}};BatchSystem.prototype.destroy=function(){this.renderer=null};return BatchSystem}(),CONTEXT_UID_COUNTER=0,ContextSystem=function(){function ContextSystem(renderer){this.renderer=renderer;this.webGLVersion=1;this.extensions={};this.supports={uint32Indices:!1};this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);renderer.view.addEventListener("webglcontextlost",this.handleContextLost,!1);renderer.view.addEventListener("webglcontextrestored",
this.handleContextRestored,!1)}Object.defineProperty(ContextSystem.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0});ContextSystem.prototype.contextChange=function(gl){this.gl=gl;this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++;gl.isContextLost()&&gl.getExtension("WEBGL_lose_context")&&gl.getExtension("WEBGL_lose_context").restoreContext()};ContextSystem.prototype.initFromContext=function(gl){this.gl=gl;this.validateContext(gl);
this.renderer.gl=gl;this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++;this.renderer.runners.contextChange.emit(gl)};ContextSystem.prototype.initFromOptions=function(options){options=this.createContext(this.renderer.view,options);this.initFromContext(options)};ContextSystem.prototype.createContext=function(canvas,options){var gl;settings.settings.PREFER_ENV>=constants.ENV.WEBGL2&&(gl=canvas.getContext("webgl2",options));if(gl)this.webGLVersion=2;else if(this.webGLVersion=1,gl=canvas.getContext("webgl",
options)||canvas.getContext("experimental-webgl",options),!gl)throw Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=gl;this.getExtensions();return this.gl};ContextSystem.prototype.getExtensions=function(){var gl=this.gl,common={anisotropicFiltering:gl.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),
etc:gl.getExtension("WEBGL_compressed_texture_etc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:gl.getExtension("WEBGL_compressed_texture_atc"),astc:gl.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,common,{drawBuffers:gl.getExtension("WEBGL_draw_buffers"),depthTexture:gl.getExtension("WEBGL_depth_texture"),loseContext:gl.getExtension("WEBGL_lose_context"),
vertexArrayObject:gl.getExtension("OES_vertex_array_object")||gl.getExtension("MOZ_OES_vertex_array_object")||gl.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:gl.getExtension("OES_element_index_uint"),floatTexture:gl.getExtension("OES_texture_float"),floatTextureLinear:gl.getExtension("OES_texture_float_linear"),textureHalfFloat:gl.getExtension("OES_texture_half_float"),textureHalfFloatLinear:gl.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,
common,{colorBufferFloat:gl.getExtension("EXT_color_buffer_float")})};ContextSystem.prototype.handleContextLost=function(event){event.preventDefault()};ContextSystem.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)};ContextSystem.prototype.destroy=function(){var view=this.renderer.view;this.renderer=null;view.removeEventListener("webglcontextlost",this.handleContextLost);view.removeEventListener("webglcontextrestored",this.handleContextRestored);this.gl.useProgram(null);
this.extensions.loseContext&&this.extensions.loseContext.loseContext()};ContextSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()};ContextSystem.prototype.validateContext=function(gl){var attributes=gl.getContextAttributes(),isWebGl2="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext;isWebGl2&&(this.webGLVersion=2);attributes.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");gl=
isWebGl2||!!gl.getExtension("OES_element_index_uint");(this.supports.uint32Indices=gl)||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")};return ContextSystem}(),GLFramebuffer=function(){return function(framebuffer){this.framebuffer=framebuffer;this.stencil=null;this.dirtySize=this.dirtyFormat=this.dirtyId=-1;this.multisample=constants.MSAA_QUALITY.NONE;this.blitFramebuffer=this.msaaBuffer=null;this.mipLevel=0}}(),tempRectangle=new math.Rectangle,
FramebufferSystem=function(){function FramebufferSystem(renderer){this.renderer=renderer;this.managedFramebuffers=[];this.unknownFramebuffer=new Framebuffer(10,10);this.msaaSamples=null}FramebufferSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.current=this.unknownFramebuffer;this.viewport=new math.Rectangle;this.writeDepthTexture=this.hasMRT=!0;this.disposeAll(!0);if(1===this.renderer.context.webGLVersion){var nativeDrawBuffersExtension_1=
this.renderer.context.extensions.drawBuffers,nativeDepthTextureExtension=this.renderer.context.extensions.depthTexture;settings.settings.PREFER_ENV===constants.ENV.WEBGL_LEGACY&&(nativeDepthTextureExtension=nativeDrawBuffersExtension_1=null);nativeDrawBuffersExtension_1?gl.drawBuffers=function(activeTextures){return nativeDrawBuffersExtension_1.drawBuffersWEBGL(activeTextures)}:(this.hasMRT=!1,gl.drawBuffers=function(){});nativeDepthTextureExtension||(this.writeDepthTexture=!1)}else this.msaaSamples=
gl.getInternalformatParameter(gl.RENDERBUFFER,gl.RGBA8,gl.SAMPLES)};FramebufferSystem.prototype.bind=function(framebuffer,frame,mipLevel){void 0===mipLevel&&(mipLevel=0);var gl=this.gl;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(framebuffer);this.current!==framebuffer&&(this.current=framebuffer,gl.bindFramebuffer(gl.FRAMEBUFFER,fbo.framebuffer));fbo.mipLevel!==mipLevel&&(framebuffer.dirtyId++,framebuffer.dirtyFormat++,fbo.mipLevel=mipLevel);fbo.dirtyId!==
framebuffer.dirtyId&&(fbo.dirtyId=framebuffer.dirtyId,fbo.dirtyFormat!==framebuffer.dirtyFormat?(fbo.dirtyFormat=framebuffer.dirtyFormat,fbo.dirtySize=framebuffer.dirtySize,this.updateFramebuffer(framebuffer,mipLevel)):fbo.dirtySize!==framebuffer.dirtySize&&(fbo.dirtySize=framebuffer.dirtySize,this.resizeFramebuffer(framebuffer)));for(gl=0;gl<framebuffer.colorTextures.length;gl++)fbo=framebuffer.colorTextures[gl],this.renderer.texture.unbind(fbo.parentTextureArray||fbo);framebuffer.depthTexture&&
this.renderer.texture.unbind(framebuffer.depthTexture);frame?(gl=frame.width>>mipLevel,framebuffer=frame.height>>mipLevel,mipLevel=gl/frame.width,this.setViewport(frame.x*mipLevel,frame.y*mipLevel,gl,framebuffer)):(gl=framebuffer.width>>mipLevel,framebuffer=framebuffer.height>>mipLevel,this.setViewport(0,0,gl,framebuffer))}else this.current&&(this.current=null,gl.bindFramebuffer(gl.FRAMEBUFFER,null)),frame?this.setViewport(frame.x,frame.y,frame.width,frame.height):this.setViewport(0,0,this.renderer.width,
this.renderer.height)};FramebufferSystem.prototype.setViewport=function(x,y,width,height){var v=this.viewport;x=Math.round(x);y=Math.round(y);width=Math.round(width);height=Math.round(height);if(v.width!==width||v.height!==height||v.x!==x||v.y!==y)v.x=x,v.y=y,v.width=width,v.height=height,this.gl.viewport(x,y,width,height)};Object.defineProperty(FramebufferSystem.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,
height:this.renderer.height}},enumerable:!1,configurable:!0});FramebufferSystem.prototype.clear=function(r,g,b,a,mask){void 0===mask&&(mask=constants.BUFFER_BITS.COLOR|constants.BUFFER_BITS.DEPTH);var gl=this.gl;gl.clearColor(r,g,b,a);gl.clear(mask)};FramebufferSystem.prototype.initFramebuffer=function(framebuffer){var fbo=new GLFramebuffer(this.gl.createFramebuffer());fbo.multisample=this.detectSamples(framebuffer.multisample);framebuffer.glFramebuffers[this.CONTEXT_UID]=fbo;this.managedFramebuffers.push(framebuffer);
framebuffer.disposeRunner.add(this);return fbo};FramebufferSystem.prototype.resizeFramebuffer=function(framebuffer){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];fbo.msaaBuffer&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height));fbo.stencil&&(gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,
gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height));fbo=framebuffer.colorTextures;var count=fbo.length;gl.drawBuffers||(count=Math.min(count,1));for(gl=0;gl<count;gl++){var texture=fbo[gl];this.renderer.texture.bind(texture.parentTextureArray||texture,0)}framebuffer.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(framebuffer.depthTexture,0)};FramebufferSystem.prototype.updateFramebuffer=
function(framebuffer,mipLevel){var gl=this.gl,fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],colorTextures=framebuffer.colorTextures,count=colorTextures.length;gl.drawBuffers||(count=Math.min(count,1));1<fbo.multisample&&this.canMultisampleFramebuffer(framebuffer)?(fbo.msaaBuffer=fbo.msaaBuffer||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.msaaBuffer),gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.RGBA8,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,
gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,fbo.msaaBuffer)):fbo.msaaBuffer&&(gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.msaaBuffer=null,fbo.blitFramebuffer&&(fbo.blitFramebuffer.dispose(),fbo.blitFramebuffer=null));for(var activeTextures=[],i=0;i<count;i++){var texture=colorTextures[i],parentTexture=texture.parentTextureArray||texture;this.renderer.texture.bind(parentTexture,0);0===i&&fbo.msaaBuffer||(gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0+i,texture.target,parentTexture._glTextures[this.CONTEXT_UID].texture,
mipLevel),activeTextures.push(gl.COLOR_ATTACHMENT0+i))}1<activeTextures.length&&gl.drawBuffers(activeTextures);framebuffer.depthTexture&&this.writeDepthTexture&&(colorTextures=framebuffer.depthTexture,this.renderer.texture.bind(colorTextures,0),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.TEXTURE_2D,colorTextures._glTextures[this.CONTEXT_UID].texture,mipLevel));!framebuffer.stencil&&!framebuffer.depth||framebuffer.depthTexture&&this.writeDepthTexture?fbo.stencil&&(gl.deleteRenderbuffer(fbo.stencil),
fbo.stencil=null):(fbo.stencil=fbo.stencil||gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,fbo.stencil),fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,framebuffer.width,framebuffer.height):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,framebuffer.width,framebuffer.height),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,fbo.stencil))};FramebufferSystem.prototype.canMultisampleFramebuffer=
function(framebuffer){return 1!==this.renderer.context.webGLVersion&&1>=framebuffer.colorTextures.length&&!framebuffer.depthTexture};FramebufferSystem.prototype.detectSamples=function(samples){var msaaSamples=this.msaaSamples,res=constants.MSAA_QUALITY.NONE;if(1>=samples||null===msaaSamples)return res;for(var i=0;i<msaaSamples.length;i++)if(msaaSamples[i]<=samples){res=msaaSamples[i];break}1===res&&(res=constants.MSAA_QUALITY.NONE);return res};FramebufferSystem.prototype.blit=function(framebuffer,
sourcePixels,destPixels){var current=this.current,gl=this.gl;if(2===this.renderer.context.webGLVersion&&current){var fbo=current.glFramebuffers[this.CONTEXT_UID];if(fbo){if(!framebuffer){if(!fbo.msaaBuffer)return;var colorTexture=current.colorTextures[0];if(!colorTexture)return;fbo.blitFramebuffer||(fbo.blitFramebuffer=new Framebuffer(current.width,current.height),fbo.blitFramebuffer.addColorTexture(0,colorTexture));framebuffer=fbo.blitFramebuffer;framebuffer.colorTextures[0]!==colorTexture&&(framebuffer.colorTextures[0]=
colorTexture,framebuffer.dirtyId++,framebuffer.dirtyFormat++);if(framebuffer.width!==current.width||framebuffer.height!==current.height)framebuffer.width=current.width,framebuffer.height=current.height,framebuffer.dirtyId++,framebuffer.dirtySize++}sourcePixels||(sourcePixels=tempRectangle,sourcePixels.width=current.width,sourcePixels.height=current.height);destPixels||=sourcePixels;current=sourcePixels.width===destPixels.width&&sourcePixels.height===destPixels.height;this.bind(framebuffer);gl.bindFramebuffer(gl.READ_FRAMEBUFFER,
fbo.framebuffer);gl.blitFramebuffer(sourcePixels.x,sourcePixels.y,sourcePixels.width,sourcePixels.height,destPixels.x,destPixels.y,destPixels.width,destPixels.height,gl.COLOR_BUFFER_BIT,current?gl.NEAREST:gl.LINEAR)}}};FramebufferSystem.prototype.disposeFramebuffer=function(framebuffer,contextLost){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID],gl=this.gl;if(fbo){delete framebuffer.glFramebuffers[this.CONTEXT_UID];var index=this.managedFramebuffers.indexOf(framebuffer);0<=index&&this.managedFramebuffers.splice(index,
1);framebuffer.disposeRunner.remove(this);contextLost||(gl.deleteFramebuffer(fbo.framebuffer),fbo.msaaBuffer&&gl.deleteRenderbuffer(fbo.msaaBuffer),fbo.stencil&&gl.deleteRenderbuffer(fbo.stencil));fbo.blitFramebuffer&&fbo.blitFramebuffer.dispose()}};FramebufferSystem.prototype.disposeAll=function(contextLost){var list=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<list.length;i++)this.disposeFramebuffer(list[i],contextLost)};FramebufferSystem.prototype.forceStencil=function(){var framebuffer=
this.current;if(framebuffer){var fbo=framebuffer.glFramebuffers[this.CONTEXT_UID];if(fbo&&!fbo.stencil){framebuffer.stencil=!0;var w=framebuffer.width;framebuffer=framebuffer.height;var gl=this.gl,stencil=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,stencil);fbo.msaaBuffer?gl.renderbufferStorageMultisample(gl.RENDERBUFFER,fbo.multisample,gl.DEPTH24_STENCIL8,w,framebuffer):gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,w,framebuffer);fbo.stencil=stencil;gl.framebufferRenderbuffer(gl.FRAMEBUFFER,
gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,stencil)}}};FramebufferSystem.prototype.reset=function(){this.current=this.unknownFramebuffer;this.viewport=new math.Rectangle};FramebufferSystem.prototype.destroy=function(){this.renderer=null};return FramebufferSystem}(),byteSizeMap$1={5126:4,5123:2,5121:1},GeometrySystem=function(){function GeometrySystem(renderer){this.renderer=renderer;this._activeVao=this._activeGeometry=null;this.hasInstance=this.hasVao=!0;this.canUseUInt32ElementIndex=!1;this.managedGeometries=
{}}GeometrySystem.prototype.contextChange=function(){this.disposeAll(!0);var gl=this.gl=this.renderer.gl,context=this.renderer.context;this.CONTEXT_UID=this.renderer.CONTEXT_UID;if(2!==context.webGLVersion){var nativeVaoExtension_1=this.renderer.context.extensions.vertexArrayObject;settings.settings.PREFER_ENV===constants.ENV.WEBGL_LEGACY&&(nativeVaoExtension_1=null);nativeVaoExtension_1?(gl.createVertexArray=function(){return nativeVaoExtension_1.createVertexArrayOES()},gl.bindVertexArray=function(vao){return nativeVaoExtension_1.bindVertexArrayOES(vao)},
gl.deleteVertexArray=function(vao){return nativeVaoExtension_1.deleteVertexArrayOES(vao)}):(this.hasVao=!1,gl.createVertexArray=function(){return null},gl.bindVertexArray=function(){return null},gl.deleteVertexArray=function(){return null})}if(2!==context.webGLVersion){var instanceExt_1=gl.getExtension("ANGLE_instanced_arrays");instanceExt_1?(gl.vertexAttribDivisor=function(a,b){return instanceExt_1.vertexAttribDivisorANGLE(a,b)},gl.drawElementsInstanced=function(a,b,c,d,e){return instanceExt_1.drawElementsInstancedANGLE(a,
b,c,d,e)},gl.drawArraysInstanced=function(a,b,c,d){return instanceExt_1.drawArraysInstancedANGLE(a,b,c,d)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===context.webGLVersion||!!context.extensions.uint32ElementIndex};GeometrySystem.prototype.bind=function(geometry,shader){shader=shader||this.renderer.shader.shader;var gl=this.gl,vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],incRefCount=!1;vaos||(this.managedGeometries[geometry.id]=geometry,geometry.disposeRunner.add(this),geometry.glVertexArrayObjects[this.CONTEXT_UID]=
vaos={},incRefCount=!0);vaos=vaos[shader.program.id]||this.initGeometryVao(geometry,shader,incRefCount);this._activeGeometry=geometry;this._activeVao!==vaos&&(this._activeVao=vaos,this.hasVao?gl.bindVertexArray(vaos):this.activateVao(geometry,shader.program));this.updateBuffers()};GeometrySystem.prototype.reset=function(){this.unbind()};GeometrySystem.prototype.updateBuffers=function(){for(var geometry=this._activeGeometry,bufferSystem=this.renderer.buffer,i=0;i<geometry.buffers.length;i++)bufferSystem.update(geometry.buffers[i])};
GeometrySystem.prototype.checkCompatibility=function(geometry,program){geometry=geometry.attributes;program=program.attributeData;for(var j in program)if(!geometry[j])throw Error('shader and geometry incompatible, geometry missing the "'+j+'" attribute');};GeometrySystem.prototype.getSignature=function(geometry,program){var attribs=geometry.attributes;program=program.attributeData;geometry=["g",geometry.id];for(var i in attribs)program[i]&&geometry.push(i);return geometry.join("-")};GeometrySystem.prototype.initGeometryVao=
function(geometry,shader,incRefCount){void 0===incRefCount&&(incRefCount=!0);var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,program=shader.program;program.glPrograms[CONTEXT_UID]||this.renderer.shader.generateProgram(shader);this.checkCompatibility(geometry,program);shader=this.getSignature(geometry,program);var vaoObjectHash=geometry.glVertexArrayObjects[this.CONTEXT_UID],vao=vaoObjectHash[shader];if(vao)return vaoObjectHash[program.id]=vao;var buffers=geometry.buffers;
vao=geometry.attributes;var tempStride={},tempStart={};for(j in buffers)tempStride[j]=0,tempStart[j]=0;for(j in vao)!vao[j].size&&program.attributeData[j]?vao[j].size=program.attributeData[j].size:vao[j].size||console.warn("PIXI Geometry attribute '"+j+"' size cannot be determined (likely the bound shader does not have the attribute)"),tempStride[vao[j].buffer]+=vao[j].size*byteSizeMap$1[vao[j].type];for(j in vao){var attribute=vao[j],attribSize=attribute.size;void 0===attribute.stride&&(attribute.stride=
tempStride[attribute.buffer]===attribSize*byteSizeMap$1[attribute.type]?0:tempStride[attribute.buffer]);void 0===attribute.start&&(attribute.start=tempStart[attribute.buffer],tempStart[attribute.buffer]+=attribSize*byteSizeMap$1[attribute.type])}vao=gl.createVertexArray();gl.bindVertexArray(vao);for(gl=0;gl<buffers.length;gl++){var j=buffers[gl];bufferSystem.bind(j);incRefCount&&j._glBuffers[CONTEXT_UID].refCount++}this.activateVao(geometry,program);this._activeVao=vao;vaoObjectHash[program.id]=vao;
return vaoObjectHash[shader]=vao};GeometrySystem.prototype.disposeGeometry=function(geometry,contextLost){var _a;if(this.managedGeometries[geometry.id]){delete this.managedGeometries[geometry.id];var vaos=geometry.glVertexArrayObjects[this.CONTEXT_UID],gl=this.gl,buffers=geometry.buffers,bufferSystem=null===(_a=this.renderer)||void 0===_a?void 0:_a.buffer;geometry.disposeRunner.remove(this);if(vaos){if(bufferSystem)for(_a=0;_a<buffers.length;_a++){var buf=buffers[_a]._glBuffers[this.CONTEXT_UID];
buf&&(buf.refCount--,0!==buf.refCount||contextLost||bufferSystem.dispose(buffers[_a],contextLost))}if(!contextLost)for(var vaoId in vaos)"g"===vaoId[0]&&(contextLost=vaos[vaoId],this._activeVao===contextLost&&this.unbind(),gl.deleteVertexArray(contextLost));delete geometry.glVertexArrayObjects[this.CONTEXT_UID]}}};GeometrySystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedGeometries),i=0;i<all.length;i++)this.disposeGeometry(this.managedGeometries[all[i]],contextLost)};
GeometrySystem.prototype.activateVao=function(geometry,program){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID,bufferSystem=this.renderer.buffer,buffers=geometry.buffers,attributes=geometry.attributes;geometry.indexBuffer&&bufferSystem.bind(geometry.indexBuffer);geometry=null;for(var j in attributes){var attribute=attributes[j],buffer=buffers[attribute.buffer],glBuffer=buffer._glBuffers[CONTEXT_UID];if(program.attributeData[j]&&(geometry!==glBuffer&&(bufferSystem.bind(buffer),geometry=glBuffer),buffer=
program.attributeData[j].location,gl.enableVertexAttribArray(buffer),gl.vertexAttribPointer(buffer,attribute.size,attribute.type||gl.FLOAT,attribute.normalized,attribute.stride,attribute.start),attribute.instance))if(this.hasInstance)gl.vertexAttribDivisor(buffer,1);else throw Error("geometry error, GPU Instancing is not supported on this device");}};GeometrySystem.prototype.draw=function(type,size,start,instanceCount){var gl=this.gl,geometry=this._activeGeometry;if(geometry.indexBuffer){var byteSize=
geometry.indexBuffer.data.BYTES_PER_ELEMENT,glType=2===byteSize?gl.UNSIGNED_SHORT:gl.UNSIGNED_INT;2===byteSize||4===byteSize&&this.canUseUInt32ElementIndex?geometry.instanced?gl.drawElementsInstanced(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize,instanceCount||1):gl.drawElements(type,size||geometry.indexBuffer.data.length,glType,(start||0)*byteSize):console.warn("unsupported index buffer type: uint32")}else geometry.instanced?gl.drawArraysInstanced(type,start,size||geometry.getSize(),
instanceCount||1):gl.drawArrays(type,start,size||geometry.getSize());return this};GeometrySystem.prototype.unbind=function(){this.gl.bindVertexArray(null);this._activeGeometry=this._activeVao=null};GeometrySystem.prototype.destroy=function(){this.renderer=null};return GeometrySystem}(),MaskData=function(){function MaskData(maskObject){void 0===maskObject&&(maskObject=null);this.type=constants.MASK_TYPES.NONE;this.autoDetect=!0;this.maskObject=maskObject||null;this.pooled=!1;this.isMaskData=!0;this.resolution=
null;this.multisample=settings.settings.FILTER_MULTISAMPLE;this.enabled=!0;this._filters=null;this._scissorCounter=this._stencilCounter=0;this._target=this._scissorRectLocal=this._scissorRect=null}Object.defineProperty(MaskData.prototype,"filter",{get:function(){return this._filters?this._filters[0]:null},set:function(value){value?this._filters?this._filters[0]=value:this._filters=[value]:this._filters=null},enumerable:!1,configurable:!0});MaskData.prototype.reset=function(){this.pooled&&(this.maskObject=
null,this.type=constants.MASK_TYPES.NONE,this.autoDetect=!0);this._scissorRectLocal=this._target=null};MaskData.prototype.copyCountersOrReset=function(maskAbove){maskAbove?(this._stencilCounter=maskAbove._stencilCounter,this._scissorCounter=maskAbove._scissorCounter,this._scissorRect=maskAbove._scissorRect):(this._scissorCounter=this._stencilCounter=0,this._scissorRect=null)};return MaskData}(),unknownContext={},context$jscomp$0=unknownContext,maxFragmentPrecision,GLSL_TO_SIZE={float:1,vec2:2,vec3:3,
vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},GL_TABLE=null,GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",
SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},uniformParsers=[{test:function(data){return"float"===data.type&&1===data.size},code:function(name){return'\n            if(uv["'+name+'"] !\x3d\x3d ud["'+name+'"].value)\n            {\n                ud["'+
name+'"].value \x3d uv["'+name+'"]\n                gl.uniform1f(ud["'+name+'"].location, uv["'+name+'"])\n            }\n            '}},{test:function(data){return("sampler2D"===data.type||"samplerCube"===data.type||"sampler2DArray"===data.type)&&1===data.size&&!data.isArray},code:function(name){return't \x3d syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+name+'"], t);\n\n            if(ud["'+name+'"].value !\x3d\x3d t)\n            {\n                ud["'+name+'"].value \x3d t;\n                gl.uniform1i(ud["'+
name+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(data,uniform){return"mat3"===data.type&&1===data.size&&void 0!==uniform.a},code:function(name){return'\n            gl.uniformMatrix3fv(ud["'+name+'"].location, false, uv["'+name+'"].toArray(true));\n            '},codeUbo:function(name){return"\n                var "+name+"_matrix \x3d uv."+name+".toArray(true);\n\n                data[offset] \x3d "+name+"_matrix[0];\n                data[offset+1] \x3d "+
name+"_matrix[1];\n                data[offset+2] \x3d "+name+"_matrix[2];\n        \n                data[offset + 4] \x3d "+name+"_matrix[3];\n                data[offset + 5] \x3d "+name+"_matrix[4];\n                data[offset + 6] \x3d "+name+"_matrix[5];\n        \n                data[offset + 8] \x3d "+name+"_matrix[6];\n                data[offset + 9] \x3d "+name+"_matrix[7];\n                data[offset + 10] \x3d "+name+"_matrix[8];\n            "}},{test:function(data,uniform){return"vec2"===
data.type&&1===data.size&&void 0!==uniform.x},code:function(name){return'\n                cv \x3d ud["'+name+'"].value;\n                v \x3d uv["'+name+'"];\n\n                if(cv[0] !\x3d\x3d v.x || cv[1] !\x3d\x3d v.y)\n                {\n                    cv[0] \x3d v.x;\n                    cv[1] \x3d v.y;\n                    gl.uniform2f(ud["'+name+'"].location, v.x, v.y);\n                }'},codeUbo:function(name){return"\n                v \x3d uv."+name+";\n\n                data[offset] \x3d v.x;\n                data[offset+1] \x3d v.y;\n            "}},
{test:function(data){return"vec2"===data.type&&1===data.size},code:function(name){return'\n                cv \x3d ud["'+name+'"].value;\n                v \x3d uv["'+name+'"];\n\n                if(cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1])\n                {\n                    cv[0] \x3d v[0];\n                    cv[1] \x3d v[1];\n                    gl.uniform2f(ud["'+name+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(data,uniform){return"vec4"===data.type&&
1===data.size&&void 0!==uniform.width},code:function(name){return'\n                cv \x3d ud["'+name+'"].value;\n                v \x3d uv["'+name+'"];\n\n                if(cv[0] !\x3d\x3d v.x || cv[1] !\x3d\x3d v.y || cv[2] !\x3d\x3d v.width || cv[3] !\x3d\x3d v.height)\n                {\n                    cv[0] \x3d v.x;\n                    cv[1] \x3d v.y;\n                    cv[2] \x3d v.width;\n                    cv[3] \x3d v.height;\n                    gl.uniform4f(ud["'+name+'"].location, v.x, v.y, v.width, v.height)\n                }'},
codeUbo:function(name){return"\n                    v \x3d uv."+name+";\n\n                    data[offset] \x3d v.x;\n                    data[offset+1] \x3d v.y;\n                    data[offset+2] \x3d v.width;\n                    data[offset+3] \x3d v.height;\n                "}},{test:function(data){return"vec4"===data.type&&1===data.size},code:function(name){return'\n                cv \x3d ud["'+name+'"].value;\n                v \x3d uv["'+name+'"];\n\n                if(cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2] || cv[3] !\x3d\x3d v[3])\n                {\n                    cv[0] \x3d v[0];\n                    cv[1] \x3d v[1];\n                    cv[2] \x3d v[2];\n                    cv[3] \x3d v[3];\n\n                    gl.uniform4f(ud["'+
name+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],GLSL_TO_SINGLE_SETTERS_CACHED={float:"\n    if (cv !\x3d\x3d v)\n    {\n        cu.value \x3d v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",
vec4:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2] || cv[3] !\x3d\x3d v[3])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n        cv[3] \x3d v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !\x3d\x3d v)\n    {\n        cu.value \x3d v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",
ivec3:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2] || cv[3] !\x3d\x3d v[3])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n        cv[3] \x3d v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",
uint:"\n    if (cv !\x3d\x3d v)\n    {\n        cu.value \x3d v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",
uvec4:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2] || cv[3] !\x3d\x3d v[3])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n        cv[3] \x3d v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !\x3d\x3d v)\n    {\n        cu.value \x3d v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] !\x3d v[0] || cv[1] !\x3d v[1])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",
bvec3:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !\x3d\x3d v[0] || cv[1] !\x3d\x3d v[1] || cv[2] !\x3d\x3d v[2] || cv[3] !\x3d\x3d v[3])\n    {\n        cv[0] \x3d v[0];\n        cv[1] \x3d v[1];\n        cv[2] \x3d v[2];\n        cv[3] \x3d v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",
mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",
mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",
samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},unsafeEval,UID$3=0,nameCache={},Program=function(){function Program(vertexSrc,fragmentSrc,name){void 0===name&&(name="pixi-shader");this.id=UID$3++;this.vertexSrc=vertexSrc||Program.defaultVertexSrc;this.fragmentSrc=fragmentSrc||Program.defaultFragmentSrc;this.vertexSrc=this.vertexSrc.trim();this.fragmentSrc=this.fragmentSrc.trim();"#version"!==this.vertexSrc.substring(0,8)&&(name=name.replace(/\s+/g,"-"),nameCache[name]?
(nameCache[name]++,name+="-"+nameCache[name]):nameCache[name]=1,this.vertexSrc="#define SHADER_NAME "+name+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+name+"\n"+this.fragmentSrc,this.vertexSrc=setPrecision(this.vertexSrc,settings.settings.PRECISION_VERTEX,constants.PRECISION.HIGH),vertexSrc=this.fragmentSrc,fragmentSrc=settings.settings.PRECISION_FRAGMENT,maxFragmentPrecision||(maxFragmentPrecision=constants.PRECISION.MEDIUM,(name=getTestContext())&&name.getShaderPrecisionFormat&&
(maxFragmentPrecision=name.getShaderPrecisionFormat(name.FRAGMENT_SHADER,name.HIGH_FLOAT).precision?constants.PRECISION.HIGH:constants.PRECISION.MEDIUM)),this.fragmentSrc=setPrecision(vertexSrc,fragmentSrc,maxFragmentPrecision));this.glPrograms={};this.syncUniforms=null}Object.defineProperty(Program,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position \x3d vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord \x3d aTextureCoord;\n}\n"},
enumerable:!1,configurable:!0});Object.defineProperty(Program,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *\x3d texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0});Program.from=function(vertexSrc,fragmentSrc,name){var key=vertexSrc+fragmentSrc,program=utils.ProgramCache[key];program||(utils.ProgramCache[key]=program=new Program(vertexSrc,fragmentSrc,name));return program};return Program}(),
Shader=function(){function Shader(program,uniforms){this.uniformBindCount=0;this.program=program;this.uniformGroup=uniforms?uniforms instanceof UniformGroup?uniforms:new UniformGroup(uniforms):new UniformGroup({})}Shader.prototype.checkUniformExists=function(name,group){if(group.uniforms[name])return!0;for(var i in group.uniforms){var uniform=group.uniforms[i];if(uniform.group&&this.checkUniformExists(name,uniform))return!0}return!1};Shader.prototype.destroy=function(){this.uniformGroup=null};Object.defineProperty(Shader.prototype,
"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0});Shader.from=function(vertexSrc,fragmentSrc,uniforms){vertexSrc=Program.from(vertexSrc,fragmentSrc);return new Shader(vertexSrc,uniforms)};return Shader}(),State=function(){function State(){this.data=0;this.blendMode=constants.BLEND_MODES.NORMAL;this.polygonOffset=0;this.depthMask=this.blend=!0}Object.defineProperty(State.prototype,"blend",{get:function(){return!!(this.data&1)},set:function(value){!!(this.data&
1)!==value&&(this.data^=1)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"offsets",{get:function(){return!!(this.data&2)},set:function(value){!!(this.data&2)!==value&&(this.data^=2)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"culling",{get:function(){return!!(this.data&4)},set:function(value){!!(this.data&4)!==value&&(this.data^=4)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"depthTest",{get:function(){return!!(this.data&
8)},set:function(value){!!(this.data&8)!==value&&(this.data^=8)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"depthMask",{get:function(){return!!(this.data&32)},set:function(value){!!(this.data&32)!==value&&(this.data^=32)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&16)},set:function(value){!!(this.data&16)!==value&&(this.data^=16)},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,
"blendMode",{get:function(){return this._blendMode},set:function(value){this.blend=value!==constants.BLEND_MODES.NONE;this._blendMode=value},enumerable:!1,configurable:!0});Object.defineProperty(State.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(value){this.offsets=!!value;this._polygonOffset=value},enumerable:!1,configurable:!0});State.prototype.toString=function(){return"[@pixi/core:State blendMode\x3d"+(this.blendMode+" clockwiseFrontFace\x3d")+(this.clockwiseFrontFace+
" culling\x3d")+(this.culling+" depthMask\x3d")+(this.depthMask+" polygonOffset\x3d")+this.polygonOffset+"]"};State.for2d=function(){var state=new State;state.depthTest=!1;state.blend=!0;return state};return State}(),Filter$jscomp$0=function(_super){function Filter(vertexSrc,fragmentSrc,uniforms){vertexSrc=Program.from(vertexSrc||Filter.defaultVertexSrc,fragmentSrc||Filter.defaultFragmentSrc);uniforms=_super.call(this,vertexSrc,uniforms)||this;uniforms.padding=0;uniforms.resolution=settings.settings.FILTER_RESOLUTION;
uniforms.multisample=settings.settings.FILTER_MULTISAMPLE;uniforms.enabled=!0;uniforms.autoFit=!0;uniforms.state=new State;return uniforms}__extends(Filter,_super);Filter.prototype.apply=function(filterManager,input,output,clearMode,_currentState){filterManager.applyFilter(this,input,output,clearMode)};Object.defineProperty(Filter.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(value){this.state.blendMode=value},enumerable:!1,configurable:!0});Object.defineProperty(Filter.prototype,
"resolution",{get:function(){return this._resolution},set:function(value){this._resolution=value},enumerable:!1,configurable:!0});Object.defineProperty(Filter,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position \x3d aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position \x3d filterVertexPosition();\n    vTextureCoord \x3d filterTextureCoord();\n}\n"},
enumerable:!1,configurable:!0});Object.defineProperty(Filter,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor \x3d texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0});return Filter}(Shader),tempMat=new math.Matrix,TextureMatrix=function(){function TextureMatrix(texture,clampMargin){this._texture=texture;this.mapCoord=new math.Matrix;this.uClampFrame=new Float32Array(4);this.uClampOffset=
new Float32Array(2);this._textureID=-1;this.clampOffset=this._updateID=0;this.clampMargin="undefined"===typeof clampMargin?.5:clampMargin;this.isSimple=!1}Object.defineProperty(TextureMatrix.prototype,"texture",{get:function(){return this._texture},set:function(value){this._texture=value;this._textureID=-1},enumerable:!1,configurable:!0});TextureMatrix.prototype.multiplyUvs=function(uvs,out){void 0===out&&(out=uvs);for(var mat=this.mapCoord,i=0;i<uvs.length;i+=2){var x=uvs[i],y=uvs[i+1];out[i]=x*
mat.a+y*mat.c+mat.tx;out[i+1]=x*mat.b+y*mat.d+mat.ty}return out};TextureMatrix.prototype.update=function(forceUpdate){var tex=this._texture;if(!tex||!tex.valid||!forceUpdate&&this._textureID===tex._updateID)return!1;this._textureID=tex._updateID;this._updateID++;forceUpdate=tex._uvs;this.mapCoord.set(forceUpdate.x1-forceUpdate.x0,forceUpdate.y1-forceUpdate.y0,forceUpdate.x3-forceUpdate.x0,forceUpdate.y3-forceUpdate.y0,forceUpdate.x0,forceUpdate.y0);forceUpdate=tex.orig;var trim=tex.trim;trim&&(tempMat.set(forceUpdate.width/
trim.width,0,0,forceUpdate.height/trim.height,-trim.x/trim.width,-trim.y/trim.height),this.mapCoord.append(tempMat));forceUpdate=tex.baseTexture;trim=this.uClampFrame;var margin=this.clampMargin/forceUpdate.resolution,offset=this.clampOffset;trim[0]=(tex._frame.x+margin+offset)/forceUpdate.width;trim[1]=(tex._frame.y+margin+offset)/forceUpdate.height;trim[2]=(tex._frame.x+tex._frame.width-margin+offset)/forceUpdate.width;trim[3]=(tex._frame.y+tex._frame.height-margin+offset)/forceUpdate.height;this.uClampOffset[0]=
offset/forceUpdate.realWidth;this.uClampOffset[1]=offset/forceUpdate.realHeight;this.isSimple=tex._frame.width===forceUpdate.width&&tex._frame.height===forceUpdate.height&&0===tex.rotate;return!0};return TextureMatrix}(),SpriteMaskFilter=function(_super){function SpriteMaskFilter(vertexSrc,fragmentSrc,uniforms){var sprite=null;"string"!==typeof vertexSrc&&void 0===fragmentSrc&&void 0===uniforms&&(sprite=vertexSrc,uniforms=fragmentSrc=vertexSrc=void 0);vertexSrc=_super.call(this,vertexSrc||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position \x3d vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord \x3d aTextureCoord;\n    vMaskCoord \x3d ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",
fragmentSrc||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip \x3d step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original \x3d texture2D(uSampler, vTextureCoord);\n    vec4 masky \x3d texture2D(mask, vMaskCoord);\n    float alphaMul \x3d 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *\x3d (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor \x3d original;\n}\n",
uniforms)||this;vertexSrc.maskSprite=sprite;vertexSrc.maskMatrix=new math.Matrix;return vertexSrc}__extends(SpriteMaskFilter,_super);Object.defineProperty(SpriteMaskFilter.prototype,"maskSprite",{get:function(){return this._maskSprite},set:function(value){if(this._maskSprite=value)this._maskSprite.renderable=!1},enumerable:!1,configurable:!0});SpriteMaskFilter.prototype.apply=function(filterManager,input,output,clearMode){var maskSprite=this._maskSprite,tex=maskSprite._texture;tex.valid&&(tex.uvMatrix||
(tex.uvMatrix=new TextureMatrix(tex,0)),tex.uvMatrix.update(),this.uniforms.npmAlpha=tex.baseTexture.alphaMode?0:1,this.uniforms.mask=tex,this.uniforms.otherMatrix=filterManager.calculateSpriteMatrix(this.maskMatrix,maskSprite).prepend(tex.uvMatrix.mapCoord),this.uniforms.alpha=maskSprite.worldAlpha,this.uniforms.maskClamp=tex.uvMatrix.uClampFrame,filterManager.applyFilter(this,input,output,clearMode))};return SpriteMaskFilter}(Filter$jscomp$0),MaskSystem=function(){function MaskSystem(renderer){this.renderer=
renderer;this.enableScissor=!0;this.alphaMaskPool=[];this.maskDataPool=[];this.maskStack=[];this.alphaMaskIndex=0}MaskSystem.prototype.setMaskStack=function(maskStack){this.maskStack=maskStack;this.renderer.scissor.setMaskStack(maskStack);this.renderer.stencil.setMaskStack(maskStack)};MaskSystem.prototype.push=function(target,maskDataOrTarget){var maskData=maskDataOrTarget;maskData.isMaskData||(maskData=this.maskDataPool.pop()||new MaskData,maskData.pooled=!0,maskData.maskObject=maskDataOrTarget);
maskData.copyCountersOrReset(0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null);maskData.autoDetect&&this.detect(maskData);maskData._target=target;maskData.type!==constants.MASK_TYPES.SPRITE&&this.maskStack.push(maskData);if(maskData.enabled)switch(maskData.type){case constants.MASK_TYPES.SCISSOR:this.renderer.scissor.push(maskData);break;case constants.MASK_TYPES.STENCIL:this.renderer.stencil.push(maskData);break;case constants.MASK_TYPES.SPRITE:maskData.copyCountersOrReset(null),
this.pushSpriteMask(maskData)}maskData.type===constants.MASK_TYPES.SPRITE&&this.maskStack.push(maskData)};MaskSystem.prototype.pop=function(target){var maskData=this.maskStack.pop();if(maskData&&maskData._target===target){if(maskData.enabled)switch(maskData.type){case constants.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case constants.MASK_TYPES.STENCIL:this.renderer.stencil.pop(maskData.maskObject);break;case constants.MASK_TYPES.SPRITE:this.popSpriteMask(maskData)}maskData.reset();maskData.pooled&&
this.maskDataPool.push(maskData);0!==this.maskStack.length&&(target=this.maskStack[this.maskStack.length-1],target.type===constants.MASK_TYPES.SPRITE&&target._filters&&(target._filters[0].maskSprite=target.maskObject))}};MaskSystem.prototype.detect=function(maskData){maskData.maskObject.isSprite?maskData.type=constants.MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(maskData)?maskData.type=constants.MASK_TYPES.SCISSOR:maskData.type=constants.MASK_TYPES.STENCIL};MaskSystem.prototype.pushSpriteMask=
function(maskData){var _a,maskObject=maskData.maskObject,target=maskData._target,alphaMaskFilter=maskData._filters;alphaMaskFilter||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex])||(alphaMaskFilter=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter]);var renderer=this.renderer,renderTextureSystem=renderer.renderTexture;if(renderTextureSystem.current){var _b=renderTextureSystem.current;renderTextureSystem=maskData.resolution||_b.resolution;var multisample=null!==(_a=maskData.multisample)&&
void 0!==_a?_a:_b.multisample}else renderTextureSystem=maskData.resolution||renderer.resolution,multisample=null!==(_b=maskData.multisample)&&void 0!==_b?_b:renderer.multisample;alphaMaskFilter[0].resolution=renderTextureSystem;alphaMaskFilter[0].multisample=multisample;alphaMaskFilter[0].maskSprite=maskObject;_a=target.filterArea;target.filterArea=maskObject.getBounds(!0);renderer.filter.push(target,alphaMaskFilter);target.filterArea=_a;maskData._filters||this.alphaMaskIndex++};MaskSystem.prototype.popSpriteMask=
function(maskData){this.renderer.filter.pop();maskData._filters?maskData._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)};MaskSystem.prototype.destroy=function(){this.renderer=null};return MaskSystem}(),AbstractMaskSystem=function(){function AbstractMaskSystem(renderer){this.renderer=renderer;this.maskStack=[];this.glConst=0}AbstractMaskSystem.prototype.getStackLength=function(){return this.maskStack.length};AbstractMaskSystem.prototype.setMaskStack=
function(maskStack){var gl=this.renderer.gl,curStackLen=this.getStackLength();this.maskStack=maskStack;maskStack=this.getStackLength();maskStack!==curStackLen&&(0===maskStack?gl.disable(this.glConst):(gl.enable(this.glConst),this._useCurrent()))};AbstractMaskSystem.prototype._useCurrent=function(){};AbstractMaskSystem.prototype.destroy=function(){this.maskStack=this.renderer=null};return AbstractMaskSystem}(),tempMatrix$1=new math.Matrix,ScissorSystem=function(_super){function ScissorSystem(renderer){renderer=
_super.call(this,renderer)||this;renderer.glConst=WebGLRenderingContext.SCISSOR_TEST;return renderer}__extends(ScissorSystem,_super);ScissorSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._scissorCounter:0};ScissorSystem.prototype.calcScissorRect=function(maskData){if(!maskData._scissorRectLocal){var prevData=maskData._scissorRect,maskObject=maskData.maskObject,renderer=this.renderer,renderTextureSystem=renderer.renderTexture;
maskObject.renderable=!0;var rect=maskObject.getBounds();this.roundFrameToPixels(rect,renderTextureSystem.current?renderTextureSystem.current.resolution:renderer.resolution,renderTextureSystem.sourceFrame,renderTextureSystem.destinationFrame,renderer.projection.transform);maskObject.renderable=!1;prevData&&rect.fit(prevData);maskData._scissorRectLocal=rect}};ScissorSystem.isMatrixRotated=function(matrix){if(!matrix)return!1;var a=matrix.a,c=matrix.c,d=matrix.d;return(1E-4<Math.abs(matrix.b)||1E-4<
Math.abs(c))&&(1E-4<Math.abs(a)||1E-4<Math.abs(d))};ScissorSystem.prototype.testScissor=function(maskData){var maskObject=maskData.maskObject;if(!maskObject.isFastRect||!maskObject.isFastRect()||ScissorSystem.isMatrixRotated(maskObject.worldTransform)||ScissorSystem.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(maskData);maskData=maskData._scissorRectLocal;return 0<maskData.width&&0<maskData.height};ScissorSystem.prototype.roundFrameToPixels=function(frame,resolution,
bindingSourceFrame,bindingDestinationFrame,transform){ScissorSystem.isMatrixRotated(transform)||(transform=transform?tempMatrix$1.copyFrom(transform):tempMatrix$1.identity(),transform.translate(-bindingSourceFrame.x,-bindingSourceFrame.y).scale(bindingDestinationFrame.width/bindingSourceFrame.width,bindingDestinationFrame.height/bindingSourceFrame.height).translate(bindingDestinationFrame.x,bindingDestinationFrame.y),this.renderer.filter.transformAABB(transform,frame),frame.fit(bindingDestinationFrame),
frame.x=Math.round(frame.x*resolution),frame.y=Math.round(frame.y*resolution),frame.width=Math.round(frame.width*resolution),frame.height=Math.round(frame.height*resolution))};ScissorSystem.prototype.push=function(maskData){maskData._scissorRectLocal||this.calcScissorRect(maskData);var gl=this.renderer.gl;maskData._scissorRect||gl.enable(gl.SCISSOR_TEST);maskData._scissorCounter++;maskData._scissorRect=maskData._scissorRectLocal;this._useCurrent()};ScissorSystem.prototype.pop=function(){var gl=this.renderer.gl;
0<this.getStackLength()?this._useCurrent():gl.disable(gl.SCISSOR_TEST)};ScissorSystem.prototype._useCurrent=function(){var rect=this.maskStack[this.maskStack.length-1]._scissorRect;this.renderer.gl.scissor(rect.x,this.renderer.renderTexture.current?rect.y:this.renderer.height-rect.height-rect.y,rect.width,rect.height)};return ScissorSystem}(AbstractMaskSystem),StencilSystem=function(_super){function StencilSystem(renderer){renderer=_super.call(this,renderer)||this;renderer.glConst=WebGLRenderingContext.STENCIL_TEST;
return renderer}__extends(StencilSystem,_super);StencilSystem.prototype.getStackLength=function(){var maskData=this.maskStack[this.maskStack.length-1];return maskData?maskData._stencilCounter:0};StencilSystem.prototype.push=function(maskData){var maskObject=maskData.maskObject,gl=this.renderer.gl,prevMaskCount=maskData._stencilCounter;0===prevMaskCount&&(this.renderer.framebuffer.forceStencil(),gl.enable(gl.STENCIL_TEST));maskData._stencilCounter++;gl.colorMask(!1,!1,!1,!1);gl.stencilFunc(gl.EQUAL,
prevMaskCount,4294967295);gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR);maskObject.renderable=!0;maskObject.render(this.renderer);this.renderer.batch.flush();maskObject.renderable=!1;this._useCurrent()};StencilSystem.prototype.pop=function(maskObject){var gl=this.renderer.gl;0===this.getStackLength()?(gl.disable(gl.STENCIL_TEST),gl.clearStencil(0),gl.clear(gl.STENCIL_BUFFER_BIT)):(gl.colorMask(!1,!1,!1,!1),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR),maskObject.renderable=!0,maskObject.render(this.renderer),this.renderer.batch.flush(),
maskObject.renderable=!1,this._useCurrent())};StencilSystem.prototype._useCurrent=function(){var gl=this.renderer.gl;gl.colorMask(!0,!0,!0,!0);gl.stencilFunc(gl.EQUAL,this.getStackLength(),4294967295);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)};return StencilSystem}(AbstractMaskSystem),ProjectionSystem=function(){function ProjectionSystem(renderer){this.renderer=renderer;this.defaultFrame=this.sourceFrame=this.destinationFrame=null;this.projectionMatrix=new math.Matrix;this.transform=null}ProjectionSystem.prototype.update=
function(destinationFrame,sourceFrame,resolution,root){this.destinationFrame=destinationFrame||this.destinationFrame||this.defaultFrame;this.sourceFrame=sourceFrame||this.sourceFrame||destinationFrame;this.calculateProjection(this.destinationFrame,this.sourceFrame,resolution,root);this.transform&&this.projectionMatrix.append(this.transform);destinationFrame=this.renderer;destinationFrame.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix;destinationFrame.globalUniforms.update();destinationFrame.shader.shader&&
destinationFrame.shader.syncUniformGroup(destinationFrame.shader.shader.uniforms.globals)};ProjectionSystem.prototype.calculateProjection=function(_destinationFrame,sourceFrame,_resolution,root){_destinationFrame=this.projectionMatrix;root=root?-1:1;_destinationFrame.identity();_destinationFrame.a=1/sourceFrame.width*2;_destinationFrame.d=1/sourceFrame.height*root*2;_destinationFrame.tx=-1-sourceFrame.x*_destinationFrame.a;_destinationFrame.ty=-root-sourceFrame.y*_destinationFrame.d};ProjectionSystem.prototype.setTransform=
function(_matrix){};ProjectionSystem.prototype.destroy=function(){this.renderer=null};return ProjectionSystem}(),tempRect=new math.Rectangle,tempRect2=new math.Rectangle,RenderTextureSystem=function(){function RenderTextureSystem(renderer){this.renderer=renderer;this.clearColor=renderer._backgroundColorRgba;this.defaultMaskStack=[];this.current=null;this.sourceFrame=new math.Rectangle;this.destinationFrame=new math.Rectangle;this.viewportFrame=new math.Rectangle}RenderTextureSystem.prototype.bind=
function(renderTexture,sourceFrame,destinationFrame){void 0===renderTexture&&(renderTexture=null);var renderer=this.renderer;this.current=renderTexture;if(renderTexture){var baseTexture=renderTexture.baseTexture;var resolution=baseTexture.resolution;sourceFrame||(tempRect.width=renderTexture.frame.width,tempRect.height=renderTexture.frame.height,sourceFrame=tempRect);destinationFrame||(tempRect2.x=renderTexture.frame.x,tempRect2.y=renderTexture.frame.y,tempRect2.width=sourceFrame.width,tempRect2.height=
sourceFrame.height,destinationFrame=tempRect2);var framebuffer=baseTexture.framebuffer}else resolution=renderer.resolution,sourceFrame||(tempRect.width=renderer.screen.width,tempRect.height=renderer.screen.height,sourceFrame=tempRect),destinationFrame||(destinationFrame=tempRect,destinationFrame.width=sourceFrame.width,destinationFrame.height=sourceFrame.height);var viewportFrame=this.viewportFrame;viewportFrame.x=destinationFrame.x*resolution;viewportFrame.y=destinationFrame.y*resolution;viewportFrame.width=
destinationFrame.width*resolution;viewportFrame.height=destinationFrame.height*resolution;renderTexture||(viewportFrame.y=renderer.view.height-(viewportFrame.y+viewportFrame.height));viewportFrame.ceil();this.renderer.framebuffer.bind(framebuffer,viewportFrame);this.renderer.projection.update(destinationFrame,sourceFrame,resolution,!framebuffer);renderTexture?this.renderer.mask.setMaskStack(baseTexture.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(sourceFrame);
this.destinationFrame.copyFrom(destinationFrame)};RenderTextureSystem.prototype.clear=function(clearColor,mask){clearColor=this.current?clearColor||this.current.baseTexture.clearColor:clearColor||this.clearColor;var destinationFrame=this.destinationFrame,baseFrame=this.current?this.current.baseTexture:this.renderer.screen;if(destinationFrame=destinationFrame.width!==baseFrame.width||destinationFrame.height!==baseFrame.height){var _a=this.viewportFrame;baseFrame=_a.x;var y=_a.y,width=_a.width;_a=_a.height;
baseFrame=Math.round(baseFrame);y=Math.round(y);width=Math.round(width);_a=Math.round(_a);this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);this.renderer.gl.scissor(baseFrame,y,width,_a)}this.renderer.framebuffer.clear(clearColor[0],clearColor[1],clearColor[2],clearColor[3],mask);destinationFrame&&this.renderer.scissor.pop()};RenderTextureSystem.prototype.resize=function(){this.bind(null)};RenderTextureSystem.prototype.reset=function(){this.bind(null)};RenderTextureSystem.prototype.destroy=function(){this.renderer=
null};return RenderTextureSystem}(),UBO_TO_SINGLE_SETTERS={float:"\n        data[offset] \x3d v;\n    ",vec2:"\n        data[offset] \x3d v[0];\n        data[offset+1] \x3d v[1];\n    ",vec3:"\n        data[offset] \x3d v[0];\n        data[offset+1] \x3d v[1];\n        data[offset+2] \x3d v[2];\n\n    ",vec4:"\n        data[offset] \x3d v[0];\n        data[offset+1] \x3d v[1];\n        data[offset+2] \x3d v[2];\n        data[offset+3] \x3d v[3];\n    ",mat2:"\n        data[offset] \x3d v[0];\n        data[offset+1] \x3d v[1];\n\n        data[offset+4] \x3d v[2];\n        data[offset+5] \x3d v[3];\n    ",
mat3:"\n        data[offset] \x3d v[0];\n        data[offset+1] \x3d v[1];\n        data[offset+2] \x3d v[2];\n\n        data[offset + 4] \x3d v[3];\n        data[offset + 5] \x3d v[4];\n        data[offset + 6] \x3d v[5];\n\n        data[offset + 8] \x3d v[6];\n        data[offset + 9] \x3d v[7];\n        data[offset + 10] \x3d v[8];\n    ",mat4:"\n        for(var i \x3d 0; i \x3c 16; i++)\n        {\n            data[offset + i] \x3d v[i];\n        }\n    "},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,
vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64},IGLUniformData=function(){return function(){}}(),GLProgram=function(){function GLProgram(program,uniformData){this.program=program;this.uniformData=uniformData;this.uniformGroups={};this.uniformDirtyGroups={};this.uniformBufferBindings={}}GLProgram.prototype.destroy=function(){this.program=this.uniformBufferBindings=this.uniformDirtyGroups=this.uniformGroups=this.uniformData=
null};return GLProgram}(),UID$4=0,defaultSyncData={textureCount:0,uboCount:0},ShaderSystem=function(){function ShaderSystem(renderer){this.destroyed=!1;this.renderer=renderer;this.systemCheck();this.program=this.shader=this.gl=null;this.cache={};this._uboCache={};this.id=UID$4++}ShaderSystem.prototype.systemCheck=function(){if("boolean"!==typeof unsafeEval)try{unsafeEval=!0===(new Function("param1","param2","param3","return param1[param2] \x3d\x3d\x3d param3;"))({a:"b"},"a","b")}catch(e){unsafeEval=
!1}var JSCompiler_inline_result=unsafeEval;if(!JSCompiler_inline_result)throw Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.");};ShaderSystem.prototype.contextChange=function(gl){this.gl=gl;this.reset()};ShaderSystem.prototype.bind=function(shader,dontSync){shader.uniforms.globals=this.renderer.globalUniforms;var program=shader.program,glProgram=program.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(shader);this.shader=shader;
this.program!==program&&(this.program=program,this.gl.useProgram(glProgram.program));dontSync||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(shader.uniformGroup,defaultSyncData));return glProgram};ShaderSystem.prototype.setUniforms=function(uniforms){var shader=this.shader.program;shader.syncUniforms(shader.glPrograms[this.renderer.CONTEXT_UID].uniformData,uniforms,this.renderer)};ShaderSystem.prototype.syncUniformGroup=function(group,syncData){var glProgram=this.getGlProgram();
group.static&&group.dirtyId===glProgram.uniformDirtyGroups[group.id]||(glProgram.uniformDirtyGroups[group.id]=group.dirtyId,this.syncUniforms(group,glProgram,syncData))};ShaderSystem.prototype.syncUniforms=function(group,glProgram,syncData){(group.syncUniforms[this.shader.program.id]||this.createSyncGroups(group))(glProgram.uniformData,group.uniforms,this.renderer,syncData)};ShaderSystem.prototype.createSyncGroups=function(group){var id=this.getSignature(group,this.shader.program.uniformData,"u");
if(!this.cache[id]){var JSCompiler_temp_const=this.cache;var JSCompiler_inline_result=this.shader.program.uniformData;var _a,funcFragments=["\n        var v \x3d null;\n        var cv \x3d null;\n        var cu \x3d null;\n        var t \x3d 0;\n        var gl \x3d renderer.gl;\n    "],i;for(i in group.uniforms){var data=JSCompiler_inline_result[i];if(data){for(var uniform=group.uniforms[i],parsed=!1,j=0;j<uniformParsers.length;j++)if(uniformParsers[j].test(data,uniform)){funcFragments.push(uniformParsers[j].code(i,
uniform));parsed=!0;break}parsed||(data=(1===data.size?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[data.type].replace("location",'ud["'+i+'"].location'),funcFragments.push('\n            cu \x3d ud["'+i+'"];\n            cv \x3d cu.value;\n            v \x3d uv["'+i+'"];\n            '+data+";"))}else if(null===(_a=group.uniforms[i])||void 0===_a?0:_a.group)group.uniforms[i].ubo?funcFragments.push("\n                        renderer.shader.syncUniformBufferGroup(uv."+i+", '"+i+"');\n                    "):
funcFragments.push("\n                        renderer.shader.syncUniformGroup(uv."+i+", syncData);\n                    ")}JSCompiler_inline_result=new Function("ud","uv","renderer","syncData",funcFragments.join("\n"));JSCompiler_temp_const[id]=JSCompiler_inline_result}group.syncUniforms[this.shader.program.id]=this.cache[id];return group.syncUniforms[this.shader.program.id]};ShaderSystem.prototype.syncUniformBufferGroup=function(group,name){var glProgram=this.getGlProgram();if(!group.static||0!==
group.dirtyId||!glProgram.uniformGroups[group.id]){group.dirtyId=0;var syncFunc=glProgram.uniformGroups[group.id]||this.createSyncBufferGroup(group,glProgram,name);group.buffer.update();syncFunc(glProgram.uniformData,group.uniforms,this.renderer,defaultSyncData,group.buffer)}this.renderer.buffer.bindBufferBase(group.buffer,glProgram.uniformBufferBindings[name])};ShaderSystem.prototype.createSyncBufferGroup=function(group,glProgram,name){var gl=this.renderer.gl;this.renderer.buffer.bind(group.buffer);
var uniformBlockIndex=this.gl.getUniformBlockIndex(glProgram.program,name);glProgram.uniformBufferBindings[name]=this.shader.uniformBindCount;gl.uniformBlockBinding(glProgram.program,uniformBlockIndex,this.shader.uniformBindCount);this.shader.uniformBindCount++;gl=this.getSignature(group,this.shader.program.uniformData,"ubo");(name=this._uboCache[gl])||(name=this._uboCache[gl]=generateUniformBufferSync(group,this.shader.program.uniformData));group.autoManage&&(gl=new Float32Array(name.size/4),group.buffer.update(gl));
glProgram.uniformGroups[group.id]=name.syncFunc;return glProgram.uniformGroups[group.id]};ShaderSystem.prototype.getSignature=function(group,uniformData,preFix){group=group.uniforms;preFix=[preFix+"-"];for(var i in group)preFix.push(i),uniformData[i]&&preFix.push(uniformData[i].type);return preFix.join("-")};ShaderSystem.prototype.getGlProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null};ShaderSystem.prototype.generateProgram=function(shader){shader=
shader.program;var glProgram=generateProgram(this.gl,shader);return shader.glPrograms[this.renderer.CONTEXT_UID]=glProgram};ShaderSystem.prototype.reset=function(){this.shader=this.program=null};ShaderSystem.prototype.destroy=function(){this.renderer=null;this.destroyed=!0};return ShaderSystem}(),StateSystem=function(){function StateSystem(){this.gl=null;this.polygonOffset=this.stateId=0;this.blendMode=constants.BLEND_MODES.NONE;this._blendEq=!1;this.map=[];this.map[0]=this.setBlend;this.map[1]=this.setOffset;
this.map[2]=this.setCullFace;this.map[3]=this.setDepthTest;this.map[4]=this.setFrontFace;this.map[5]=this.setDepthMask;this.checks=[];this.defaultState=new State;this.defaultState.blend=!0}StateSystem.prototype.contextChange=function(gl){this.gl=gl;var array=void 0;void 0===array&&(array=[]);array[constants.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.ADD]=[gl.ONE,gl.ONE];array[constants.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];
array[constants.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];
array[constants.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.NONE]=
[0,0];array[constants.BLEND_MODES.NORMAL_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.ADD_NPM]=[gl.SRC_ALPHA,gl.ONE,gl.ONE,gl.ONE];array[constants.BLEND_MODES.SCREEN_NPM]=[gl.SRC_ALPHA,gl.ONE_MINUS_SRC_COLOR,gl.ONE,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.SRC_IN]=[gl.DST_ALPHA,gl.ZERO];array[constants.BLEND_MODES.SRC_OUT]=[gl.ONE_MINUS_DST_ALPHA,gl.ZERO];array[constants.BLEND_MODES.SRC_ATOP]=[gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.DST_OVER]=
[gl.ONE_MINUS_DST_ALPHA,gl.ONE];array[constants.BLEND_MODES.DST_IN]=[gl.ZERO,gl.SRC_ALPHA];array[constants.BLEND_MODES.DST_OUT]=[gl.ZERO,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.DST_ATOP]=[gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA];array[constants.BLEND_MODES.XOR]=[gl.ONE_MINUS_DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA];array[constants.BLEND_MODES.SUBTRACT]=[gl.ONE,gl.ONE,gl.ONE,gl.ONE,gl.FUNC_REVERSE_SUBTRACT,gl.FUNC_ADD];this.blendModes=array;this.set(this.defaultState);this.reset()};StateSystem.prototype.set=
function(state){state=state||this.defaultState;if(this.stateId!==state.data){for(var diff=this.stateId^state.data,i=0;diff;)diff&1&&this.map[i].call(this,!!(state.data&1<<i)),diff>>=1,i++;this.stateId=state.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,state)};StateSystem.prototype.forceState=function(state){state=state||this.defaultState;for(var i=0;i<this.map.length;i++)this.map[i].call(this,!!(state.data&1<<i));for(i=0;i<this.checks.length;i++)this.checks[i](this,state);this.stateId=
state.data};StateSystem.prototype.setBlend=function(value){this.updateCheck(StateSystem.checkBlendMode,value);this.gl[value?"enable":"disable"](this.gl.BLEND)};StateSystem.prototype.setOffset=function(value){this.updateCheck(StateSystem.checkPolygonOffset,value);this.gl[value?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)};StateSystem.prototype.setDepthTest=function(value){this.gl[value?"enable":"disable"](this.gl.DEPTH_TEST)};StateSystem.prototype.setDepthMask=function(value){this.gl.depthMask(value)};
StateSystem.prototype.setCullFace=function(value){this.gl[value?"enable":"disable"](this.gl.CULL_FACE)};StateSystem.prototype.setFrontFace=function(value){this.gl.frontFace(this.gl[value?"CW":"CCW"])};StateSystem.prototype.setBlendMode=function(value){if(value!==this.blendMode){this.blendMode=value;value=this.blendModes[value];var gl=this.gl;2===value.length?gl.blendFunc(value[0],value[1]):gl.blendFuncSeparate(value[0],value[1],value[2],value[3]);6===value.length?(this._blendEq=!0,gl.blendEquationSeparate(value[4],
value[5])):this._blendEq&&(this._blendEq=!1,gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD))}};StateSystem.prototype.setPolygonOffset=function(value,scale){this.gl.polygonOffset(value,scale)};StateSystem.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1);this.forceState(this.defaultState);this._blendEq=!0;this.blendMode=-1;this.setBlendMode(0)};StateSystem.prototype.updateCheck=function(func,value){var index=this.checks.indexOf(func);value&&-1===index?this.checks.push(func):
value||-1===index||this.checks.splice(index,1)};StateSystem.checkBlendMode=function(system,state){system.setBlendMode(state.blendMode)};StateSystem.checkPolygonOffset=function(system,state){system.setPolygonOffset(1,state.polygonOffset)};StateSystem.prototype.destroy=function(){this.gl=null};return StateSystem}(),TextureGCSystem=function(){function TextureGCSystem(renderer){this.renderer=renderer;this.checkCount=this.count=0;this.maxIdle=settings.settings.GC_MAX_IDLE;this.checkCountMax=settings.settings.GC_MAX_CHECK_COUNT;
this.mode=settings.settings.GC_MODE}TextureGCSystem.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==constants.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))};TextureGCSystem.prototype.run=function(){for(var tm=this.renderer.texture,managedTextures=tm.managedTextures,wasRemoved=!1,i=0;i<managedTextures.length;i++){var texture=managedTextures[i];!texture.framebuffer&&this.count-texture.touched>this.maxIdle&&
(tm.destroyTexture(texture,!0),managedTextures[i]=null,wasRemoved=!0)}if(wasRemoved){for(i=tm=0;i<managedTextures.length;i++)null!==managedTextures[i]&&(managedTextures[tm++]=managedTextures[i]);managedTextures.length=tm}};TextureGCSystem.prototype.unload=function(displayObject){var tm=this.renderer.texture,texture=displayObject._texture;texture&&!texture.framebuffer&&tm.destroyTexture(texture);for(tm=displayObject.children.length-1;0<=tm;tm--)this.unload(displayObject.children[tm])};TextureGCSystem.prototype.destroy=
function(){this.renderer=null};return TextureGCSystem}(),GLTexture=function(){return function(texture){this.texture=texture;this.dirtyStyleId=this.dirtyId=this.height=this.width=-1;this.mipmap=!1;this.wrapMode=33071;this.type=constants.TYPES.UNSIGNED_BYTE;this.internalFormat=constants.FORMATS.RGBA;this.samplerType=0}}(),TextureSystem=function(){function TextureSystem(renderer){this.renderer=renderer;this.boundTextures=[];this.currentLocation=-1;this.managedTextures=[];this._unknownBoundTextures=!1;
this.unknownTexture=new BaseTexture;this.hasIntegerTextures=!1}TextureSystem.prototype.contextChange=function(){var gl=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.webGLVersion=this.renderer.context.webGLVersion;var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x;this.internalFormats="WebGL2RenderingContext"in self&&gl instanceof self.WebGL2RenderingContext?(_a={},_a[constants.TYPES.UNSIGNED_BYTE]=(_b={},_b[constants.FORMATS.RGBA]=gl.RGBA8,_b[constants.FORMATS.RGB]=
gl.RGB8,_b[constants.FORMATS.RG]=gl.RG8,_b[constants.FORMATS.RED]=gl.R8,_b[constants.FORMATS.RGBA_INTEGER]=gl.RGBA8UI,_b[constants.FORMATS.RGB_INTEGER]=gl.RGB8UI,_b[constants.FORMATS.RG_INTEGER]=gl.RG8UI,_b[constants.FORMATS.RED_INTEGER]=gl.R8UI,_b[constants.FORMATS.ALPHA]=gl.ALPHA,_b[constants.FORMATS.LUMINANCE]=gl.LUMINANCE,_b[constants.FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_b),_a[constants.TYPES.BYTE]=(_c={},_c[constants.FORMATS.RGBA]=gl.RGBA8_SNORM,_c[constants.FORMATS.RGB]=gl.RGB8_SNORM,
_c[constants.FORMATS.RG]=gl.RG8_SNORM,_c[constants.FORMATS.RED]=gl.R8_SNORM,_c[constants.FORMATS.RGBA_INTEGER]=gl.RGBA8I,_c[constants.FORMATS.RGB_INTEGER]=gl.RGB8I,_c[constants.FORMATS.RG_INTEGER]=gl.RG8I,_c[constants.FORMATS.RED_INTEGER]=gl.R8I,_c),_a[constants.TYPES.UNSIGNED_SHORT]=(_d={},_d[constants.FORMATS.RGBA_INTEGER]=gl.RGBA16UI,_d[constants.FORMATS.RGB_INTEGER]=gl.RGB16UI,_d[constants.FORMATS.RG_INTEGER]=gl.RG16UI,_d[constants.FORMATS.RED_INTEGER]=gl.R16UI,_d[constants.FORMATS.DEPTH_COMPONENT]=
gl.DEPTH_COMPONENT16,_d),_a[constants.TYPES.SHORT]=(_e={},_e[constants.FORMATS.RGBA_INTEGER]=gl.RGBA16I,_e[constants.FORMATS.RGB_INTEGER]=gl.RGB16I,_e[constants.FORMATS.RG_INTEGER]=gl.RG16I,_e[constants.FORMATS.RED_INTEGER]=gl.R16I,_e),_a[constants.TYPES.UNSIGNED_INT]=(_f={},_f[constants.FORMATS.RGBA_INTEGER]=gl.RGBA32UI,_f[constants.FORMATS.RGB_INTEGER]=gl.RGB32UI,_f[constants.FORMATS.RG_INTEGER]=gl.RG32UI,_f[constants.FORMATS.RED_INTEGER]=gl.R32UI,_f[constants.FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT24,
_f),_a[constants.TYPES.INT]=(_g={},_g[constants.FORMATS.RGBA_INTEGER]=gl.RGBA32I,_g[constants.FORMATS.RGB_INTEGER]=gl.RGB32I,_g[constants.FORMATS.RG_INTEGER]=gl.RG32I,_g[constants.FORMATS.RED_INTEGER]=gl.R32I,_g),_a[constants.TYPES.FLOAT]=(_h={},_h[constants.FORMATS.RGBA]=gl.RGBA32F,_h[constants.FORMATS.RGB]=gl.RGB32F,_h[constants.FORMATS.RG]=gl.RG32F,_h[constants.FORMATS.RED]=gl.R32F,_h[constants.FORMATS.DEPTH_COMPONENT]=gl.DEPTH_COMPONENT32F,_h),_a[constants.TYPES.HALF_FLOAT]=(_j={},_j[constants.FORMATS.RGBA]=
gl.RGBA16F,_j[constants.FORMATS.RGB]=gl.RGB16F,_j[constants.FORMATS.RG]=gl.RG16F,_j[constants.FORMATS.RED]=gl.R16F,_j),_a[constants.TYPES.UNSIGNED_SHORT_5_6_5]=(_k={},_k[constants.FORMATS.RGB]=gl.RGB565,_k),_a[constants.TYPES.UNSIGNED_SHORT_4_4_4_4]=(_l={},_l[constants.FORMATS.RGBA]=gl.RGBA4,_l),_a[constants.TYPES.UNSIGNED_SHORT_5_5_5_1]=(_m={},_m[constants.FORMATS.RGBA]=gl.RGB5_A1,_m),_a[constants.TYPES.UNSIGNED_INT_2_10_10_10_REV]=(_o={},_o[constants.FORMATS.RGBA]=gl.RGB10_A2,_o[constants.FORMATS.RGBA_INTEGER]=
gl.RGB10_A2UI,_o),_a[constants.TYPES.UNSIGNED_INT_10F_11F_11F_REV]=(_p={},_p[constants.FORMATS.RGB]=gl.R11F_G11F_B10F,_p),_a[constants.TYPES.UNSIGNED_INT_5_9_9_9_REV]=(_q={},_q[constants.FORMATS.RGB]=gl.RGB9_E5,_q),_a[constants.TYPES.UNSIGNED_INT_24_8]=(_r={},_r[constants.FORMATS.DEPTH_STENCIL]=gl.DEPTH24_STENCIL8,_r),_a[constants.TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]=(_s={},_s[constants.FORMATS.DEPTH_STENCIL]=gl.DEPTH32F_STENCIL8,_s),_a):(_t={},_t[constants.TYPES.UNSIGNED_BYTE]=(_u={},_u[constants.FORMATS.RGBA]=
gl.RGBA,_u[constants.FORMATS.RGB]=gl.RGB,_u[constants.FORMATS.ALPHA]=gl.ALPHA,_u[constants.FORMATS.LUMINANCE]=gl.LUMINANCE,_u[constants.FORMATS.LUMINANCE_ALPHA]=gl.LUMINANCE_ALPHA,_u),_t[constants.TYPES.UNSIGNED_SHORT_5_6_5]=(_v={},_v[constants.FORMATS.RGB]=gl.RGB,_v),_t[constants.TYPES.UNSIGNED_SHORT_4_4_4_4]=(_w={},_w[constants.FORMATS.RGBA]=gl.RGBA,_w),_t[constants.TYPES.UNSIGNED_SHORT_5_5_5_1]=(_x={},_x[constants.FORMATS.RGBA]=gl.RGBA,_x),_t);_a=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=
_a;for(_b=0;_b<_a;_b++)this.boundTextures[_b]=null;this.emptyTextures={};_a=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_2D,_a.texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(4));this.emptyTextures[gl.TEXTURE_2D]=_a;this.emptyTextures[gl.TEXTURE_CUBE_MAP]=new GLTexture(gl.createTexture());gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.emptyTextures[gl.TEXTURE_CUBE_MAP].texture);for(_b=0;6>_b;_b++)gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+_b,
0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,gl.LINEAR);for(_b=0;_b<this.boundTextures.length;_b++)this.bind(null,_b)};TextureSystem.prototype.bind=function(texture,location){void 0===location&&(location=0);var gl=this.gl;if((texture=null===texture||void 0===texture?void 0:texture.castToBaseTexture())&&texture.valid&&!texture.parentTextureArray){texture.touched=this.renderer.textureGC.count;
var glTexture=texture._glTextures[this.CONTEXT_UID]||this.initTexture(texture);this.boundTextures[location]!==texture&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(texture.target,glTexture.texture));glTexture.dirtyId!==texture.dirtyId&&(this.currentLocation!==location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),this.updateTexture(texture));this.boundTextures[location]=texture}else this.currentLocation!==
location&&(this.currentLocation=location,gl.activeTexture(gl.TEXTURE0+location)),gl.bindTexture(gl.TEXTURE_2D,this.emptyTextures[gl.TEXTURE_2D].texture),this.boundTextures[location]=null};TextureSystem.prototype.reset=function(){this._unknownBoundTextures=!0;this.hasIntegerTextures=!1;this.currentLocation=-1;for(var i=0;i<this.boundTextures.length;i++)this.boundTextures[i]=this.unknownTexture};TextureSystem.prototype.unbind=function(texture){var gl=this.gl,boundTextures=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=
!1;for(var i=0;i<boundTextures.length;i++)boundTextures[i]===this.unknownTexture&&this.bind(null,i)}for(i=0;i<boundTextures.length;i++)boundTextures[i]===texture&&(this.currentLocation!==i&&(gl.activeTexture(gl.TEXTURE0+i),this.currentLocation=i),gl.bindTexture(texture.target,this.emptyTextures[texture.target].texture),boundTextures[i]=null)};TextureSystem.prototype.ensureSamplerType=function(maxTextures){var boundTextures=this.boundTextures,CONTEXT_UID=this.CONTEXT_UID;if(this.hasIntegerTextures)for(--maxTextures;0<=
maxTextures;--maxTextures){var tex=boundTextures[maxTextures];tex&&tex._glTextures[CONTEXT_UID].samplerType!==constants.SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(tex)}};TextureSystem.prototype.initTexture=function(texture){var glTexture=new GLTexture(this.gl.createTexture());glTexture.dirtyId=-1;texture._glTextures[this.CONTEXT_UID]=glTexture;this.managedTextures.push(texture);texture.on("dispose",this.destroyTexture,this);return glTexture};TextureSystem.prototype.initTextureType=function(texture,
glTexture){var _a,_b;glTexture.internalFormat=null!==(_b=null===(_a=this.internalFormats[texture.type])||void 0===_a?void 0:_a[texture.format])&&void 0!==_b?_b:texture.format;glTexture.type=2===this.webGLVersion&&texture.type===constants.TYPES.HALF_FLOAT?this.gl.HALF_FLOAT:texture.type};TextureSystem.prototype.updateTexture=function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];if(glTexture){var renderer=this.renderer;this.initTextureType(texture,glTexture);if(texture.resource&&texture.resource.upload(renderer,
texture,glTexture))glTexture.samplerType!==constants.SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{var width=texture.realWidth,height=texture.realHeight;renderer=renderer.gl;if(glTexture.width!==width||glTexture.height!==height||0>glTexture.dirtyId)glTexture.width=width,glTexture.height=height,renderer.texImage2D(texture.target,0,glTexture.internalFormat,width,height,0,texture.format,glTexture.type,null)}texture.dirtyStyleId!==glTexture.dirtyStyleId&&this.updateTextureStyle(texture);glTexture.dirtyId=
texture.dirtyId}};TextureSystem.prototype.destroyTexture=function(texture,skipRemove){var gl=this.gl;texture=texture.castToBaseTexture();texture._glTextures[this.CONTEXT_UID]&&(this.unbind(texture),gl.deleteTexture(texture._glTextures[this.CONTEXT_UID].texture),texture.off("dispose",this.destroyTexture,this),delete texture._glTextures[this.CONTEXT_UID],skipRemove||(texture=this.managedTextures.indexOf(texture),-1!==texture&&utils.removeItems(this.managedTextures,texture,1)))};TextureSystem.prototype.updateTextureStyle=
function(texture){var glTexture=texture._glTextures[this.CONTEXT_UID];glTexture&&(glTexture.mipmap=texture.mipmap!==constants.MIPMAP_MODES.POW2&&2===this.webGLVersion||texture.isPowerOfTwo?1<=texture.mipmap:!1,glTexture.wrapMode=2===this.webGLVersion||texture.isPowerOfTwo?texture.wrapMode:constants.WRAP_MODES.CLAMP,texture.resource&&texture.resource.style(this.renderer,texture,glTexture)||this.setStyle(texture,glTexture),glTexture.dirtyStyleId=texture.dirtyStyleId)};TextureSystem.prototype.setStyle=
function(texture,glTexture){var gl=this.gl;glTexture.mipmap&&texture.mipmap!==constants.MIPMAP_MODES.ON_MANUAL&&gl.generateMipmap(texture.target);gl.texParameteri(texture.target,gl.TEXTURE_WRAP_S,glTexture.wrapMode);gl.texParameteri(texture.target,gl.TEXTURE_WRAP_T,glTexture.wrapMode);if(glTexture.mipmap){if(gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants.SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST),(glTexture=this.renderer.context.extensions.anisotropicFiltering)&&
0<texture.anisotropicLevel&&texture.scaleMode===constants.SCALE_MODES.LINEAR){var level=Math.min(texture.anisotropicLevel,gl.getParameter(glTexture.MAX_TEXTURE_MAX_ANISOTROPY_EXT));gl.texParameterf(texture.target,glTexture.TEXTURE_MAX_ANISOTROPY_EXT,level)}}else gl.texParameteri(texture.target,gl.TEXTURE_MIN_FILTER,texture.scaleMode===constants.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);gl.texParameteri(texture.target,gl.TEXTURE_MAG_FILTER,texture.scaleMode===constants.SCALE_MODES.LINEAR?gl.LINEAR:
gl.NEAREST)};TextureSystem.prototype.destroy=function(){this.renderer=null};return TextureSystem}(),_systems={__proto__:null,FilterSystem,BatchSystem,ContextSystem,FramebufferSystem,GeometrySystem,MaskSystem,ScissorSystem,StencilSystem,ProjectionSystem,RenderTextureSystem,ShaderSystem,StateSystem,TextureGCSystem,TextureSystem},tempMatrix$2=new math.Matrix,AbstractRenderer=function(_super){function AbstractRenderer(type,options){void 0===type&&(type=constants.RENDERER_TYPE.UNKNOWN);var _this=_super.call(this)||
this;options=Object.assign({},settings.settings.RENDER_OPTIONS,options);_this.options=options;_this.type=type;_this.screen=new math.Rectangle(0,0,options.width,options.height);_this.view=options.view||document.createElement("canvas");_this.resolution=options.resolution||settings.settings.RESOLUTION;_this.useContextAlpha=options.useContextAlpha;_this.autoDensity=!!options.autoDensity;_this.preserveDrawingBuffer=options.preserveDrawingBuffer;_this.clearBeforeRender=options.clearBeforeRender;_this._backgroundColor=
0;_this._backgroundColorRgba=[0,0,0,1];_this._backgroundColorString="#000000";_this.backgroundColor=options.backgroundColor||_this._backgroundColor;_this.backgroundAlpha=options.backgroundAlpha;void 0!==options.transparent&&(utils.deprecation("6.0.0","Option transparent is deprecated, please use backgroundAlpha instead."),_this.useContextAlpha=options.transparent,_this.backgroundAlpha=options.transparent?0:1);_this._lastObjectRendered=null;_this.plugins={};return _this}__extends(AbstractRenderer,
_super);AbstractRenderer.prototype.initPlugins=function(staticMap){for(var o in staticMap)this.plugins[o]=new staticMap[o](this)};Object.defineProperty(AbstractRenderer.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0});Object.defineProperty(AbstractRenderer.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0});AbstractRenderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){this.view.width=Math.round(desiredScreenWidth*
this.resolution);this.view.height=Math.round(desiredScreenHeight*this.resolution);desiredScreenWidth=this.view.width/this.resolution;desiredScreenHeight=this.view.height/this.resolution;this.screen.width=desiredScreenWidth;this.screen.height=desiredScreenHeight;this.autoDensity&&(this.view.style.width=desiredScreenWidth+"px",this.view.style.height=desiredScreenHeight+"px");this.emit("resize",desiredScreenWidth,desiredScreenHeight)};AbstractRenderer.prototype.generateTexture=function(displayObject,
options,resolution,region){void 0===options&&(options={});"number"===typeof options&&(utils.deprecation("6.1.0","generateTexture options (scaleMode, resolution, region) are now object options."),options={scaleMode:options,resolution,region});region=options.region;resolution=options;var e=["region"];options={};for(var p in resolution)Object.prototype.hasOwnProperty.call(resolution,p)&&0>e.indexOf(p)&&(options[p]=resolution[p]);if(null!=resolution&&"function"===typeof Object.getOwnPropertySymbols){var i=
0;for(p=Object.getOwnPropertySymbols(resolution);i<p.length;i++)0>e.indexOf(p[i])&&(options[p[i]]=resolution[p[i]])}region=region||displayObject.getLocalBounds(null,!0);0===region.width&&(region.width=1);0===region.height&&(region.height=1);p=RenderTexture.create(__assign({width:region.width,height:region.height},options));tempMatrix$2.tx=-region.x;tempMatrix$2.ty=-region.y;this.render(displayObject,{renderTexture:p,clear:!1,transform:tempMatrix$2,skipUpdateTransform:!!displayObject.parent});return p};
AbstractRenderer.prototype.destroy=function(removeView){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.plugins=null;this.type=constants.RENDERER_TYPE.UNKNOWN;this._lastObjectRendered=this._backgroundColorString=this._backgroundColorRgba=this.options=this._tempDisplayObjectParent=this.screen=this.view=null};Object.defineProperty(AbstractRenderer.prototype,"backgroundColor",{get:function(){return this._backgroundColor},
set:function(value){this._backgroundColor=value;this._backgroundColorString=utils.hex2string(value);utils.hex2rgb(value,this._backgroundColorRgba)},enumerable:!1,configurable:!0});Object.defineProperty(AbstractRenderer.prototype,"backgroundAlpha",{get:function(){return this._backgroundColorRgba[3]},set:function(value){this._backgroundColorRgba[3]=value},enumerable:!1,configurable:!0});return AbstractRenderer}(utils.EventEmitter),GLBuffer=function(){return function(buffer){this.buffer=buffer||null;
this.byteLength=this.updateID=-1;this.refCount=0}}(),BufferSystem=function(){function BufferSystem(renderer){this.renderer=renderer;this.managedBuffers={};this.boundBufferBases={}}BufferSystem.prototype.destroy=function(){this.renderer=null};BufferSystem.prototype.contextChange=function(){this.disposeAll(!0);this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID};BufferSystem.prototype.bind=function(buffer){var gl=this.gl,glBuffer=buffer._glBuffers[this.CONTEXT_UID]||this.createGLBuffer(buffer);
gl.bindBuffer(buffer.type,glBuffer.buffer)};BufferSystem.prototype.bindBufferBase=function(buffer,index){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;this.boundBufferBases[index]!==buffer&&(CONTEXT_UID=buffer._glBuffers[CONTEXT_UID]||this.createGLBuffer(buffer),this.boundBufferBases[index]=buffer,gl.bindBufferBase(gl.UNIFORM_BUFFER,index,CONTEXT_UID.buffer))};BufferSystem.prototype.bindBufferRange=function(buffer,index,offset){var gl=this.gl,CONTEXT_UID=this.CONTEXT_UID;offset=offset||0;buffer=buffer._glBuffers[CONTEXT_UID]||
this.createGLBuffer(buffer);gl.bindBufferRange(gl.UNIFORM_BUFFER,index||0,buffer.buffer,256*offset,256)};BufferSystem.prototype.update=function(buffer){var gl=this.gl,glBuffer=buffer._glBuffers[this.CONTEXT_UID];if(buffer._updateID!==glBuffer.updateID)if(glBuffer.updateID=buffer._updateID,gl.bindBuffer(buffer.type,glBuffer.buffer),glBuffer.byteLength>=buffer.data.byteLength)gl.bufferSubData(buffer.type,0,buffer.data);else{var drawType=buffer.static?gl.STATIC_DRAW:gl.DYNAMIC_DRAW;glBuffer.byteLength=
buffer.data.byteLength;gl.bufferData(buffer.type,buffer.data,drawType)}};BufferSystem.prototype.dispose=function(buffer,contextLost){if(this.managedBuffers[buffer.id]){delete this.managedBuffers[buffer.id];var glBuffer=buffer._glBuffers[this.CONTEXT_UID],gl=this.gl;buffer.disposeRunner.remove(this);glBuffer&&(contextLost||gl.deleteBuffer(glBuffer.buffer),delete buffer._glBuffers[this.CONTEXT_UID])}};BufferSystem.prototype.disposeAll=function(contextLost){for(var all=Object.keys(this.managedBuffers),
i=0;i<all.length;i++)this.dispose(this.managedBuffers[all[i]],contextLost)};BufferSystem.prototype.createGLBuffer=function(buffer){var CONTEXT_UID=this.CONTEXT_UID;buffer._glBuffers[CONTEXT_UID]=new GLBuffer(this.gl.createBuffer());this.managedBuffers[buffer.id]=buffer;buffer.disposeRunner.add(this);return buffer._glBuffers[CONTEXT_UID]};return BufferSystem}(),Renderer=function(_super){function Renderer(options){var _this=_super.call(this,constants.RENDERER_TYPE.WEBGL,options)||this;options=_this.options;
_this.gl=null;_this.CONTEXT_UID=0;_this.runners={destroy:new runner.Runner("destroy"),contextChange:new runner.Runner("contextChange"),reset:new runner.Runner("reset"),update:new runner.Runner("update"),postrender:new runner.Runner("postrender"),prerender:new runner.Runner("prerender"),resize:new runner.Runner("resize")};_this.runners.contextChange.add(_this);_this.globalUniforms=new UniformGroup({projectionMatrix:new math.Matrix},!0);_this.addSystem(MaskSystem,"mask").addSystem(ContextSystem,"context").addSystem(StateSystem,
"state").addSystem(ShaderSystem,"shader").addSystem(TextureSystem,"texture").addSystem(BufferSystem,"buffer").addSystem(GeometrySystem,"geometry").addSystem(FramebufferSystem,"framebuffer").addSystem(ScissorSystem,"scissor").addSystem(StencilSystem,"stencil").addSystem(ProjectionSystem,"projection").addSystem(TextureGCSystem,"textureGC").addSystem(FilterSystem,"filter").addSystem(RenderTextureSystem,"renderTexture").addSystem(BatchSystem,"batch");_this.initPlugins(Renderer.__plugins);_this.multisample=
void 0;options.context?_this.context.initFromContext(options.context):_this.context.initFromOptions({alpha:!!_this.useContextAlpha,antialias:options.antialias,premultipliedAlpha:_this.useContextAlpha&&"notMultiplied"!==_this.useContextAlpha,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer,powerPreference:_this.options.powerPreference});_this.renderingToScreen=!0;utils.sayHello(2===_this.context.webGLVersion?"WebGL 2":"WebGL 1");_this.resize(_this.options.width,_this.options.height);
return _this}__extends(Renderer,_super);Renderer.create=function(options){if(utils.isWebGLSupported())return new Renderer(options);throw Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.');};Renderer.prototype.contextChange=function(){var gl=this.gl;if(1===this.context.webGLVersion){var framebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);gl.bindFramebuffer(gl.FRAMEBUFFER,null);var samples=gl.getParameter(gl.SAMPLES);gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer)}else framebuffer=
gl.getParameter(gl.DRAW_FRAMEBUFFER_BINDING),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null),samples=gl.getParameter(gl.SAMPLES),gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,framebuffer);this.multisample=samples>=constants.MSAA_QUALITY.HIGH?constants.MSAA_QUALITY.HIGH:samples>=constants.MSAA_QUALITY.MEDIUM?constants.MSAA_QUALITY.MEDIUM:samples>=constants.MSAA_QUALITY.LOW?constants.MSAA_QUALITY.LOW:constants.MSAA_QUALITY.NONE};Renderer.prototype.addSystem=function(ClassRef,name){ClassRef=new ClassRef(this);
if(this[name])throw Error('Whoops! The name "'+name+'" is already in use');this[name]=ClassRef;for(var i in this.runners)this.runners[i].add(ClassRef);return this};Renderer.prototype.render=function(displayObject,options,JSCompiler_OptimizeArgumentsArray_p7,JSCompiler_OptimizeArgumentsArray_p8,JSCompiler_OptimizeArgumentsArray_p9){if(options)if(options instanceof RenderTexture){utils.deprecation("6.0.0","Renderer#render arguments changed, use options instead.");var renderTexture=options;var clear=
JSCompiler_OptimizeArgumentsArray_p7;var transform=JSCompiler_OptimizeArgumentsArray_p8;var skipUpdateTransform=JSCompiler_OptimizeArgumentsArray_p9}else renderTexture=options.renderTexture,clear=options.clear,transform=options.transform,skipUpdateTransform=options.skipUpdateTransform;this.renderingToScreen=!renderTexture;this.runners.prerender.emit();this.emit("prerender");this.projection.transform=transform;this.context.isLost||(renderTexture||(this._lastObjectRendered=displayObject),skipUpdateTransform||
(options=displayObject.enableTempParent(),displayObject.updateTransform(),displayObject.disableTempParent(options)),this.renderTexture.bind(renderTexture),this.batch.currentRenderer.start(),(void 0!==clear?clear:this.clearBeforeRender)&&this.renderTexture.clear(),displayObject.render(this),this.batch.currentRenderer.flush(),renderTexture&&renderTexture.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender"))};Renderer.prototype.generateTexture=function(displayObject,
options,resolution,region){void 0===options&&(options={});displayObject=_super.prototype.generateTexture.call(this,displayObject,options,resolution,region);this.framebuffer.blit();return displayObject};Renderer.prototype.resize=function(desiredScreenWidth,desiredScreenHeight){_super.prototype.resize.call(this,desiredScreenWidth,desiredScreenHeight);this.runners.resize.emit(this.screen.height,this.screen.width)};Renderer.prototype.reset=function(){this.runners.reset.emit();return this};Renderer.prototype.clear=
function(){this.renderTexture.bind();this.renderTexture.clear()};Renderer.prototype.destroy=function(removeView){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();_super.prototype.destroy.call(this,removeView);this.gl=null};Object.defineProperty(Renderer.prototype,"extract",{get:function(){utils.deprecation("6.0.0","Renderer#extract has been deprecated, please use Renderer#plugins.extract instead.");return this.plugins.extract},enumerable:!1,configurable:!0});Renderer.registerPlugin=
function(pluginName,ctor){Renderer.__plugins=Renderer.__plugins||{};Renderer.__plugins[pluginName]=ctor};return Renderer}(AbstractRenderer),System=function(){function System(renderer){utils.deprecation("6.1.0","System class is deprecated, implemement ISystem interface instead.");this.renderer=renderer}System.prototype.destroy=function(){this.renderer=null};return System}(),BatchDrawCall=function(){return function(){this.texArray=null;this.blend=0;this.type=constants.DRAW_MODES.TRIANGLES;this.size=
this.start=0;this.data=null}}(),BatchTextureArray=function(){function BatchTextureArray(){this.elements=[];this.ids=[];this.count=0}BatchTextureArray.prototype.clear=function(){for(var i=0;i<this.count;i++)this.elements[i]=null;this.count=0};return BatchTextureArray}(),ViewableBuffer=function(){function ViewableBuffer(sizeOrBuffer){this.rawBinaryData="number"===typeof sizeOrBuffer?new ArrayBuffer(sizeOrBuffer):sizeOrBuffer instanceof Uint8Array?sizeOrBuffer.buffer:sizeOrBuffer;this.uint32View=new Uint32Array(this.rawBinaryData);
this.float32View=new Float32Array(this.rawBinaryData)}Object.defineProperty(ViewableBuffer.prototype,"int8View",{get:function(){this._int8View||(this._int8View=new Int8Array(this.rawBinaryData));return this._int8View},enumerable:!1,configurable:!0});Object.defineProperty(ViewableBuffer.prototype,"uint8View",{get:function(){this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData));return this._uint8View},enumerable:!1,configurable:!0});Object.defineProperty(ViewableBuffer.prototype,"int16View",
{get:function(){this._int16View||(this._int16View=new Int16Array(this.rawBinaryData));return this._int16View},enumerable:!1,configurable:!0});Object.defineProperty(ViewableBuffer.prototype,"uint16View",{get:function(){this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData));return this._uint16View},enumerable:!1,configurable:!0});Object.defineProperty(ViewableBuffer.prototype,"int32View",{get:function(){this._int32View||(this._int32View=new Int32Array(this.rawBinaryData));return this._int32View},
enumerable:!1,configurable:!0});ViewableBuffer.prototype.view=function(type){return this[type+"View"]};ViewableBuffer.prototype.destroy=function(){this.float32View=this.uint32View=this._int32View=this._uint16View=this._int16View=this._uint8View=this._int8View=this.rawBinaryData=null};ViewableBuffer.sizeOf=function(type){switch(type){case "int8":case "uint8":return 1;case "int16":case "uint16":return 2;case "int32":case "uint32":case "float32":return 4;default:throw Error(type+" isn't a valid view type");
}};return ViewableBuffer}(),AbstractBatchRenderer=function(_super){function AbstractBatchRenderer(renderer){var _this=_super.call(this,renderer)||this;_this.shaderGenerator=null;_this.geometryClass=null;_this.vertexSize=null;_this.state=State.for2d();_this.size=4*settings.settings.SPRITE_BATCH_SIZE;_this._vertexCount=0;_this._indexCount=0;_this._bufferedElements=[];_this._bufferedTextures=[];_this._bufferSize=0;_this._shader=null;_this._packedGeometries=[];_this._packedGeometryPoolSize=2;_this._flushId=
0;_this._aBuffers={};_this._iBuffers={};_this.MAX_TEXTURES=1;_this.renderer.on("prerender",_this.onPrerender,_this);renderer.runners.contextChange.add(_this);_this._dcIndex=0;_this._aIndex=0;_this._iIndex=0;_this._attributeBuffer=null;_this._indexBuffer=null;_this._tempBoundTextures=[];return _this}__extends(AbstractBatchRenderer,_super);AbstractBatchRenderer.prototype.contextChange=function(){var gl=this.renderer.gl;settings.settings.PREFER_ENV===constants.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=
Math.min(gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),settings.settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,gl));this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(gl=0;gl<this._packedGeometryPoolSize;gl++)this._packedGeometries[gl]=new this.geometryClass;this.initFlushBuffers()};AbstractBatchRenderer.prototype.initFlushBuffers=function(){for(var _drawCallPool=AbstractBatchRenderer._drawCallPool,_textureArrayPool=AbstractBatchRenderer._textureArrayPool,
MAX_SPRITES=this.size/4,MAX_TA=Math.floor(MAX_SPRITES/this.MAX_TEXTURES)+1;_drawCallPool.length<MAX_SPRITES;)_drawCallPool.push(new BatchDrawCall);for(;_textureArrayPool.length<MAX_TA;)_textureArrayPool.push(new BatchTextureArray);for(_drawCallPool=0;_drawCallPool<this.MAX_TEXTURES;_drawCallPool++)this._tempBoundTextures[_drawCallPool]=null};AbstractBatchRenderer.prototype.onPrerender=function(){this._flushId=0};AbstractBatchRenderer.prototype.render=function(element){element._texture.valid&&(this._vertexCount+
element.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=element.vertexData.length/2,this._indexCount+=element.indices.length,this._bufferedTextures[this._bufferSize]=element._texture.baseTexture,this._bufferedElements[this._bufferSize++]=element)};AbstractBatchRenderer.prototype.buildTexturesAndDrawCalls=function(){var textures=this._bufferedTextures,MAX_TEXTURES=this.MAX_TEXTURES,textureArrays=AbstractBatchRenderer._textureArrayPool,batch=this.renderer.batch,boundTextures=this._tempBoundTextures,
touch=this.renderer.textureGC.count,TICK=++BaseTexture._globalBatch,countTexArrays=0,texArray=textureArrays[0],start=0;batch.copyBoundTextures(boundTextures,MAX_TEXTURES);for(var i=0;i<this._bufferSize;++i){var tex=textures[i];textures[i]=null;tex._batchEnabled!==TICK&&(texArray.count>=MAX_TEXTURES&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,i),start=i,texArray=textureArrays[++countTexArrays],++TICK),tex._batchEnabled=TICK,tex.touched=touch,texArray.elements[texArray.count++]=
tex)}0<texArray.count&&(batch.boundArray(texArray,boundTextures,TICK,MAX_TEXTURES),this.buildDrawCalls(texArray,start,this._bufferSize),++TICK);for(i=0;i<boundTextures.length;i++)boundTextures[i]=null;BaseTexture._globalBatch=TICK};AbstractBatchRenderer.prototype.buildDrawCalls=function(texArray,start,finish){var elements=this._bufferedElements,_attributeBuffer=this._attributeBuffer,_indexBuffer=this._indexBuffer,vertexSize=this.vertexSize,drawCalls=AbstractBatchRenderer._drawCallPool,dcIndex=this._dcIndex,
aIndex=this._aIndex,iIndex=this._iIndex,drawCall=drawCalls[dcIndex];drawCall.start=this._iIndex;drawCall.texArray=texArray;for(var i=start;i<finish;++i){var sprite=elements[i],spriteBlendMode=utils.premultiplyBlendMode[sprite._texture.baseTexture.alphaMode?1:0][sprite.blendMode];elements[i]=null;start<i&&drawCall.blend!==spriteBlendMode&&(drawCall.size=iIndex-drawCall.start,start=i,drawCall=drawCalls[++dcIndex],drawCall.texArray=texArray,drawCall.start=iIndex);this.packInterleavedGeometry(sprite,
_attributeBuffer,_indexBuffer,aIndex,iIndex);aIndex+=sprite.vertexData.length/2*vertexSize;iIndex+=sprite.indices.length;drawCall.blend=spriteBlendMode}start<finish&&(drawCall.size=iIndex-drawCall.start,++dcIndex);this._dcIndex=dcIndex;this._aIndex=aIndex;this._iIndex=iIndex};AbstractBatchRenderer.prototype.bindAndClearTexArray=function(texArray){for(var textureSystem=this.renderer.texture,j=0;j<texArray.count;j++)textureSystem.bind(texArray.elements[j],texArray.ids[j]),texArray.elements[j]=null;
texArray.count=0};AbstractBatchRenderer.prototype.updateGeometry=function(){var packedGeometries=this._packedGeometries,attributeBuffer=this._attributeBuffer,indexBuffer=this._indexBuffer;settings.settings.CAN_UPLOAD_SAME_BUFFER?(packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,packedGeometries[this._flushId]=
new this.geometryClass),packedGeometries[this._flushId]._buffer.update(attributeBuffer.rawBinaryData),packedGeometries[this._flushId]._indexBuffer.update(indexBuffer),this.renderer.geometry.bind(packedGeometries[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)};AbstractBatchRenderer.prototype.drawBatches=function(){var dcCount=this._dcIndex,_a=this.renderer,gl=_a.gl;_a=_a.state;for(var drawCalls=AbstractBatchRenderer._drawCallPool,curTexArray=null,i=0;i<dcCount;i++){var _b=
drawCalls[i],texArray=_b.texArray,type=_b.type,size=_b.size,start=_b.start;_b=_b.blend;curTexArray!==texArray&&(curTexArray=texArray,this.bindAndClearTexArray(texArray));this.state.blendMode=_b;_a.set(this.state);gl.drawElements(type,size,gl.UNSIGNED_SHORT,2*start)}};AbstractBatchRenderer.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._dcIndex=this._iIndex=this._aIndex=
0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._indexCount=this._vertexCount=this._bufferSize=0)};AbstractBatchRenderer.prototype.start=function(){this.renderer.state.set(this.state);this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES);this.renderer.shader.bind(this._shader);settings.settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])};AbstractBatchRenderer.prototype.stop=function(){this.flush()};AbstractBatchRenderer.prototype.destroy=
function(){for(var i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this);this._indexBuffer=this._attributeBuffer=this._packedGeometries=this._iBuffers=this._aBuffers=null;this._shader&&(this._shader.destroy(),this._shader=null);_super.prototype.destroy.call(this)};AbstractBatchRenderer.prototype.getAttributeBuffer=function(size){var roundedP2=utils.nextPow2(Math.ceil(size/8));size=utils.log2(roundedP2);
roundedP2*=8;this._aBuffers.length<=size&&(this._iBuffers.length=size+1);(size=this._aBuffers[roundedP2])||(this._aBuffers[roundedP2]=size=new ViewableBuffer(roundedP2*this.vertexSize*4));return size};AbstractBatchRenderer.prototype.getIndexBuffer=function(size){size=utils.nextPow2(Math.ceil(size/12));var roundedSizeIndex=utils.log2(size);this._iBuffers.length<=roundedSizeIndex&&(this._iBuffers.length=roundedSizeIndex+1);var buffer=this._iBuffers[roundedSizeIndex];buffer||(this._iBuffers[roundedSizeIndex]=
buffer=new Uint16Array(12*size));return buffer};AbstractBatchRenderer.prototype.packInterleavedGeometry=function(element,attributeBuffer,indexBuffer,aIndex,iIndex){var uint32View=attributeBuffer.uint32View;attributeBuffer=attributeBuffer.float32View;var packedVertices=aIndex/this.vertexSize,uvs=element.uvs,indicies=element.indices,vertexData=element.vertexData,textureId=element._texture.baseTexture._batchLocation,alpha=Math.min(element.worldAlpha,1);element=1>alpha&&element._texture.baseTexture.alphaMode?
utils.premultiplyTint(element._tintRGB,alpha):element._tintRGB+(255*alpha<<24);for(alpha=0;alpha<vertexData.length;alpha+=2)attributeBuffer[aIndex++]=vertexData[alpha],attributeBuffer[aIndex++]=vertexData[alpha+1],attributeBuffer[aIndex++]=uvs[alpha],attributeBuffer[aIndex++]=uvs[alpha+1],uint32View[aIndex++]=element,attributeBuffer[aIndex++]=textureId;for(alpha=0;alpha<indicies.length;alpha++)indexBuffer[iIndex++]=packedVertices+indicies[alpha]};AbstractBatchRenderer._drawCallPool=[];AbstractBatchRenderer._textureArrayPool=
[];return AbstractBatchRenderer}(ObjectRenderer),BatchShaderGenerator=function(){function BatchShaderGenerator(vertexSrc,fragTemplate){this.vertexSrc=vertexSrc;this.fragTemplate=fragTemplate;this.programCache={};this.defaultGroupCache={};if(0>fragTemplate.indexOf("%count%"))throw Error('Fragment template must contain "%count%".');if(0>fragTemplate.indexOf("%forloop%"))throw Error('Fragment template must contain "%forloop%".');}BatchShaderGenerator.prototype.generateShader=function(maxTextures){if(!this.programCache[maxTextures]){for(var sampleValues=
new Int32Array(maxTextures),i=0;i<maxTextures;i++)sampleValues[i]=i;this.defaultGroupCache[maxTextures]=UniformGroup.from({uSamplers:sampleValues},!0);sampleValues=this.fragTemplate;sampleValues=sampleValues.replace(/%count%/gi,""+maxTextures);sampleValues=sampleValues.replace(/%forloop%/gi,this.generateSampleSrc(maxTextures));this.programCache[maxTextures]=new Program(this.vertexSrc,sampleValues)}sampleValues={tint:new Float32Array([1,1,1,1]),translationMatrix:new math.Matrix,default:this.defaultGroupCache[maxTextures]};
return new Shader(this.programCache[maxTextures],sampleValues)};BatchShaderGenerator.prototype.generateSampleSrc=function(maxTextures){var src="\n\n";for(var i=0;i<maxTextures;i++)0<i&&(src+="\nelse "),i<maxTextures-1&&(src+="if(vTextureId \x3c "+i+".5)"),src+="\n{",src+="\n\tcolor \x3d texture2D(uSamplers["+i+"], vTextureCoord);",src+="\n}";return src+"\n\n"};return BatchShaderGenerator}(),BatchGeometry=function(_super){function BatchGeometry(_static){void 0===_static&&(_static=!1);var _this=_super.call(this)||
this;_this._buffer=new Buffer$jscomp$0(null,_static,!1);_this._indexBuffer=new Buffer$jscomp$0(null,_static,!0);_this.addAttribute("aVertexPosition",_this._buffer,2,!1,constants.TYPES.FLOAT).addAttribute("aTextureCoord",_this._buffer,2,!1,constants.TYPES.FLOAT).addAttribute("aColor",_this._buffer,4,!0,constants.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",_this._buffer,1,!0,constants.TYPES.FLOAT).addIndex(_this._indexBuffer);return _this}__extends(BatchGeometry,_super);return BatchGeometry}(Geometry),
BatchPluginFactory=function(){function BatchPluginFactory(){}BatchPluginFactory.create=function(options){options=Object.assign({vertex:"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position \x3d vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord \x3d aTextureCoord;\n    vTextureId \x3d aTextureId;\n    vColor \x3d aColor * tint;\n}\n",
fragment:"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor \x3d color * vColor;\n}\n",geometryClass:BatchGeometry,vertexSize:6},options);var vertex=options.vertex,fragment=options.fragment,vertexSize=options.vertexSize,geometryClass=options.geometryClass;return function(_super){function BatchPlugin(renderer){renderer=_super.call(this,renderer)||this;renderer.shaderGenerator=
new BatchShaderGenerator(vertex,fragment);renderer.geometryClass=geometryClass;renderer.vertexSize=vertexSize;return renderer}__extends(BatchPlugin,_super);return BatchPlugin}(AbstractBatchRenderer)};Object.defineProperty(BatchPluginFactory,"defaultVertexSrc",{get:function(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position \x3d vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord \x3d aTextureCoord;\n    vTextureId \x3d aTextureId;\n    vColor \x3d aColor * tint;\n}\n"},
enumerable:!1,configurable:!0});Object.defineProperty(BatchPluginFactory,"defaultFragmentTemplate",{get:function(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor \x3d color * vColor;\n}\n"},enumerable:!1,configurable:!0});return BatchPluginFactory}(),BatchRenderer=BatchPluginFactory.create(),resources={},_loop_1=function(name){Object.defineProperty(resources,
name,{get:function(){utils.deprecation("6.0.0","PIXI.systems."+name+" has moved to PIXI."+name);return _resources[name]}})},name$jscomp$0;for(name$jscomp$0 in _resources)_loop_1(name$jscomp$0);var systems={},_loop_2=function(name){Object.defineProperty(systems,name,{get:function(){utils.deprecation("6.0.0","PIXI.resources."+name+" has moved to PIXI."+name);return _systems[name]}})};for(name$jscomp$0 in _systems)_loop_2(name$jscomp$0);exports.AbstractBatchRenderer=AbstractBatchRenderer;exports.AbstractMultiResource=
AbstractMultiResource;exports.AbstractRenderer=AbstractRenderer;exports.ArrayResource=ArrayResource;exports.Attribute=Attribute;exports.BaseImageResource=BaseImageResource;exports.BaseRenderTexture=BaseRenderTexture;exports.BaseTexture=BaseTexture;exports.BatchDrawCall=BatchDrawCall;exports.BatchGeometry=BatchGeometry;exports.BatchPluginFactory=BatchPluginFactory;exports.BatchRenderer=BatchRenderer;exports.BatchShaderGenerator=BatchShaderGenerator;exports.BatchSystem=BatchSystem;exports.BatchTextureArray=
BatchTextureArray;exports.Buffer=Buffer$jscomp$0;exports.BufferResource=BufferResource;exports.CanvasResource=CanvasResource;exports.ContextSystem=ContextSystem;exports.CubeResource=CubeResource;exports.Filter=Filter$jscomp$0;exports.FilterState=FilterState;exports.FilterSystem=FilterSystem;exports.Framebuffer=Framebuffer;exports.FramebufferSystem=FramebufferSystem;exports.GLFramebuffer=GLFramebuffer;exports.GLProgram=GLProgram;exports.GLTexture=GLTexture;exports.Geometry=Geometry;exports.GeometrySystem=
GeometrySystem;exports.IGLUniformData=IGLUniformData;exports.INSTALLED=INSTALLED;exports.ImageBitmapResource=ImageBitmapResource;exports.ImageResource=ImageResource;exports.MaskData=MaskData;exports.MaskSystem=MaskSystem;exports.ObjectRenderer=ObjectRenderer;exports.Program=Program;exports.ProjectionSystem=ProjectionSystem;exports.Quad=Quad;exports.QuadUv=QuadUv;exports.RenderTexture=RenderTexture;exports.RenderTexturePool=RenderTexturePool;exports.RenderTextureSystem=RenderTextureSystem;exports.Renderer=
Renderer;exports.Resource=Resource;exports.SVGResource=SVGResource;exports.ScissorSystem=ScissorSystem;exports.Shader=Shader;exports.ShaderSystem=ShaderSystem;exports.SpriteMaskFilter=SpriteMaskFilter;exports.State=State;exports.StateSystem=StateSystem;exports.StencilSystem=StencilSystem;exports.System=System;exports.Texture=Texture;exports.TextureGCSystem=TextureGCSystem;exports.TextureMatrix=TextureMatrix;exports.TextureSystem=TextureSystem;exports.TextureUvs=TextureUvs;exports.UniformGroup=UniformGroup;
exports.VideoResource=VideoResource;exports.ViewableBuffer=ViewableBuffer;exports.autoDetectRenderer=function(options){return Renderer.create(options)};exports.autoDetectResource=autoDetectResource;exports.checkMaxIfStatementsInShader=checkMaxIfStatementsInShader;exports.createUBOElements=createUBOElements;exports.defaultFilterVertex="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position \x3d aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position \x3d filterVertexPosition();\n    vTextureCoord \x3d filterTextureCoord();\n}\n";
exports.defaultVertex="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position \x3d vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord \x3d aTextureCoord;\n}";exports.generateProgram=generateProgram;exports.generateUniformBufferSync=generateUniformBufferSync;exports.getTestContext=getTestContext;exports.getUBOData=getUBOData;exports.resources=resources;
exports.systems=systems;exports.uniformParsers=uniformParsers}
//# sourceMappingURL=module$node_modules$$pixi$core$dist$cjs$core.js.map
