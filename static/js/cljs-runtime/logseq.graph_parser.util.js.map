{"version":3,"sources":["logseq/graph_parser/util.cljs"],"mappings":"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","names":["logseq.graph-parser.util/safe-re-find","pattern","s","js/console.trace","cljs.core/re-find","logseq.graph-parser.util/path-normalize","logseq.graph-parser.util/remove-nils","nm","clojure.walk/postwalk","el","cljs.core/map?","cljs.core.into","cljs.core.remove","cljs.core.comp","cljs.core/nil?","cljs.core/second","logseq.graph-parser.util/split-first","temp__5720__auto__","first-index","clojure.string.index_of","cljs.core.subs","cljs.core/count","logseq.graph-parser.util/split-last","last-index","clojure.string.last_index_of","logseq.graph-parser.util/tag-valid?","tag-name","cljs.core/not","var_args","G__51811","logseq.graph-parser.util/safe-subs","js/Error","start","c","logseq.graph_parser.util.safe_subs","end","x__5131__auto__","y__5132__auto__","logseq.graph-parser.util/unquote-string","v","clojure.string/trim","logseq.graph-parser.util/wrapped-by-quotes?","cljs.core._EQ_","cljs.core/first","cljs.core/last","logseq.graph-parser.util/url?","and__5041__auto__","e51815","js/URL","_e","logseq.graph-parser.util/json->clj","json-string","js/JSON.parse","cljs.core.js__GT_clj","logseq.graph-parser.util/zero-pad","n","logseq.graph-parser.util/get-file-ext","file","clojure.string/includes?","G__51843","clojure.string.split","clojure.string/lower-case","logseq.graph-parser.util/remove-boundary-slashes","logseq.graph-parser.util/split-namespace-pages","title","parts","others","cljs.core/rest","result","cljs.core/seq","prev","cljs.core.conj","G__51875","logseq.graph-parser.util/page-name-sanity","page-name","logseq.graph_parser.util.page_name_sanity","replace-slash?","page","G__51876","clojure.string/replace","logseq.graph-parser.util/page-name-sanity-lc","logseq.graph-parser.util/capitalize-all","G__51878","cljs.core.map","clojure.string/capitalize","clojure.string.join","logseq.graph-parser.util/distinct-by","f","col","cljs.core.reduce","acc","x","p1__51882#","cljs.core/some","cljs.core/vec","logseq.graph-parser.util/normalize-format","format","G__51883","cljs.core/Keyword","cljs.core.keyword","logseq.graph-parser.util/get-format"],"sourcesContent":["(ns ^:nbb-compatible logseq.graph-parser.util\n  \"Util fns shared between graph-parser and rest of app. Util fns only rely on\n  clojure standard libraries.\"\n  (:require [clojure.walk :as walk]\n            [clojure.string :as string]))\n\n(defn safe-re-find\n  \"Copy of frontend.util/safe-re-find. Too basic to couple to main app\"\n  [pattern s]\n  (when-not (string? s)\n    ;; TODO: sentry\n    (js/console.trace))\n  (when (string? s)\n    (re-find pattern s)))\n\n(defn path-normalize\n  \"Normalize file path (for reading paths from FS, not required by writting)\"\n  [s]\n  (.normalize s \"NFC\"))\n\n(defn remove-nils\n  \"remove pairs of key-value that has nil value from a (possibly nested) map.\"\n  [nm]\n  (walk/postwalk\n   (fn [el]\n     (if (map? el)\n       (into {} (remove (comp nil? second)) el)\n       el))\n   nm))\n\n(defn split-first [pattern s]\n  (when-let [first-index (string/index-of s pattern)]\n    [(subs s 0 first-index)\n     (subs s (+ first-index (count pattern)) (count s))]))\n\n(defn split-last [pattern s]\n  (when-let [last-index (string/last-index-of s pattern)]\n    [(subs s 0 last-index)\n     (subs s (+ last-index (count pattern)) (count s))]))\n\n(defn tag-valid?\n  [tag-name]\n  (when (string? tag-name)\n    (not (safe-re-find #\"[# \\t\\r\\n]+\" tag-name))))\n\n(defn safe-subs\n  ([s start]\n   (let [c (count s)]\n     (safe-subs s start c)))\n  ([s start end]\n   (let [c (count s)]\n     (subs s (min c start) (min c end)))))\n\n(defn unquote-string\n  [v]\n  (string/trim (subs v 1 (dec (count v)))))\n\n(defn wrapped-by-quotes?\n  [v]\n  (and (string? v) (>= (count v) 2) (= \"\\\"\" (first v) (last v))))\n\n(defn url?\n  [s]\n  (and (string? s)\n       (try\n         (js/URL. s)\n         true\n         (catch js/Error _e\n           false))))\n\n(defn json->clj\n  [json-string]\n  (-> json-string\n      (js/JSON.parse)\n      (js->clj :keywordize-keys true)))\n\n(defn zero-pad\n  \"Copy of frontend.util/zero-pad. Too basic to couple to main app\"\n  [n]\n  (if (< n 10)\n    (str \"0\" n)\n    (str n)))\n\n(defn get-file-ext\n  \"Copy of frontend.util/get-file-ext. Too basic to couple to main app\"\n  [file]\n  (and\n   (string? file)\n   (string/includes? file \".\")\n   (some-> (last (string/split file #\"\\.\")) string/lower-case)))\n\n(defn remove-boundary-slashes\n  [s]\n  (when (string? s)\n    (let [s (if (= \\/ (first s))\n              (subs s 1)\n              s)]\n      (if (= \\/ (last s))\n        (subs s 0 (dec (count s)))\n        s))))\n\n(defn split-namespace-pages\n  [title]\n  (let [parts (string/split title \"/\")]\n    (loop [others (rest parts)\n           result [(first parts)]]\n      (if (seq others)\n        (let [prev (last result)]\n          (recur (rest others)\n                 (conj result (str prev \"/\" (first others)))))\n        result))))\n\n(defn page-name-sanity\n  \"Sanitize the page-name.\"\n  ([page-name]\n   (page-name-sanity page-name false))\n  ([page-name replace-slash?]\n   (let [page (some-> page-name\n                      (remove-boundary-slashes)\n                      (path-normalize))]\n     (if replace-slash?\n       (string/replace page #\"/\" \"%2A\")\n       page))))\n\n(defn page-name-sanity-lc\n  \"Sanitize the query string for a page name (mandate for :block/name)\"\n  [s]\n  (page-name-sanity (string/lower-case s)))\n\n(defn capitalize-all\n  [s]\n  (some->> (string/split s #\" \")\n           (map string/capitalize)\n           (string/join \" \")))\n\n(defn distinct-by\n  \"Copy of frontend.util/distinct-by. Too basic to couple to main app\"\n  [f col]\n  (reduce\n   (fn [acc x]\n     (if (some #(= (f x) (f %)) acc)\n       acc\n       (vec (conj acc x))))\n   []\n   col))\n\n(defn normalize-format\n  [format]\n  (case (keyword format)\n    :md :markdown\n    :asciidoc :adoc\n    ;; default\n    (keyword format)))\n\n(defn get-format\n  [file]\n  (when file\n    (normalize-format (keyword (string/lower-case (last (string/split file #\"\\.\")))))))\n"]}