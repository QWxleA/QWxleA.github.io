{"version":3,"sources":["cljs_drag_n_drop/core.cljs"],"mappings":"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","names":["cljs-drag-n-drop.core/kill-timer!","*timer","temp__5724__auto__","cljs.core/deref","t","js/clearTimeout","cljs.core/reset!","cljs-drag-n-drop.core/dom-key","key","var_args","G__108457","cljs-drag-n-drop.core/noop","js/Error","_","cljs-drag-n-drop.core/subscribe!","el","opts","cljs.core.merge","cljs.core.atom","*ignore?","*enters","dragstart","dragend","end!","e","fexpr__108459","fexpr__108462","dragover","js/setTimeout","fexpr__108466","drop","files","cljs_drag_n_drop.core.goog$module$goog$object.get","fexpr__108471","dragenter","fexpr__108472","fexpr__108473","cljs.core.swap_BANG_","cljs.core/inc","dragleave","p1__108458#","x__4336__auto__","y__4337__auto__","fexpr__108476","js/document.documentElement.addEventListener","cljs_drag_n_drop.core.goog$module$goog$object.set","cljs-drag-n-drop.core/unsubscribe!","s","cljs_drag_n_drop.core.goog$module$goog$object.remove","fexpr__108477","js/document.documentElement.removeEventListener"],"sourcesContent":["(ns cljs-drag-n-drop.core\n  (:require\n    [clojure.string :as str]\n    [goog.object :as gobj]))\n\n\n(defn- kill-timer! [*timer]\n  (when-some [t @*timer]\n    (js/clearTimeout t)\n    (reset! *timer nil)))\n\n\n(defn- dom-key [key]\n  (str \"cljs-drag-n-drop.\" key))\n\n\n(defn- noop ([_]) ([_ _]))\n\n\n(defn subscribe! [el key opts]\n  (let [opts        (merge { :timeout-ms 500 :start noop :enter noop :drop noop :leave noop :end noop } opts)\n        *timer      (atom nil)\n        *ignore?    (atom nil)\n        *enters     (atom 0)\n        dragstart   (fn [_] (reset! *ignore? true))\n        dragend     (fn [_] (reset! *ignore? false))\n        end!        (fn [e]\n                      (kill-timer! *timer)\n                      (when (pos? @*enters)\n                        (reset! *enters 0)\n                        ((:leave opts) e))\n                      ((:end opts) e))\n        dragover    (fn [e]\n                      (when-not @*ignore?\n                        (.preventDefault e)\n                        (when (and (== 0 @*enters) (nil? @*timer))\n                          (js/setTimeout #((:start opts) e) 0))\n                        (kill-timer! *timer)\n                        (reset! *timer\n                          (js/setTimeout\n                            (fn []\n                              (reset! *timer nil)\n                              (end! e))\n                            (:timeout-ms opts)))))\n        drop        (fn [e]\n                      (when-not @*ignore?\n                        (.preventDefault e)\n                        (let [files (-> e (gobj/get \"dataTransfer\") (gobj/get \"files\"))]\n                          ((:drop opts) e files))\n                        (end! e)))\n        dragenter   (fn [e]\n                      (when (nil? @*timer)\n                        (js/setTimeout #((:start opts) e) 0))\n                      (when (== 0 @*enters)\n                        ((:enter opts) e))\n                      (swap! *enters inc))\n        dragleave   (fn [e]\n                      (swap! *enters #(max 0 (dec %)))\n                      (when (== 0 @*enters)\n                        ((:leave opts) e)))]\n    (js/document.documentElement.addEventListener \"dragstart\" dragstart)\n    (js/document.documentElement.addEventListener \"drag\" dragstart)\n    (js/document.documentElement.addEventListener \"dragend\" dragend)\n    (js/document.documentElement.addEventListener \"dragover\" dragover)\n    (.addEventListener el \"drop\" drop)\n    (.addEventListener el \"dragenter\" dragenter)\n    (.addEventListener el \"dragleave\" dragleave)\n    (gobj/set el (dom-key key)\n      { :timer     *timer\n        :ignore?   *ignore?\n        :enters    *enters\n        :dragstart dragstart\n        :dragend   dragend\n        :end       end!\n        :dragover  dragover\n        :drop      drop\n        :dragenter dragenter\n        :dragleave dragleave })))\n\n\n(defn unsubscribe! [el key]\n  (let [s (gobj/get el (dom-key key))]\n    (gobj/remove el (dom-key key))\n    (when (some? @(:timer s))\n      ((:end s) nil))\n    (js/document.documentElement.removeEventListener \"dragstart\" (:dragstart s))\n    (js/document.documentElement.removeEventListener \"drag\"      (:dragstart s))\n    (js/document.documentElement.removeEventListener \"dragend\"   (:dragend s))\n    (js/document.documentElement.removeEventListener \"dragover\"  (:dragover s))\n    (.removeEventListener el \"drop\"      (:drop s))\n    (.removeEventListener el \"dragenter\" (:dragenter s))\n    (.removeEventListener el \"dragleave\" (:dragleave s))))\n\n"]}