shadow$provide.module$node_modules$jszip$lib$generate$ZipFileWorker=function(global,require,module,exports){function ZipFileWorker(streamFiles,comment,platform,encodeFileName){GenericWorker.call(this,"ZipFileWorker");this.bytesWritten=0;this.zipComment=comment;this.zipPlatform=platform;this.encodeFileName=encodeFileName;this.streamFiles=streamFiles;this.accumulate=!1;this.contentBuffer=[];this.dirRecords=[];this.entriesCount=this.currentSourceOffset=0;this.currentFile=null;this._sources=[]}var utils=
require("module$node_modules$jszip$lib$utils"),GenericWorker=require("module$node_modules$jszip$lib$stream$GenericWorker"),utf8=require("module$node_modules$jszip$lib$utf8"),crc32=require("module$node_modules$jszip$lib$crc32"),signature=require("module$node_modules$jszip$lib$signature"),decToHex=function(dec,bytes){var hex="",i;for(i=0;i<bytes;i++)hex+=String.fromCharCode(dec&255),dec>>>=8;return hex},generateZipParts=function(streamInfo,streamedContent,streamingEnded,offset,platform,encodeFileName){var file=
streamInfo.file,compression=streamInfo.compression,useCustomEncoding=encodeFileName!==utf8.utf8encode,encodedFileName=utils.transformTo("string",encodeFileName(file.name)),utfEncodedFileName=utils.transformTo("string",utf8.utf8encode(file.name)),comment=file.comment;encodeFileName=utils.transformTo("string",encodeFileName(comment));var utfEncodedComment=utils.transformTo("string",utf8.utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==
comment.length;comment="";var dosDate=file.dir;var date=file.date,JSCompiler_object_inline_crc32_4494=0,JSCompiler_object_inline_compressedSize_4495=0,JSCompiler_object_inline_uncompressedSize_4496=0;if(!streamedContent||streamingEnded)JSCompiler_object_inline_crc32_4494=streamInfo.crc32,JSCompiler_object_inline_compressedSize_4495=streamInfo.compressedSize,JSCompiler_object_inline_uncompressedSize_4496=streamInfo.uncompressedSize;streamInfo=0;streamedContent&&(streamInfo|=8);useCustomEncoding||!useUTF8ForFileName&&
!useUTF8ForComment||(streamInfo|=2048);streamedContent=0;dosDate&&(streamedContent|=16);"UNIX"===platform?(platform=798,(useCustomEncoding=file=file.unixPermissions)||(useCustomEncoding=dosDate?16893:33204),streamedContent|=(useCustomEncoding&65535)<<16):(platform=20,streamedContent|=(file.dosPermissions||0)&63);file=date.getUTCHours();file=file<<6|date.getUTCMinutes();file=file<<5|date.getUTCSeconds()/2;dosDate=date.getUTCFullYear()-1980;dosDate=dosDate<<4|date.getUTCMonth()+1;dosDate=dosDate<<5|
date.getUTCDate();useUTF8ForFileName&&(utfEncodedFileName=decToHex(1,1)+decToHex(crc32(encodedFileName),4)+utfEncodedFileName,comment+="up"+decToHex(utfEncodedFileName.length,2)+utfEncodedFileName);useUTF8ForComment&&(utfEncodedFileName=decToHex(1,1)+decToHex(crc32(encodeFileName),4)+utfEncodedComment,comment+="uc"+decToHex(utfEncodedFileName.length,2)+utfEncodedFileName);utfEncodedFileName="\n\x00"+decToHex(streamInfo,2);utfEncodedFileName+=compression.magic;utfEncodedFileName+=decToHex(file,2);
utfEncodedFileName+=decToHex(dosDate,2);utfEncodedFileName+=decToHex(JSCompiler_object_inline_crc32_4494,4);utfEncodedFileName+=decToHex(JSCompiler_object_inline_compressedSize_4495,4);utfEncodedFileName+=decToHex(JSCompiler_object_inline_uncompressedSize_4496,4);utfEncodedFileName+=decToHex(encodedFileName.length,2);utfEncodedFileName+=decToHex(comment.length,2);compression=signature.LOCAL_FILE_HEADER+utfEncodedFileName+encodedFileName+comment;offset=signature.CENTRAL_FILE_HEADER+decToHex(platform,
2)+utfEncodedFileName+decToHex(encodeFileName.length,2)+"\x00\x00\x00\x00"+decToHex(streamedContent,4)+decToHex(offset,4)+encodedFileName+comment+encodeFileName;return{fileRecord:compression,dirRecord:offset}};utils.inherits(ZipFileWorker,GenericWorker);ZipFileWorker.prototype.push=function(chunk){var currentFilePercent=chunk.meta.percent||0,entriesCount=this.entriesCount,remainingFiles=this._sources.length;this.accumulate?this.contentBuffer.push(chunk):(this.bytesWritten+=chunk.data.length,GenericWorker.prototype.push.call(this,
{data:chunk.data,meta:{currentFile:this.currentFile,percent:entriesCount?(currentFilePercent+100*(entriesCount-remainingFiles-1))/entriesCount:100}}))};ZipFileWorker.prototype.openedSource=function(streamInfo){this.currentSourceOffset=this.bytesWritten;this.currentFile=streamInfo.file.name;var streamedContent=this.streamFiles&&!streamInfo.file.dir;streamedContent?(streamInfo=generateZipParts(streamInfo,streamedContent,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:streamInfo.fileRecord,
meta:{percent:0}})):this.accumulate=!0};ZipFileWorker.prototype.closedSource=function(streamInfo){this.accumulate=!1;var streamedContent=this.streamFiles&&!streamInfo.file.dir,record=generateZipParts(streamInfo,streamedContent,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(record.dirRecord);if(streamedContent)streamedContent=this.push,streamInfo=signature.DATA_DESCRIPTOR+decToHex(streamInfo.crc32,4)+decToHex(streamInfo.compressedSize,4)+decToHex(streamInfo.uncompressedSize,
4),streamedContent.call(this,{data:streamInfo,meta:{percent:100}});else for(this.push({data:record.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null};ZipFileWorker.prototype.flush=function(){for(var localDirLength=this.bytesWritten,i=0;i<this.dirRecords.length;i++)this.push({data:this.dirRecords[i],meta:{percent:100}});i=this.dirRecords.length;var centralDirLength=this.bytesWritten-localDirLength,encodedComment=utils.transformTo("string",
(0,this.encodeFileName)(this.zipComment));localDirLength=signature.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+decToHex(i,2)+decToHex(i,2)+decToHex(centralDirLength,4)+decToHex(localDirLength,4)+decToHex(encodedComment.length,2)+encodedComment;this.push({data:localDirLength,meta:{percent:100}})};ZipFileWorker.prototype.prepareNextSource=function(){this.previous=this._sources.shift();this.openedSource(this.previous.streamInfo);this.isPaused?this.previous.pause():this.previous.resume()};ZipFileWorker.prototype.registerPrevious=
function(previous){this._sources.push(previous);var self=this;previous.on("data",function(chunk){self.processChunk(chunk)});previous.on("end",function(){self.closedSource(self.previous.streamInfo);self._sources.length?self.prepareNextSource():self.end()});previous.on("error",function(e){self.error(e)});return this};ZipFileWorker.prototype.resume=function(){if(!GenericWorker.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length)return this.prepareNextSource(),!0;if(!this.previous&&
!this._sources.length&&!this.generatedError)return this.end(),!0};ZipFileWorker.prototype.error=function(e$jscomp$0){var sources=this._sources;if(!GenericWorker.prototype.error.call(this,e$jscomp$0))return!1;for(var i=0;i<sources.length;i++)try{sources[i].error(e$jscomp$0)}catch(e){}return!0};ZipFileWorker.prototype.lock=function(){GenericWorker.prototype.lock.call(this);for(var sources=this._sources,i=0;i<sources.length;i++)sources[i].lock()};module.exports=ZipFileWorker}
//# sourceMappingURL=module$node_modules$jszip$lib$generate$ZipFileWorker.js.map
