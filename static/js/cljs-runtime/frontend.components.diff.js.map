{"version":3,"sources":["frontend/components/diff.cljs"],"mappings":"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","names":["js/frontend","js/frontend.components","js/frontend.components.diff","js/frontend.components.diff.disk-value","frontend.components.diff/disk-value","cljs.core.atom","js/frontend.components.diff.db-value","frontend.components.diff/db-value","rum.core/lazy-build","rum.core/build-defc","daiquiri.core/create-element","cljs.core.into_array","iter__4652__auto__","s__70924","cljs.core/LazySeq","temp__5720__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","cljs.core/count","b__70926","cljs.core/chunk-buffer","i__70925","vec__70927","cljs.core/-nth","cljs.core.nth","map__70930","cljs.core/--destructure-map","cljs.core.get","cljs.core/chunk-append","daiquiri.interpreter/interpret","cljs.core/chunk-cons","cljs.core/chunk","iter__70923","cljs.core/chunk-rest","vec__70934","cljs.core/first","map__70937","cljs.core/cons","cljs.core/rest","frontend.components.diff/diff-cp","diff","idx","added","removed","value","bg-color","rum.core/build-defcs","attrs70951","cljs.core/map?","daiquiri.interpreter/element-attributes","daiquiri.normalize.merge_with_class","rum.core/mark-sync-update","frontend.components.diff/local-file","rum.core/reactive","state","cljs.core/reset!","repo","path","disk-content","db-content","cljs.core/deref","cljs.core.not_EQ_","clojure.string/trim","frontend.ui/foldable","local-content","or__4253__auto__","content","medley.core.indexed","frontend.diff/diff","diff?","cljs.core/some","p__70957","vec__70958","map__70961","_idx","rum.core/react","e","frontend.util/evalue","frontend.ui.button","frontend.handler.file/alter-file","frontend.state/close-modal!","cljs.core.prn","cljs.core/chunk-first"],"sourcesContent":["(ns frontend.components.diff\n  (:require [clojure.string :as string]\n            [frontend.diff :as diff]\n            [frontend.handler.file :as file]\n            [frontend.state :as state]\n            [frontend.ui :as ui]\n            [frontend.util :as util]\n            [medley.core :as medley]\n            [rum.core :as rum]))\n\n(defonce disk-value (atom nil))\n(defonce db-value (atom nil))\n\n(rum/defc diff-cp\n  [diff]\n  [:div\n   (for [[idx {:keys [added removed value]}] diff]\n     (let [bg-color (cond\n                      added \"#057a55\"\n                      removed \"#d61f69\"\n                      :else\n                      \"initial\")]\n       [:span.diff {:key idx\n                    :style {:background-color bg-color}}\n        value]))])\n\n(rum/defcs local-file < rum/reactive\n  {:will-unmount (fn [state]\n                   (reset! disk-value nil)\n                   (reset! db-value nil)\n                   state)}\n  [state repo path disk-content db-content]\n  (when (nil? @disk-value)\n    (reset! disk-value disk-content)\n    (reset! db-value db-content))\n  [:div.cp__diff-file\n   [:div.cp__diff-file-header\n    [:span.cp__diff-file-header-content.pl-1.font-medium\n     (str \"File \" path \" has been modified on the disk.\")]]\n   [:div.p-4\n    (when (not= (string/trim disk-content) (string/trim db-content))\n      (ui/foldable\n       [:span.text-sm.font-medium.ml-1 \"Check diff\"]\n       (fn []\n         (let [local-content (or db-content \"\")\n               content (or disk-content \"\")\n               diff (medley/indexed (diff/diff local-content content))\n               diff? (some (fn [[_idx {:keys [added removed]}]]\n                             (or added removed))\n                           diff)]\n           (when diff?\n             [:div.overflow-y-scroll.flex.flex-col\n              [:div {:style {:max-height \"65vh\"}}\n               (diff-cp diff)]])))\n       {:default-collapsed? true\n        :title-trigger? true}))\n\n    [:hr]\n\n    [:div.flex.flex-col.mt-4.sm:flex-row\n     [:div.flex-1\n      [:div.mb-2 \"On disk:\"]\n      [:textarea.overflow-auto\n       {:value (rum/react disk-value)\n        :on-change (fn [e]\n                     (reset! disk-value (util/evalue e)))}\n       disk-content]\n      (ui/button \"Select this\"\n                 :on-click\n                 (fn []\n                   (when-let [value @disk-value]\n                     (file/alter-file repo path value\n                                      {:re-render-root? true\n                                       :skip-compare? true}))\n                   (state/close-modal!)))]\n\n     [:div.flex-1.mt-8.sm:ml-4.sm:mt-0\n      [:div.mb-2 \"In Logseq:\"]\n      [:textarea.overflow-auto\n       {:value (rum/react db-value)\n        :on-change (fn [e]\n                     (prn \"new-value: \" (util/evalue e))\n                     (reset! db-value (util/evalue e)))}\n       db-content]\n      (ui/button \"Select this\"\n                 :on-click\n                 (fn []\n                   (when-let [value @db-value]\n                     (file/alter-file repo path value\n                                      {:re-render-root? true\n                                       :skip-compare? true}))\n                   (state/close-modal!)))]]]])\n"]}