{
"version":3,
"file":"module$frontend$extensions$pdf$utils.js",
"lineCount":103,
"mappings":"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",
"sources":["frontend/extensions/pdf/utils.js"],
"sourcesContent":["export const viewportToScaled = (\n  rect,\n  { width, height }\n) => {\n  return {\n    x1: rect.left,\n    y1: rect.top,\n\n    x2: rect.left + rect.width,\n    y2: rect.top + rect.height,\n\n    width,\n    height,\n  }\n}\n\nconst pdfToViewport = (pdf, viewport) => {\n  const [x1, y1, x2, y2] = viewport.convertToViewportRectangle([\n    pdf.x1,\n    pdf.y1,\n    pdf.x2,\n    pdf.y2,\n  ])\n\n  return {\n    left: x1,\n    top: y1,\n\n    width: x2 - x1,\n    height: y1 - y2,\n  }\n}\n\nexport const scaledToViewport = (\n  scaled,\n  viewport,\n  usePdfCoordinates = false\n) => {\n  const { width, height } = viewport\n\n  if (usePdfCoordinates) {\n    return pdfToViewport(scaled, viewport)\n  }\n\n  if (scaled.x1 === undefined) {\n    throw new Error('You are using old position format, please update')\n  }\n\n  const x1 = (width * scaled.x1) / scaled.width\n  const y1 = (height * scaled.y1) / scaled.height\n\n  const x2 = (width * scaled.x2) / scaled.width\n  const y2 = (height * scaled.y2) / scaled.height\n\n  return {\n    left: x1,\n    top: y1,\n    width: x2 - x1,\n    height: y2 - y1,\n  }\n}\n\nexport const getBoundingRect = (clientRects) => {\n  const rects = Array.from(clientRects).map(rect => {\n    const { left, top, width, height } = rect\n\n    const X0 = left\n    const X1 = left + width\n\n    const Y0 = top\n    const Y1 = top + height\n\n    return { X0, X1, Y0, Y1 }\n  })\n\n  const optimal = rects.reduce((res, rect) => {\n    return {\n      X0: Math.min(res.X0, rect.X0),\n      X1: Math.max(res.X1, rect.X1),\n\n      Y0: Math.min(res.Y0, rect.Y0),\n      Y1: Math.max(res.Y1, rect.Y1),\n    }\n  }, rects[0])\n\n  const { X0, X1, Y0, Y1 } = optimal\n\n  return {\n    left: X0,\n    top: Y0,\n    width: X1 - X0,\n    height: Y1 - Y0,\n  }\n}\n\nexport const scrollToHighlight = (viewer, highlight) => {\n  if (!highlight) return\n  const { page, bounding } = highlight.position\n  const viewport = viewer.getPageView(page - 1)?.viewport\n  if (!viewport) return\n\n  viewer.scrollPageIntoView({\n    pageNumber: page,\n    destArray: [\n      null, { name: 'XYZ' },\n      ...viewport.convertToPdfPoint(\n        viewer.container.scrollLeft,\n        scaledToViewport(bounding, viewport).top - 200),\n      viewer.currentScale // scale\n    ],\n    ignoreDestinationZoom: true\n  })\n}\n\nexport const optimizeClientRects = (clientRects) => {\n  const sort = rects =>\n    rects.sort((A, B) => {\n      const top = A.top - B.top\n\n      if (top === 0) {\n        return A.left - B.left\n      }\n\n      return top\n    })\n\n  const overlaps = (A, B) => A.left <= B.left && B.left <= A.left + A.width\n  const sameLine = (A, B, yMargin = 5) =>\n    Math.abs(A.top - B.top) < yMargin && Math.abs(A.height - B.height) < yMargin\n\n  const inside = (A, B) =>\n    A.top > B.top &&\n    A.left > B.left &&\n    A.top + A.height < B.top + B.height &&\n    A.left + A.width < B.left + B.width\n\n  const nextTo = (A, B, xMargin = 10) => {\n    const Aright = A.left + A.width\n    const Bright = B.left + B.width\n\n    return A.left <= B.left && Aright <= Bright && B.left - Aright <= xMargin\n  }\n  const extendWidth = (A, B) => {\n    // extend width of A to cover B\n    A.width = Math.max(B.width - A.left + B.left, A.width)\n  }\n\n  const rects = sort(clientRects)\n  const toRemove = new Set()\n\n  const firstPass = rects.filter(rect => {\n    return rects.every(otherRect => {\n      return !inside(rect, otherRect)\n    })\n  })\n\n  let passCount = 0\n\n  while (passCount <= 2) {\n    firstPass.forEach(A => {\n      firstPass.forEach(B => {\n        if (A === B || toRemove.has(A) || toRemove.has(B)) {\n          return\n        }\n\n        if (!sameLine(A, B)) {\n          return\n        }\n\n        if (overlaps(A, B)) {\n          extendWidth(A, B)\n          A.height = Math.max(A.height, B.height)\n\n          toRemove.add(B)\n        }\n\n        if (nextTo(A, B)) {\n          extendWidth(A, B)\n\n          toRemove.add(B)\n        }\n      })\n    })\n    passCount += 1\n  }\n\n  return firstPass.filter(rect => !toRemove.has(rect))\n}"],
"names":["viewportToScaled","rect","width","height","x1","left","y1","top","x2","y2","pdfToViewport","pdf","viewport","convertToViewportRectangle","scaledToViewport","scaled","usePdfCoordinates","undefined","Error","getBoundingRect","clientRects","rects","Array","from","map","X0","X1","Y0","Y1","optimal","reduce","res","Math","min","max","scrollToHighlight","viewer","highlight","page","bounding","position","getPageView","scrollPageIntoView","pageNumber","destArray","name","convertToPdfPoint","container","scrollLeft","currentScale","ignoreDestinationZoom","optimizeClientRects","sort","A","B","overlaps","sameLine","yMargin","abs","inside","nextTo","xMargin","Aright","Bright","extendWidth","toRemove","Set","firstPass","filter","every","otherRect","passCount","forEach","has","add","$jscomp$tmp$exports$module$name"]
}
