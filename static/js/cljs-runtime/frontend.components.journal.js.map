{"version":3,"sources":["frontend/components/journal.cljs"],"mappings":";;;;AAkBA,wCAAA,AAAAA,oBAAAC,oBAAA,hFAAUE,2FAEPG,KAAKC,KAAKC;AAFb,AAAA,AAAA,OAAAN,+BAGE,iBAAAO,qBAAkB,iBAAAE,WAAA,mFAAA,8DAAsB,CAACE,kEAAAA,wEAAAA,RAAyBN,oDAAAA;AAAhD,AAAA,wGAAAI,uCAAAA,vIAACC,iDAAAA,2DAAAA;;AAAnB,AAAA,oBAAAH;AAAA,AAAA,aAAAA,TAAWC;AAAX,AACE,2DAAA,pDAACI,wCAAoBR,KAAKI;;AAD5B;;;GAHF,8HAAA,2CAAA,tFAAsBN,kBAAaC;AAMnC,yCAAA,AAAAL,oBAAAC,oBAAA,WAAAc,5FAAUQ;AAAV,AAAA,IAAAP,aAAAD;YAAA,AAAAE,4CAAAD,WAAA,IAAA,nEACIQ;aADJ,AAAAP,4CAAAD,WAAA,IAAA,pEACUS;AADV,AAAA,AAAA,IAGQlB,OAAK,AAACmB,0BAAkBF;IACxBlB,OAAK,mBAAA,nBAACqB;IACNC,eAAO,AAACC,6CAAE,AAACH,0BAAkBF,OACnB,AAACE,0BAAkB,AAACI;IAC9BC,cAAY,iBAAAC,WAAA,mFAAA,8DAAsB,CAACnB,kEAAAA,yEAAAA,TAAyBW,qDAAAA;AAAhD,AAAA,wGAAAQ,uCAAAA,vIAACpB,iDAAAA,2DAAAA;;IACbqB,iBAAe,2HAAA,zHAAM,AAACC,cAAI,AAAA,4FAAaH,eACtB,iBAAMI,aAAW,AAACC,sEAA4B,4CAAA,5CAACC,iGAAW,AAAA,4FAAa9B;AAAvE,AACE,OAAC+B,0CAAsBH;KAF3B;AARvB,AAAA,IAAAjB,aAW8B,iBAAAqB,WAAA;AAAA,AAAA,oBACEN;AACA,qDAAAM,SAAA,vDAACC,+HAAsBP;;AAFzBM;;;AAX9B,AAAA,OAAApB,6BAAA,MAAA,EAAA,AAAAC,qBAAAF,aAAA,AAAAG,wCAAA,AAAAC,2HAAA,2CAAA,wDAAA,mFAAA,SAAA,UAAA,uBAAAJ,kBAAA,aAAA,wBAAA,EAAA,AAAAE,qBAAAF,aAAA,CAeK,qBAAA,mFAAA,mHAAA,2CAAA,+QAAA,rhBAACuB,2TAEY,wDAAA,oDAAA,2CAAA,vJAACC,4MAAsBnC,qFAClB,WAAKoC;AAAL,AACE,GAAM,AAACC,iCAAkBD;AAAzB,AACE,sCAAA,8EAAA,2CAAA,xJAACE,4MAA4CtC;;AAD/C;;GAJpB,6DAMa,WAAKoC;AAAL,AACE,oBAAM,0DAAA,1DAACG,wDAASH;AAAhB,AACE,IAAAlC,2BAAgBsB;AAAhB,AAAA,oBAAAtB;AAAA,AAAA,qBAAAA,jBAAWF;AAAX,AACE,4KAAA,5KAACwC,uCACA,AAACC,kCACD,AAAA,mFAAQzC;;AAHX;;AAKA,OAAiBoC;;AANnB;;WAPf,mFAAA,8DAeG,AAACM,wCAAuBzB,uBAE1B,EAAII,cACF,AAACzB,sCAAUG,KAAKC,KAAKkB,QACrB,AAACyB,yBAAgB;AAAA,AACE,OAAC/C,sCAAUG,KAAKC,KAAKkB;2RAnChD,CAAA,AAAAvB,+BAAAgB,9QAeK,0RAAA,qBAAA,mFAAA,mHAAA,2CAAA,+QAAA,rhBAACuB,2TAEY,wDAAA,oDAAA,2CAAA,vJAACC,4MAAsBnC,qFAClB,WAAKoC,36BAgBpB,KAAA,yEAOH,yDAAA,zDAACQ,uCAAmB7C,KAAKsB,oBAEzB,AAACwB,kBACC,AAACC,yCAAqB7B,OACtB,oDAAA,PAAKA;AA3BW,AACE,GAAM,AAACoB,iCAAkBD;AAAzB,AACE,sCAAA,8EAAA,2CAAA,xJAACE,4MAA4CtC;;AAD/C;;GAJpB,6DAMa,WAAKoC;AAAL,AACE,oBAAM,0DAAA,1DAACG,wDAASH;AAAhB,AACE,IAAAlC,2BAAgBsB;AAAhB,AAAA,oBAAAtB;AAAA,AAAA,qBAAAA,jBAAWF;AAAX,AACE,4KAAA,5KAACwC,uCACA,AAACC,kCACD,AAAA,mFAAQzC;;AAHX;;AAKA,OAAiBoC;;AANnB;;WAPf,mFAAA,8DAeG,AAACM,wCAAuBzB,uBAE1B,EAAII,cACF,AAACzB,sCAAUG,KAAKC,KAAKkB,QACrB,AAACyB,yBAAgB;AAAA,AACE,OAAC/C,sCAAUG,KAAKC,KAAKkB;6CApB3C,1CAmBG,KAAA,yEAOH,yDAAA,zDAAC0B,uCAAmB7C,KAAKsB,oBAEzB,AAACwB,kBACC,AAACC,yCAAqB7B,OACtB,oDAAA,PAAKA;GA7CZ,6GAAA,1BAAuBpB;AA+CvB,uCAAA,AAAAJ,oBAAAC,oBAAA,/EAAUqD,0FACPC;AADH,AAAA,AAAA,OAAApC,6BAAA,MAAA,MAAA,YAAA,CAGG,0BAAA,1BAACqC,mDAEA,iBAAAC,qBAAA,kDAAAC;AAAA,AAAA,YAAAC,kBAAA,KAAA;AAAA,AAAA,IAAAD,eAAAA;;AAAA,AAAA,IAAAjD,qBAAA,AAAAyB,cAAAwB;AAAA,AAAA,GAAAjD;AAAA,AAAA,IAAAiD,eAAAjD;AAAA,AAAA,GAAA,AAAAmD,6BAAAF;AAAA,IAAAG,kBA+3E+C,AAAA4B,sBAAA/B;IA/3E/CI,qBAAA,AAAAC,gBAAAF;IAAAG,WAAA,AAAAC,uBAAAH;AAAA,AAAA,GAAA,AAAA,iBAAAI,WAAA;;AAAA,AAAA,GAAA,CAAAA,WAAAJ;AAAA,IAAAK,aAAA,AAAAC,eAAAP,gBAAAK;IAAAC,iBAAA,AAAAE,4BAAAF;WAAA,AAAAG,4CAAAH,eAAA,lEAAoBa;aAApB,AAAAV,4CAAAH,eAAA,pEAAyB1C;AAAzB,AAAA,AAAA,AAAA8C,uBAAAP,SAAA,mFAAA,6FAAA,2CAAA,oDACmCgB,aAChC,uCAAA,vCAACzD,0HAAYyD,KAAKvD;;AAFrB,eAAA,CAAAyC,WAAA;;;;AAAA;;;;;AAAA,OAAAM,qBAAA,AAAAC,gBAAAT,UAAA,AAAAU,wCAAA,AAAAC,qBAAAjB;;AAAA,OAAAc,qBAAA,AAAAC,gBAAAT,UAAA;;;AAAA,IAAAY,aAAA,AAAAC,gBAAAnB;IAAAkB,iBAAA,AAAAP,4BAAAO;WAAA,AAAAN,4CAAAM,eAAA,lEAAoBI;aAApB,AAAAV,4CAAAM,eAAA,pEAAyBnD;AAAzB,AAAA,OAAAqD,eAAA,mFAAA,6FAAA,2CAAA,wNAAA,AAAAJ,wCAAA,AAAAK,eAAArB,3NACmCsB,aAChC,uCAAA,vCAACzD,0HAAYyD,KAAKvD;;;AAFrB;;;;GAAA,KAAA;;AAAA,AAAA,OAAAgC,mBAAkCF;KAFnC,2CAAA,8GAAA,iEAAA,WAAA,0HAAA,vPAKY,AAAC0B,sMAEKC,4GACP;AAAA,AACE,OAACC;;GAZjB,6GAAA,1BAAqB/E;AAcrB,2CAAA,AAAAJ,oBAAAC,oBAAA,nFAAUmF;AAAV,AAAA,AAAA,IAEQC,kBAAgB,mBAAA,nBAAC1D;IACjB4B,kBAAgB,iBAAA+B,WAAwB,AAACtC;IAAzBuC,WAAiDF;AAAjD,AAAA,sIAAAC,SAAAC,sDAAAD,SAAAC,tMAACC,gEAAAA,mFAAAA;;AAHzB,AAII,OAAClC,qCAASC;GAJd,sIAAA,nDAAyBnD,kBAAaC","names":["rum.core/lazy-build","rum.core/build-defc","daiquiri.interpreter/interpret","frontend.components.journal/blocks-cp","rum.core/reactive","frontend.db-mixins/query","repo","page","_format","temp__5720__auto__","page-e","G__47891","frontend.db/pull","frontend.util/page-name-sanity-lc","frontend.components.page/page-blocks-cp","p__47895","vec__47896","cljs.core.nth","attrs47894","daiquiri.core/create-element","cljs.core/map?","daiquiri.interpreter/element-attributes","daiquiri.normalize.merge_with_class","frontend.components.journal/journal-cp","title","format","clojure.string/lower-case","frontend.state/sub","today?","cljs.core._EQ_","frontend.date.journal_name","page-entity","G__47899","data-page-tags","cljs.core/seq","page-names","frontend.db.model.get_page_names_by_ids","cljs.core.map","logseq.graph-parser.text/build-data-value","G__47901","cljs.core.assoc","frontend.ui/foldable","reitit.frontend.easy.href","e","frontend.util/right-click?","frontend.state/set-state!","frontend.components.journal.goog$module$goog$object.get","frontend.state/sidebar-add-block!","frontend.state/get-current-repo","logseq.graph-parser.util/capitalize-all","frontend.ui/lazy-visible","frontend.components.page/today-queries","rum.core/with-key","frontend.components.reference/references","frontend.components.journal/journals","latest-journals","frontend.ui/infinite-list","iter__5520__auto__","s__47948","cljs.core/LazySeq","cljs.core/chunked-seq?","c__5518__auto__","size__5519__auto__","cljs.core/count","b__47950","cljs.core/chunk-buffer","i__47949","map__47951","cljs.core/-nth","cljs.core/--destructure-map","cljs.core.get","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__47947","cljs.core/chunk-rest","map__47953","cljs.core/first","cljs.core/cons","cljs.core/rest","name","frontend.handler.page/has-more-journals?","frontend.handler.page/create-today-journal!","frontend.handler.page/load-more-journals!","frontend.components.journal/all-journals","journals-length","G__47959","G__47960","frontend.db/get-latest-journals","cljs.core/chunk-first"],"sourcesContent":["(ns frontend.components.journal\n  (:require [clojure.string :as string]\n            [frontend.components.page :as page]\n            [frontend.components.reference :as reference]\n            [frontend.date :as date]\n            [frontend.db :as db]\n            [frontend.db-mixins :as db-mixins]\n            [frontend.db.model :as model]\n            [frontend.handler.page :as page-handler]\n            [frontend.state :as state]\n            [logseq.graph-parser.text :as text]\n            [logseq.graph-parser.util :as gp-util]\n            [frontend.ui :as ui]\n            [frontend.util :as util]\n            [goog.object :as gobj]\n            [reitit.frontend.easy :as rfe]\n            [rum.core :as rum]))\n\n(rum/defc blocks-cp < rum/reactive db-mixins/query\n  {}\n  [repo page _format]\n  (when-let [page-e (db/pull [:block/name (util/page-name-sanity-lc page)])]\n    (page/page-blocks-cp repo page-e {})))\n\n(rum/defc journal-cp < rum/reactive\n  [[title format]]\n  (let [;; Don't edit the journal title\n        page (string/lower-case title)\n        repo (state/sub :git/current-repo)\n        today? (= (string/lower-case title)\n                  (string/lower-case (date/journal-name)))\n        page-entity (db/pull [:block/name (util/page-name-sanity-lc title)])\n        data-page-tags (when (seq (:block/tags page-entity))\n                         (let [page-names (model/get-page-names-by-ids (map :db/id (:block/tags page)))]\n                           (text/build-data-value page-names)))]\n    [:div.flex-1.journal.page (cond-> {}\n                                data-page-tags\n                                (assoc :data-page-tags data-page-tags))\n\n     (ui/foldable\n      [:a.initial-color.title.journal-title\n       {:href     (rfe/href :page {:name page})\n        :on-mouse-down (fn [e]\n                         (when (util/right-click? e)\n                           (state/set-state! :page-title/context {:page page})))\n        :on-click (fn [e]\n                    (when (gobj/get e \"shiftKey\")\n                      (when-let [page page-entity]\n                        (state/sidebar-add-block!\n                         (state/get-current-repo)\n                         (:db/id page)\n                         :page))\n                      (.preventDefault e)))}\n       [:h1.title\n        (gp-util/capitalize-all title)]]\n\n      (if today?\n        (blocks-cp repo page format)\n        (ui/lazy-visible (fn []\n                           (blocks-cp repo page format))\n                         nil\n                         {}))\n\n      {})\n\n     (page/today-queries repo today? false)\n\n     (rum/with-key\n       (reference/references title)\n       (str title \"-refs\"))]))\n\n(rum/defc journals < rum/reactive\n  [latest-journals]\n  [:div#journals\n   (ui/infinite-list\n    \"main-content-container\"\n    (for [{:block/keys [name format]} latest-journals]\n      [:div.journal-item.content {:key name}\n       (journal-cp [name format])])\n    {:has-more (page-handler/has-more-journals?)\n     :more-class \"text-4xl\"\n     :on-top-reached page-handler/create-today-journal!\n     :on-load (fn []\n                (page-handler/load-more-journals!))})])\n\n(rum/defc all-journals < rum/reactive db-mixins/query\n  []\n  (let [journals-length (state/sub :journals-length)\n        latest-journals (db/get-latest-journals (state/get-current-repo) journals-length)]\n    (journals latest-journals)))\n"]}