{"version":3,"sources":["frontend/components/journal.cljs"],"mappings":"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","names":["rum.core/lazy-build","rum.core/build-defc","daiquiri.interpreter/interpret","frontend.components.journal/blocks-cp","rum.core/reactive","frontend.db-mixins/query","repo","page","_format","temp__5720__auto__","page-e","G__71757","frontend.db/pull","frontend.util/page-name-sanity-lc","frontend.components.page/page-blocks-cp","p__71761","vec__71762","cljs.core.nth","attrs71760","daiquiri.core/create-element","cljs.core/map?","daiquiri.interpreter/element-attributes","daiquiri.normalize.merge_with_class","frontend.components.journal/journal-cp-inner","title","format","clojure.string/lower-case","frontend.state/sub","today?","cljs.core._EQ_","frontend.date.journal_name","page-entity","G__71765","data-page-tags","cljs.core/seq","page-names","frontend.db.model.get_page_names_by_ids","cljs.core.map","logseq.graph-parser.text/build-data-value","G__71767","cljs.core.assoc","frontend.ui/foldable","reitit.frontend.easy.href","e","frontend.util/right-click?","frontend.state/set-state!","frontend.components.journal.goog$module$goog$object.get","frontend.state/sidebar-add-block!","frontend.state/get-current-repo","logseq.graph-parser.util/capitalize-all","frontend.components.page/today-queries","rum.core/with-key","frontend.components.reference/references","frontend.components.journal/journal-cp","journal","frontend.ui/lazy-visible","frontend.components.journal/journals","latest-journals","frontend.ui/infinite-list","iter__4652__auto__","s__71840","cljs.core/LazySeq","cljs.core/chunked-seq?","c__4650__auto__","size__4651__auto__","cljs.core/count","b__71842","cljs.core/chunk-buffer","i__71841","map__71845","cljs.core/-nth","cljs.core/--destructure-map","cljs.core.get","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__71839","cljs.core/chunk-rest","map__71847","cljs.core/first","cljs.core/cons","cljs.core/rest","name","frontend.handler.page/has-more-journals?","frontend.handler.page/create-today-journal!","frontend.handler.page/load-more-journals!","frontend.components.journal/all-journals","journals-length","G__71848","G__71849","frontend.db/get-latest-journals","cljs.core/chunk-first"],"sourcesContent":["(ns frontend.components.journal\n  (:require [clojure.string :as string]\n            [frontend.components.page :as page]\n            [frontend.components.reference :as reference]\n            [frontend.date :as date]\n            [frontend.db :as db]\n            [frontend.db-mixins :as db-mixins]\n            [frontend.db.model :as model]\n            [frontend.handler.page :as page-handler]\n            [frontend.state :as state]\n            [logseq.graph-parser.text :as text]\n            [logseq.graph-parser.util :as gp-util]\n            [frontend.ui :as ui]\n            [frontend.util :as util]\n            [goog.object :as gobj]\n            [reitit.frontend.easy :as rfe]\n            [rum.core :as rum]))\n\n(rum/defc blocks-cp < rum/reactive db-mixins/query\n  {}\n  [repo page _format]\n  (when-let [page-e (db/pull [:block/name (util/page-name-sanity-lc page)])]\n    (page/page-blocks-cp repo page-e {})))\n\n(rum/defc journal-cp-inner < rum/reactive\n  [[title format]]\n  (let [;; Don't edit the journal title\n        page (string/lower-case title)\n        repo (state/sub :git/current-repo)\n        today? (= (string/lower-case title)\n                  (string/lower-case (date/journal-name)))\n        page-entity (db/pull [:block/name (util/page-name-sanity-lc title)])\n        data-page-tags (when (seq (:block/tags page-entity))\n                         (let [page-names (model/get-page-names-by-ids (map :db/id (:block/tags page)))]\n                           (text/build-data-value page-names)))]\n    [:div.flex-1.journal.page (cond-> {}\n                                data-page-tags\n                                (assoc :data-page-tags data-page-tags))\n\n     (ui/foldable\n      [:a.initial-color.title.journal-title\n       {:href     (rfe/href :page {:name page})\n        :on-mouse-down (fn [e]\n                         (when (util/right-click? e)\n                           (state/set-state! :page-title/context {:page page})))\n        :on-click (fn [e]\n                    (when (gobj/get e \"shiftKey\")\n                      (when-let [page page-entity]\n                        (state/sidebar-add-block!\n                         (state/get-current-repo)\n                         (:db/id page)\n                         :page))\n                      (.preventDefault e)))}\n       [:h1.title\n        (gp-util/capitalize-all title)]]\n\n      (blocks-cp repo page format)\n\n      {})\n\n     (page/today-queries repo today? false)\n\n     (rum/with-key\n       (reference/references title)\n       (str title \"-refs\"))]))\n\n(rum/defc journal-cp\n  [journal]\n  (ui/lazy-visible (fn [] (journal-cp-inner journal)) nil\n                   {:reset-height? true}))\n\n(rum/defc journals < rum/reactive\n  [latest-journals]\n  [:div#journals\n   (ui/infinite-list\n    \"main-content-container\"\n    (for [{:block/keys [name format]} latest-journals]\n      [:div.journal-item.content {:key name}\n       (journal-cp [name format])])\n    {:has-more (page-handler/has-more-journals?)\n     :more-class \"text-4xl\"\n     :on-top-reached page-handler/create-today-journal!\n     :on-load (fn []\n                (page-handler/load-more-journals!))})])\n\n(rum/defc all-journals < rum/reactive db-mixins/query\n  []\n  (let [journals-length (state/sub :journals-length)\n        latest-journals (db/get-latest-journals (state/get-current-repo) journals-length)]\n    (journals latest-journals)))\n"]}