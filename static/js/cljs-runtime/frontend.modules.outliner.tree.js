goog.provide('frontend.modules.outliner.tree');

/**
 * @interface
 */
frontend.modules.outliner.tree.INode = function(){};

var frontend$modules$outliner$tree$INode$_get_id$dyn_49590 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_id[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_id["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-id",this$);
}
}
});
frontend.modules.outliner.tree._get_id = (function frontend$modules$outliner$tree$_get_id(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_id$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_id$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_id$dyn_49590(this$);
}
});

var frontend$modules$outliner$tree$INode$_get_parent_id$dyn_49591 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_parent_id[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_parent_id["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-parent-id",this$);
}
}
});
frontend.modules.outliner.tree._get_parent_id = (function frontend$modules$outliner$tree$_get_parent_id(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_parent_id$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_parent_id$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_parent_id$dyn_49591(this$);
}
});

var frontend$modules$outliner$tree$INode$_set_parent_id$dyn_49592 = (function (this$,parent_id){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._set_parent_id[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$2(this$,parent_id) : m__5391__auto__.call(null,this$,parent_id));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._set_parent_id["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$2(this$,parent_id) : m__5389__auto__.call(null,this$,parent_id));
} else {
throw cljs.core.missing_protocol("INode.-set-parent-id",this$);
}
}
});
frontend.modules.outliner.tree._set_parent_id = (function frontend$modules$outliner$tree$_set_parent_id(this$,parent_id){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_set_parent_id$arity$2 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_set_parent_id$arity$2(this$,parent_id);
} else {
return frontend$modules$outliner$tree$INode$_set_parent_id$dyn_49592(this$,parent_id);
}
});

var frontend$modules$outliner$tree$INode$_get_left_id$dyn_49593 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_left_id[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_left_id["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-left-id",this$);
}
}
});
frontend.modules.outliner.tree._get_left_id = (function frontend$modules$outliner$tree$_get_left_id(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_left_id$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_left_id$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_left_id$dyn_49593(this$);
}
});

var frontend$modules$outliner$tree$INode$_set_left_id$dyn_49594 = (function (this$,left_id){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._set_left_id[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$2(this$,left_id) : m__5391__auto__.call(null,this$,left_id));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._set_left_id["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$2(this$,left_id) : m__5389__auto__.call(null,this$,left_id));
} else {
throw cljs.core.missing_protocol("INode.-set-left-id",this$);
}
}
});
frontend.modules.outliner.tree._set_left_id = (function frontend$modules$outliner$tree$_set_left_id(this$,left_id){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_set_left_id$arity$2 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_set_left_id$arity$2(this$,left_id);
} else {
return frontend$modules$outliner$tree$INode$_set_left_id$dyn_49594(this$,left_id);
}
});

var frontend$modules$outliner$tree$INode$_get_parent$dyn_49595 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_parent[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_parent["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-parent",this$);
}
}
});
frontend.modules.outliner.tree._get_parent = (function frontend$modules$outliner$tree$_get_parent(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_parent$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_parent$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_parent$dyn_49595(this$);
}
});

var frontend$modules$outliner$tree$INode$_get_left$dyn_49596 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_left[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_left["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-left",this$);
}
}
});
frontend.modules.outliner.tree._get_left = (function frontend$modules$outliner$tree$_get_left(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_left$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_left$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_left$dyn_49596(this$);
}
});

var frontend$modules$outliner$tree$INode$_get_right$dyn_49597 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_right[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_right["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-right",this$);
}
}
});
frontend.modules.outliner.tree._get_right = (function frontend$modules$outliner$tree$_get_right(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_right$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_right$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_right$dyn_49597(this$);
}
});

var frontend$modules$outliner$tree$INode$_get_down$dyn_49598 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_down[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_down["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-down",this$);
}
}
});
frontend.modules.outliner.tree._get_down = (function frontend$modules$outliner$tree$_get_down(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_down$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_down$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_down$dyn_49598(this$);
}
});

var frontend$modules$outliner$tree$INode$_save$dyn_49599 = (function (this$,db){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._save[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$2(this$,db) : m__5391__auto__.call(null,this$,db));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._save["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$2 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$2(this$,db) : m__5389__auto__.call(null,this$,db));
} else {
throw cljs.core.missing_protocol("INode.-save",this$);
}
}
});
frontend.modules.outliner.tree._save = (function frontend$modules$outliner$tree$_save(this$,db){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_save$arity$2 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_save$arity$2(this$,db);
} else {
return frontend$modules$outliner$tree$INode$_save$dyn_49599(this$,db);
}
});

var frontend$modules$outliner$tree$INode$_del$dyn_49603 = (function (this$,db,children_QMARK_){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._del[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$3 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$3(this$,db,children_QMARK_) : m__5391__auto__.call(null,this$,db,children_QMARK_));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._del["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$3 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$3(this$,db,children_QMARK_) : m__5389__auto__.call(null,this$,db,children_QMARK_));
} else {
throw cljs.core.missing_protocol("INode.-del",this$);
}
}
});
frontend.modules.outliner.tree._del = (function frontend$modules$outliner$tree$_del(this$,db,children_QMARK_){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_del$arity$3 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_del$arity$3(this$,db,children_QMARK_);
} else {
return frontend$modules$outliner$tree$INode$_del$dyn_49603(this$,db,children_QMARK_);
}
});

var frontend$modules$outliner$tree$INode$_get_children$dyn_49604 = (function (this$){
var x__5390__auto__ = (((this$ == null))?null:this$);
var m__5391__auto__ = (frontend.modules.outliner.tree._get_children[goog.typeOf(x__5390__auto__)]);
if((!((m__5391__auto__ == null)))){
return (m__5391__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5391__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5391__auto__.call(null,this$));
} else {
var m__5389__auto__ = (frontend.modules.outliner.tree._get_children["_"]);
if((!((m__5389__auto__ == null)))){
return (m__5389__auto__.cljs$core$IFn$_invoke$arity$1 ? m__5389__auto__.cljs$core$IFn$_invoke$arity$1(this$) : m__5389__auto__.call(null,this$));
} else {
throw cljs.core.missing_protocol("INode.-get-children",this$);
}
}
});
frontend.modules.outliner.tree._get_children = (function frontend$modules$outliner$tree$_get_children(this$){
if((((!((this$ == null)))) && ((!((this$.frontend$modules$outliner$tree$INode$_get_children$arity$1 == null)))))){
return this$.frontend$modules$outliner$tree$INode$_get_children$arity$1(this$);
} else {
return frontend$modules$outliner$tree$INode$_get_children$dyn_49604(this$);
}
});

frontend.modules.outliner.tree.satisfied_inode_QMARK_ = (function frontend$modules$outliner$tree$satisfied_inode_QMARK_(node){
if((!((node == null)))){
if(((false) || ((cljs.core.PROTOCOL_SENTINEL === node.frontend$modules$outliner$tree$INode$)))){
return true;
} else {
if((!node.cljs$lang$protocol_mask$partition$)){
return cljs.core.native_satisfies_QMARK_(frontend.modules.outliner.tree.INode,node);
} else {
return false;
}
}
} else {
return cljs.core.native_satisfies_QMARK_(frontend.modules.outliner.tree.INode,node);
}
});
frontend.modules.outliner.tree.blocks__GT_vec_tree_aux = (function frontend$modules$outliner$tree$blocks__GT_vec_tree_aux(blocks,root){
var id_map = (function (m){
return new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("db","id","db/id",-1388397098),new cljs.core.Keyword("db","id","db/id",-1388397098).cljs$core$IFn$_invoke$arity$1(m)], null);
});
var root__$1 = id_map(root);
var parent_blocks = cljs.core.group_by(new cljs.core.Keyword("block","parent","block/parent",-918309064),blocks);
var sort_fn = (function (parent){
var G__49568 = cljs.core.get.cljs$core$IFn$_invoke$arity$2(parent_blocks,parent);
var G__49569 = parent;
return (frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2 ? frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2(G__49568,G__49569) : frontend.db.sort_by_left.call(null,G__49568,G__49569));
});
var block_children = (function frontend$modules$outliner$tree$blocks__GT_vec_tree_aux_$_block_children(parent,level){
return cljs.core.map.cljs$core$IFn$_invoke$arity$2((function (m){
var parent__$1 = id_map(m);
var children = (function (){var G__49570 = frontend$modules$outliner$tree$blocks__GT_vec_tree_aux_$_block_children(parent__$1,(level + (1)));
var G__49571 = parent__$1;
return (frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2 ? frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2(G__49570,G__49571) : frontend.db.sort_by_left.call(null,G__49570,G__49571));
})();
return cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic(m,new cljs.core.Keyword("block","level","block/level",1182509971),level,cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword("block","children","block/children",-1040716209),children], 0));
}),sort_fn(parent));
});
return block_children(root__$1,(1));
});
frontend.modules.outliner.tree.get_root_and_page = (function frontend$modules$outliner$tree$get_root_and_page(repo,root_id){
if(typeof root_id === 'string'){
var temp__5718__auto__ = cljs.core.parse_uuid(root_id);
if(cljs.core.truth_(temp__5718__auto__)){
var id = temp__5718__auto__;
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [false,(function (){var G__49573 = repo;
var G__49574 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("block","uuid","block/uuid",-1991494552),id], null);
return (frontend.db.entity.cljs$core$IFn$_invoke$arity$2 ? frontend.db.entity.cljs$core$IFn$_invoke$arity$2(G__49573,G__49574) : frontend.db.entity.call(null,G__49573,G__49574));
})()], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [true,(function (){var G__49575 = repo;
var G__49576 = new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("block","name","block/name",1619760316),clojure.string.lower_case(root_id)], null);
return (frontend.db.entity.cljs$core$IFn$_invoke$arity$2 ? frontend.db.entity.cljs$core$IFn$_invoke$arity$2(G__49575,G__49576) : frontend.db.entity.call(null,G__49575,G__49576));
})()], null);
}
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [false,root_id], null);
}
});
frontend.modules.outliner.tree.blocks__GT_vec_tree = (function frontend$modules$outliner$tree$blocks__GT_vec_tree(var_args){
var G__49579 = arguments.length;
switch (G__49579) {
case 2:
return frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$core$IFn$_invoke$arity$2 = (function (blocks,root_id){
return frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$core$IFn$_invoke$arity$3(frontend.state.get_current_repo(),blocks,root_id);
}));

(frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$core$IFn$_invoke$arity$3 = (function (repo,blocks,root_id){
var vec__49580 = frontend.modules.outliner.tree.get_root_and_page(repo,cljs.core.str.cljs$core$IFn$_invoke$arity$1(root_id));
var page_QMARK_ = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__49580,(0),null);
var root = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__49580,(1),null);
if(cljs.core.not(root)){
return blocks;
} else {
var result = frontend.modules.outliner.tree.blocks__GT_vec_tree_aux(blocks,root);
if(cljs.core.truth_(page_QMARK_)){
return result;
} else {
var root_block = cljs.core.some((function (p1__49577_SHARP_){
if(cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("db","id","db/id",-1388397098).cljs$core$IFn$_invoke$arity$1(p1__49577_SHARP_),new cljs.core.Keyword("db","id","db/id",-1388397098).cljs$core$IFn$_invoke$arity$1(root))){
return p1__49577_SHARP_;
} else {
return null;
}
}),blocks);
var root_block__$1 = cljs.core.assoc.cljs$core$IFn$_invoke$arity$3(root_block,new cljs.core.Keyword("block","children","block/children",-1040716209),result);
return new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [root_block__$1], null);
}
}
}));

(frontend.modules.outliner.tree.blocks__GT_vec_tree.cljs$lang$maxFixedArity = 3);

frontend.modules.outliner.tree.sort_blocks_aux = (function frontend$modules$outliner$tree$sort_blocks_aux(parents,parent_groups){
return cljs.core.mapv.cljs$core$IFn$_invoke$arity$2((function (parent){
var parent_id = new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("db","id","db/id",-1388397098),new cljs.core.Keyword("db","id","db/id",-1388397098).cljs$core$IFn$_invoke$arity$1(parent)], null);
var children = (function (){var G__49584 = cljs.core.get.cljs$core$IFn$_invoke$arity$2(cljs.core.deref(parent_groups),parent_id);
var G__49585 = parent;
return (frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2 ? frontend.db.sort_by_left.cljs$core$IFn$_invoke$arity$2(G__49584,G__49585) : frontend.db.sort_by_left.call(null,G__49584,G__49585));
})();
var _ = cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$2(parent_groups,(function (p1__49583_SHARP_){
return cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2(p1__49583_SHARP_,parent_id);
}));
var sorted_nested_children = (cljs.core.truth_(cljs.core.not_empty(children))?(frontend.modules.outliner.tree.sort_blocks_aux.cljs$core$IFn$_invoke$arity$2 ? frontend.modules.outliner.tree.sort_blocks_aux.cljs$core$IFn$_invoke$arity$2(children,parent_groups) : frontend.modules.outliner.tree.sort_blocks_aux.call(null,children,parent_groups)):null);
if(cljs.core.truth_(sorted_nested_children)){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [parent,sorted_nested_children], null);
} else {
return new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [parent], null);
}
}),parents);
});
/**
 * sort blocks by parent & left
 */
frontend.modules.outliner.tree.sort_blocks = (function frontend$modules$outliner$tree$sort_blocks(blocks_exclude_root,root){
var parent_groups = cljs.core.atom.cljs$core$IFn$_invoke$arity$1(cljs.core.group_by(new cljs.core.Keyword("block","parent","block/parent",-918309064),blocks_exclude_root));
return cljs.core.flatten(cljs.core.concat.cljs$core$IFn$_invoke$arity$2(frontend.modules.outliner.tree.sort_blocks_aux(new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [root], null),parent_groups),cljs.core.vals(cljs.core.deref(parent_groups))));
});

//# sourceMappingURL=frontend.modules.outliner.tree.js.map
