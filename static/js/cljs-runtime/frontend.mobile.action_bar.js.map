{"version":3,"sources":["frontend/mobile/action_bar.cljs"],"mappings":"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","names":["frontend.mobile.action-bar/action-command","icon","description","command-handler","callback","frontend.state/set-state!","frontend.handler.editor/clear-selection!","_event","frontend.ui.icon","rum.core/lazy-build","rum.core/build-defcs","daiquiri.interpreter/interpret","frontend.mobile.action-bar/action-bar","rum.core/reactive","frontend.mixins.event_mixin","state","frontend.mixins.hide_when_esc_or_outside","temp__5720__auto__","block","frontend.state/sub","map__62374","cljs.core/--destructure-map","cljs.core.get","uuid","children","last-child-block-id","cljs.core/empty?","G__62375","G__62376","frontend.db/get-block-children","frontend.state/get-current-repo","cljs.core/last","tag-id","or__5043__auto__","bottom-el","goog.dom/getElement","bottom","frontend.mobile.action_bar.goog$module$goog$object.get","vw-height","js/window.visualViewport","js/document.documentElement","delta","frontend.util/app-scroll-container-node","cljs.core._EQ_","properties","heading?","frontend.handler.editor/remove-block-property!","frontend.handler.editor/set-block-property!","frontend.extensions.srs/make-block-a-card!","frontend.handler.editor/copy-selection-blocks","frontend.handler.editor/cut-selection-blocks","frontend.handler.editor/delete-block-aux!","p1__62369#","frontend.handler.editor.copy_block_ref_BANG_","current-repo","tap-f","block-id","frontend.util.url.get_logseq_graph_uuid_url","frontend.mobile.util/native-ipad?","frontend.state/sidebar-add-block!"],"sourcesContent":["(ns frontend.mobile.action-bar\n  (:require\n   [frontend.db :as db]\n   [frontend.extensions.srs :as srs]\n   [frontend.handler.editor :as editor-handler]\n   [frontend.mixins :as mixins]\n   [frontend.state :as state]\n   [frontend.ui :as ui]\n   [frontend.util :as util]\n   [frontend.util.url :as url-util]\n   [goog.dom :as gdom]\n   [goog.object :as gobj]\n   [rum.core :as rum]\n   [frontend.mobile.util :as mobile-util]))\n\n(defn- action-command\n  [icon description command-handler]\n  (let [callback\n        (fn []\n          (state/set-state! :mobile/show-action-bar? false)\n          (editor-handler/clear-selection!))]\n    [:button.bottom-action.flex-row\n     {:on-click (fn [_event]\n                  (command-handler)\n                  (callback))}\n     (ui/icon icon {:style {:fontSize 23}})\n     [:div.description description]]))\n\n(rum/defcs action-bar < rum/reactive\n  (mixins/event-mixin\n   (fn [state]\n     (mixins/hide-when-esc-or-outside\n      state\n      :on-hide (fn []\n                 (editor-handler/clear-selection!)\n                 (state/set-state! :mobile/show-action-bar? false)))))\n  [state]\n  (when-let [block (state/sub :mobile/actioned-block)]\n    (let [{:block/keys [uuid children]} block\n          last-child-block-id (when-not (empty? children)\n                                (-> (db/get-block-children (state/get-current-repo) uuid)\n                                    last\n                                    :block/uuid))]\n      (let [tag-id (or last-child-block-id uuid)\n            bottom-el (gdom/getElement (str \"block-content-\" tag-id))\n            bottom (gobj/get (.getBoundingClientRect bottom-el) \"bottom\")\n            vw-height (or (.-height js/window.visualViewport)\n                          (.-clientHeight js/document.documentElement))\n            delta (- vw-height bottom 170)]\n        (when (< delta 0)\n          (.scrollBy (util/app-scroll-container-node) #js {:top (- 10 delta)})))\n      [:div.action-bar\n       [:div.action-bar-commands\n        (when-not (= (:block/format block) :org)\n          (action-command \"heading\" \"Heading\"\n                          #(let [properties (:block/properties block)\n                                 heading?   (true? (:heading properties))]\n                             (if heading?\n                               (editor-handler/remove-block-property! uuid :heading)\n                               (editor-handler/set-block-property! uuid :heading true)))))\n        (action-command \"infinity\" \"Card\" #(srs/make-block-a-card! (:block/uuid block)))\n        (action-command \"copy\" \"Copy\" #(editor-handler/copy-selection-blocks false))\n        (action-command \"cut\" \"Cut\" #(editor-handler/cut-selection-blocks true))\n        (action-command \"trash\" \"Delete\" #(editor-handler/delete-block-aux! block true))\n        (action-command \"registered\" \"Copy ref\"\n                        (fn [_event] (editor-handler/copy-block-ref! uuid #(str \"((\" % \"))\"))))\n        (action-command \"link\" \"Copy url\"\n                        (fn [_event] (let [current-repo (state/get-current-repo)\n                                           tap-f (fn [block-id]\n                                                   (url-util/get-logseq-graph-uuid-url nil current-repo block-id))]\n                                       (editor-handler/copy-block-ref! uuid tap-f))))\n        (when (mobile-util/native-ipad?)\n          (action-command \"text-direction-ltr\" \"Right sidebar\"\n                          (fn [_event]\n                            (let [current-repo (state/get-current-repo)]\n                              (state/sidebar-add-block! current-repo uuid :block-ref)))))]])))\n\n\n"]}