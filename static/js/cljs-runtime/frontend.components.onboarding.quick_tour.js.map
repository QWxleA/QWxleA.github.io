{"version":3,"sources":["frontend/components/onboarding/quick_tour.cljs"],"mappings":"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","names":["frontend.components.onboarding.quick-tour/js-load$","url","promesa.core.create","resolve","frontend.loader.load","frontend.components.onboarding.quick-tour/JS_ROOT","cljs.core._EQ_","js/location.protocol","frontend.components.onboarding.quick-tour/load-base-assets$","frontend.components.onboarding.quick-tour/make-skip-fns","jsTour","el","js/document.createElement","hiccups.runtime/render-html","js/document.body","frontend.components.onboarding.quick-tour/wait-target","fn-or-selector","time","promesa.core.bind","___28360__auto__","promesa.protocols/-promise","action","js/document","dommy.core/selector","_","promesa.core.delay","frontend.components.onboarding.quick-tour/inject-steps-indicator","current","total","iter__5520__auto__","s__62433","cljs.core/LazySeq","temp__5720__auto__","cljs.core/seq","cljs.core/chunked-seq?","c__5518__auto__","size__5519__auto__","cljs.core/count","b__62435","cljs.core/chunk-buffer","i__62434","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__62432","cljs.core/chunk-rest","cljs.core/first","cljs.core/cons","cljs.core/rest","i","cljs.core.range","frontend.components.onboarding.quick-tour/create-steps!","frontend.state/sub","frontend.state/hide-right-sidebar!","promesa.core/resolved","frontend.util/safe-lower-case","frontend.state/get-current-page","frontend.date/today","frontend.handler.route.redirect_to_page_BANG_","frontend.util.scroll_to_top","cljs.core/not","frontend.state/toggle-left-sidebar!","frontend.components.onboarding.quick-tour/start","vec__62442","cljs.core.nth","js/Shepherd.Tour","cljs-bean.core/->js","steps","p1__62440#","p2__62439#","cljs.core.map_indexed","cljs.core.assoc","show-skip!","hide-skip!","G__62445","seq__62446","chunk__62447","count__62448","i__62449","c__5565__auto__","cljs.core/chunk-first","cljs.core/next","step","frontend.components.onboarding.quick-tour/ready","callback","promesa.core.then","js/window.Shepherd","frontend.components.onboarding.quick-tour/should-guide?","frontend.components.onboarding.quick-tour/init","frontend.handler.command-palette/register"],"sourcesContent":["(ns frontend.components.onboarding.quick-tour\n  (:require [promesa.core :as p]\n            [cljs-bean.core :as bean]\n            [frontend.loader :refer [load]]\n            [frontend.state :as state]\n            [frontend.date :as date]\n            [frontend.util :as util]\n            [frontend.handler.route :as router-handler]\n            [frontend.handler.command-palette :as command-palette]\n            [hiccups.runtime :as h]\n            [dommy.core :as d]))\n\n(defn js-load$\n  [url]\n  (p/create\n    (fn [resolve]\n      (load url resolve))))\n\n(def JS_ROOT\n  (if (= js/location.protocol \"file:\")\n    \"./js\"\n    \"./static/js\"))\n\n(defn- load-base-assets$\n  []\n  (js-load$ (str JS_ROOT \"/shepherd.min.js\")))\n\n(defn- make-skip-fns\n  [^js jsTour]\n  (let [^js el (js/document.createElement \"button\")]\n    (.add (.-classList el) \"cp__onboarding-skip-quick-tour\")\n    (set! (.-innerHTML el) (h/render-html [:span [:i.ti.ti-player-skip-forward] \"Skip Quick Tour\"]))\n    (.addEventListener el \"click\" #(.cancel jsTour))\n    [#(.appendChild js/document.body el)\n     #(.removeChild js/document.body el)]))\n\n(defn- wait-target\n  [fn-or-selector time]\n  (p/let [action (if (string? fn-or-selector)\n                   #(d/sel1 fn-or-selector)\n                   fn-or-selector)\n          _      (action)\n          _      (p/delay time)]))\n\n(defn- inject-steps-indicator\n  [current total]\n\n  (h/render-html\n    [:div.steps\n     [:strong (str \"STEP \" current)]\n     [:ul (for [i (range total)] [:li {:class (when (= current (inc i)) \"active\")} i])]]))\n\n(defn- create-steps! [^js jsTour]\n  [\n   ;; step 1\n   {:id                \"nav-help\"\n    :text              (h/render-html [:section [:h2 \"\u2753 Help\"]\n                                       [:p \"You can always click here for help and other information about Logseq.\"]])\n    :attachTo          {:element \".cp__sidebar-help-btn\" :on \"top\"}\n    :beforeShowPromise #(if (state/sub :ui/sidebar-open?)\n                          (wait-target state/hide-right-sidebar! 700)\n                          (p/resolved true))\n    :canClickTarget    true\n    :buttons           [{:text \"Next\" :action (.-next jsTour)}]\n    :popperOptions     {:modifiers [{:name    \"preventOverflow\"\n                                     :options {:padding 20}}\n                                    {:name    \"offset\"\n                                     :options {:offset [0, 10]}}]}}\n\n   ;; step 2\n   {:id                \"nav-journal-page\"\n    :text              (h/render-html [:section [:h2 \"\ud83d\udcc6 Daily Journal Page\"]\n                                       [:p\n                                        [:span \"This is today\u2019s daily journal page. Here yo can dump your thoughts, learnings and ideas. Don\u2019t worry about organizing. Just write and\"]\n                                        [:a \"[[link]]\"]\n                                        [:span \"your thoughts.\"]]])\n\n    :attachTo          {:element \".page.is-journals .page-title\" :on \"top-end\"}\n    :beforeShowPromise #(if-not (= (util/safe-lower-case (state/get-current-page))\n                                  (util/safe-lower-case (date/today)))\n                          (wait-target (fn []\n                                         (router-handler/redirect-to-page! (date/today))\n                                         (util/scroll-to-top)) 200)\n                          (p/resolved true))\n    :buttons           [{:text \"Back\" :classes \"back\" :action (.-back jsTour)}\n                        {:text \"Next\" :action (.-next jsTour)}]\n    :popperOptions     {:modifiers [{:name    \"preventOverflow\"\n                                     :options {:padding 63}}\n                                    {:name    \"offset\"\n                                     :options {:offset [10, 10]}}]}}\n\n   ;; step 3\n   {:id                \"nav-left-sidebar\"\n    :text              (h/render-html [:section [:h2 \"\ud83d\udc40 Left Sidebar\"]\n                                       [:p [:span \"Open the left sidebar to explore important menu items in Logseq.\"]]])\n\n    :attachTo          {:element \"#left-menu\" :on \"top\"}\n    :beforeShowPromise #(p/resolved true)\n    :buttons           [{:text \"Back\" :classes \"back\" :action (.-back jsTour)}\n                        {:text \"Next\" :action (.-next jsTour)}]\n    :popperOptions     {:modifiers [{:name    \"preventOverflow\"\n                                     :options {:padding 20}}\n                                    {:name    \"offset\"\n                                     :options {:offset [10, 10]}}]}}\n\n   ;; step 4\n   {:id                \"nav-favorites\"\n    :text              (h/render-html [:section [:h2 \"\u2b50\ufe0f Favorites\"]\n                                       [:p \"Pin your favorite pages via the `... `menu on any page.\"]\n                                       [:p \"We\u2019ve also added some template pages here to help you get started. You can remove these once you start writing your own notes.\"]])\n    :beforeShowPromise #(if-not (state/sub :ui/left-sidebar-open?)\n                          (wait-target state/toggle-left-sidebar! 500)\n                          (p/resolved true))\n    :attachTo          {:element \".nav-content-item.favorites\" :on \"right\"}\n    :buttons           [{:text \"Back\" :classes \"back\" :action (.-back jsTour)}\n                        {:text \"Finish\" :action (.-complete jsTour)}]}\n   ])\n\n(defn start\n  []\n  (let [^js jsTour (js/Shepherd.Tour.\n                     (bean/->js\n                       {:useModalOverlay    true\n                        :defaultStepOptions {:classes  \"cp__onboarding-quick-tour\"\n                                             :scrollTo false}}))\n        steps      (create-steps! jsTour)\n        steps      (map-indexed #(assoc %2 :text (str (:text %2) (inject-steps-indicator (inc %1) (count steps)))) steps)\n        [show-skip! hide-skip!] (make-skip-fns jsTour)]\n\n    ;; events\n    (doto jsTour\n      (.on \"show\" show-skip!)\n      (.on \"hide\" hide-skip!)\n      (.on \"complete\" hide-skip!)\n      (.on \"cancel\" hide-skip!))\n\n    (doseq [step steps]\n      (.addStep jsTour (bean/->js step)))\n\n    (.start jsTour)))\n\n(defn- ready\n  [callback]\n  (p/then\n    (if (nil? js/window.Shepherd)\n      (load-base-assets$) (p/resolved true))\n    callback))\n\n(def should-guide? false)\n\n(defn init []\n  (command-palette/register {:id     :document/quick-tour\n                             :desc   \"Quick tour for onboarding\"\n                             :action #(ready start)})\n\n  ;; TODO: fix logic\n  (when should-guide?\n    (ready start)))"]}