{"version":3,"sources":["frontend/security.cljs"],"mappings":";AAOA,2CAAA,3CAAMA,8FACHC;AADH,AAEE,IAAAC,oBACC,AAACC,wBAAQF;AADV,AAAA,GAAAC;AAAA,IAAAA,wBAEC,6CAAA,7CAACE,6FAAK,AAACC,gBAAMJ;AAFd,AAAA,GAAAC;AAAA,IAAAA,wBAGC,AAAA,mFAAO,AAACI,iBAAOL;AAHhB,AAAA,oBAAAC;AAAA,IAAAA,wBAIC,AAAA,mFAAO,AAACI,iBAAOL;AAJhB,AAAA,oBAAAC;AAKC,kCAAA,3BAACK,yCAAoC,AAAA,mFAAO,AAACD,iBAAOL;;AALrDC;;;AAAAA;;;AAAAA;;;AAAAA;;;AAOF,oDAAA,pDAAMM,gHACHC;AADH,AAEE,OAACC,sBACA,WAAKT;AAAL,AACE,oBAAI,AAACD,yCAAiBC;AACpB,wDAAA,qBAAA,tEAACU,+CAAOV,MAAIW;;AACZX;;GACJQ","names":["frontend.security/javascript-link?","f","and__5041__auto__","cljs.core/vector?","cljs.core._EQ_","cljs.core/first","cljs.core/second","frontend.util/safe-re-find","frontend.security/remove-javascript-links-in-href","hiccup","clojure.walk/postwalk","cljs.core.update","cljs.core/dissoc"],"sourcesContent":["(ns frontend.security\n  (:require [clojure.walk :as walk]\n            [frontend.util :as util]))\n\n;; To prevent from cross-site scripting vulnerability, we should add security checks for both hiccup and raw html.\n;; Hiccup: [:a {:href \"javascript:alert('hei')\"} \"click me\"]\n\n(defn javascript-link?\n  [f]\n  (and\n   (vector? f)\n   (= :a (first f))\n   (:href (second f))\n   (:href (second f))\n   (util/safe-re-find #\"(?i)javascript\" (:href (second f)))))\n\n(defn remove-javascript-links-in-href\n  [hiccup]\n  (walk/postwalk\n   (fn [f]\n     (if (javascript-link? f)\n       (update f 1 dissoc :href)\n       f))\n   hiccup))\n\n;; HTML:\n;; Example 1:\n;; <script>\n;; alert('gotcha');\n;; </script>\n\n;; Example 2:\n;; <div style=\"padding: 20px; opacity: 0;height: 20px;\" onmouseout=\"alert('Gotcha!')\"></div>\n"]}