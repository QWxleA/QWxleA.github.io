async function drawGraph(x,y,j,d,c,O,w){console.log("DB drawGraph");const{index:t,links:p,content:_}=await fetchData,u=x.replace(y,""),m=e=>[...new Set(e.flatMap(e=>[e.source,e.target]))],s=new Set,a=[u||"/","__SENTINEL"];if(d>=0)for(;d>=0&&a.length>0;){const e=a.shift();if(e==="__SENTINEL")d--,a.push("__SENTINEL");else{s.add(e);const n=t.links[e]||[],o=t.backlinks[e]||[];a.push(...n.map(e=>e.target),...o.map(e=>e.source))}}else m(p).forEach(e=>s.add(e));const i={nodes:[...s].map(e=>({id:e})),links:p.filter(e=>s.has(e.source)&&s.has(e.target))},l=e=>{if(e.id===u||e.id==="/"&&u==="")return"var(--g-node-active)";for(const t of j){const n=Object.keys(t)[0],s=t[n];if(e.id.startsWith(n))return s}return"var(--g-node)"},g=t=>{function n(n,e){n.active||t.alphaTarget(1).restart(),e.fx=e.x,e.fy=e.y}function s(e,t){t.fx=e.x,t.fy=e.y}function o(n,e){n.active||t.alphaTarget(0),e.fx=null,e.fy=null}const e=()=>{};return d3.drag().on("start",c?n:e).on("drag",c?s:e).on("end",c?o:e)},e=250,n=document.getElementById("graph-container").offsetWidth,r=d3.forceSimulation(i.nodes).force("charge",d3.forceManyBody().strength(-30)).force("link",d3.forceLink(i.links).id(e=>e.id)).force("center",d3.forceCenter()),o=d3.select("#graph-container").append("svg").attr("width",n).attr("height",e).attr("viewBox",[-n/2,-e/2,n,e]);if(O){const t=[{Current:"var(--g-node-active)"},{Note:"var(--g-node)"},...j];t.forEach((t,s)=>{const i=Object.keys(t)[0],a=t[i];o.append("circle").attr("cx",-n/2+20).attr("cy",e/2-30*(s+1)).attr("r",6).style("fill",a),o.append("text").attr("x",-n/2+40).attr("y",e/2-30*(s+1)).text(i).style("font-size","15px").attr("alignment-baseline","middle")})}const f=o.append("g").selectAll("line").data(i.links).join("line").attr("class","link").attr("stroke","var(--g-link)").attr("stroke-width",2).attr("data-source",e=>e.source.id).attr("data-target",e=>e.target.id),v=o.append("g").selectAll("g").data(i.nodes).enter().append("g"),b=v.append("circle").attr("class","node").attr("id",e=>e.id).attr("r",e=>{const n=t.links[e.id]?.length||0,s=t.backlinks[e.id]?.length||0;return 3+(n+s)/4}).attr("fill",l).style("cursor","pointer").on("click",(t,e)=>{window.location.href=y+"/"+decodeURI(e.id).replace(/\s+/g,"-")}).on("mouseover",function(a,e){d3.selectAll(".node").transition().duration(100).attr("fill","var(--g-node-inactive)");const s=m([...t.links[e.id]||[],...t.backlinks[e.id]||[]]),o=d3.selectAll(".node").filter(e=>s.includes(e.id)),n=e.id,i=d3.selectAll(".link").filter(e=>e.source.id===n||e.target.id===n);o.transition().duration(200).attr("fill",l),i.transition().duration(200).attr("stroke","var(--g-link-active)"),d3.select(this.parentNode).select("text").raise().transition().duration(200).style("opacity",1)}).on("mouseleave",function(s,t){d3.selectAll(".node").transition().duration(200).attr("fill",l);const e=t.id,n=d3.selectAll(".link").filter(t=>t.source.id===e||t.target.id===e);n.transition().duration(200).attr("stroke","var(--g-link)"),d3.select(this.parentNode).select("text").transition().duration(200).style("opacity",0)}).call(g(r)),h=v.append("text").attr("dx",12).attr("dy",".35em").text(e=>_[e.id]?.title||e.id.replace("-"," ")).style("opacity",0).style("pointer-events","none").call(g(r));w&&o.call(d3.zoom().extent([[0,0],[n,e]]).scaleExtent([.25,4]).on("zoom",({transform:e})=>{f.attr("transform",e),b.attr("transform",e),h.attr("transform",e)})),r.on("tick",()=>{f.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),b.attr("cx",e=>e.x).attr("cy",e=>e.y),h.attr("x",e=>e.x).attr("y",e=>e.y)})}